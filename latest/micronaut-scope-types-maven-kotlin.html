<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Micronaut Scope Types</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="alternate" type="application/rss+xml" title="Micronaut Guides RSS Feed" href="https://guides.micronaut.io/latest/rss.xml" />
    <link rel="alternate" type="application/json" title="Micronaut Guides JSON Feed" href="https://guides.micronaut.io/latest/feed.json" />
    <link href="coderay.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="lunr.js"></script>
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronaut-scope-types.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="Micronaut Scope Types"/>
    <meta name="twitter:description" content="Learn about the available scopes: Singleton, Prototype, Request, Refreshable, Context..."/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item"><a href="https://micronaut.io/download/" class="nav-link">Download</a></li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-2868 dropdown nav-item"><a href="https://micronaut.io/learn/" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a><ul class="dropdown-menu">
                        <li id="menu-item-4943" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4943"><a href="https://micronaut.io/learn/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-5111" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5111"><a href="https://docs.micronaut.io/index.html" class="dropdown-item">User Documentaton</a></li>
                        <li id="menu-item-4510" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4510"><a href="https://micronaut.io/guides/" class="dropdown-item">Guides</a></li>
                        <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896"><a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a></li>
                        <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897"><a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a></li>
                        <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871"><a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a></li>
                        <li id="menu-item-6526" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6526"><a href="https://micronaut-projects.github.io/micronaut-guides-mn3/latest/" class="dropdown-item">Guides for Micronaut Framework 3</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item"><a href="https://micronaut.io/resources/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a><ul class="dropdown-menu">
                        <li id="menu-item-4999" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4999"><a href="https://micronaut.io/upcoming-events/" class="dropdown-item">Upcoming Events</a></li>
                        <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879"><a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a></li>
                        <li id="menu-item-6478" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6478"><a href="https://micronaut.io/category/release-announcements/" class="dropdown-item">Releases</a></li>
                        <li id="menu-item-6715" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6715"><a href="https://micronaut.io/category/security-announcements/" class="dropdown-item">Security Announcements</a></li>
                        <li id="menu-item-4499" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4499"><a href="https://micronautpodcast.com/" class="dropdown-item">Podcast</a></li>
                        <li id="menu-item-5798" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5798"><a href="https://micronaut.io/support/" class="dropdown-item">Commercial Support</a></li>
                        <li id="menu-item-4186" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4186"><a href="https://micronaut.io/resources/community-support/" class="dropdown-item">Community Support</a></li>
                        <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882"><a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a></li>
                        <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883"><a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a></li>
                        <li id="menu-item-6479" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6479"><a href="https://micronaut.io/micronaut-success-stories/" class="dropdown-item">Micronaut Success Stories</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2872 dropdown nav-item"><a href="https://micronaut.io/foundation/" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a><ul class="dropdown-menu">
                        <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2877"><a href="https://micronaut.io/foundation/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874"><a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a></li>
                        <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873"><a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a></li>
                        <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876"><a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a></li>
                        <li id="menu-item-3838" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3838"><a href="https://micronaut.io/meeting-minutes/" class="dropdown-item">Meeting Minutes</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item"><a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a></li>

                </ul>

            </div>

        </nav>

    </div>
</header>

<div style="background: #fff;padding-top: 20px;padding-bottom: 20px;">
    <div class="container" style="clear: both;">
        <fieldset style="float: right;">
            <input type="search" id="search-form-query"/>
            <input type="submit" onclick="search()" value="Search">
            <input type="submit" onclick="resetSearch()" value="Reset">
        </fieldset>
    </div>
    <div class="container" style="clear: both;margin-top: -20px;">
        <div class="guide-list" id="searchResults">
        </div>
    </div>
</div>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-scope-types.html">Micronaut Scope Types</a> » <span class="breadcrumb_last" aria-current="page">maven | kotlin</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#writing-the-application">4. Writing the Application</a></li>
<li><a href="#scenario">5. Scenario</a></li>
<li><a href="#singleton">6. Singleton</a>
<ul class="sectlevel2">
<li><a href="#singleton-test">6.1. Singleton Test</a></li>
</ul>
</li>
<li><a href="#prototype">7. Prototype</a>
<ul class="sectlevel2">
<li><a href="#prototype-tests">7.1. Prototype Tests</a></li>
</ul>
</li>
<li><a href="#request">8. Request</a>
<ul class="sectlevel2">
<li><a href="#request-tests">8.1. Request Tests</a></li>
</ul>
</li>
<li><a href="#refreshable">9. Refreshable</a>
<ul class="sectlevel2">
<li><a href="#refreshable-tests">9.1. Refreshable Tests</a></li>
</ul>
</li>
<li><a href="#context">10. @Context</a></li>
<li><a href="#other-scopes">11. Other scopes</a>
<ul class="sectlevel2">
<li><a href="#infrastructure">11.1. @Infrastructure</a></li>
<li><a href="#threadlocal">11.2. @ThreadLocal</a></li>
<li><a href="#next-steps">11.3. Next Steps</a></li>
</ul>
</li>
<li><a href="#help-with-the-micronaut-framework">12. Help with the Micronaut Framework</a></li>
<li><a href="#license">13. License</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Micronaut Scope Types</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Learn about the available scopes: Singleton, Prototype, Request, Refreshable, Context&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Authors: Sergio del Amo</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 4.9.1</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut features an extensible bean scoping mechanism based on <a href="https://javax-inject.github.io/javax-inject/">JSR-330</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE (e.g. <a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">IntelliJ IDEA</a>)</p>
</li>
<li>
<p>JDK 21 or greater installed with <code>JAVA_HOME</code> <a href="https://www.baeldung.com/java-home-on-windows-7-8-10-mac-os-x-linux">configured appropriately</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-scope-types-maven-kotlin.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-application">4. Writing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an application using the <a href="https://docs.micronaut.io/latest/guide/#cli">Micronaut Command Line Interface</a> or with <a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn create-app example.micronaut.micronautguide \
    --features=junit-params,management,validation \
    --build=maven \
    --lang=kotlin \
    --test=junit</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle with the <a href="https://docs.gradle.org/current/userguide/kotlin_dsl.html">Kotlin DSL</a> is used as the build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as the language.<br/> If you don&#8217;t specify the <code>--test</code> argument, JUnit is used for Java and Kotlin, and Spock is used for Groovy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command creates a Micronaut application with the default package <code>example.micronaut</code> in a directory named <code>micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>If you use Micronaut Launch, select Micronaut Application as application type and add <code>junit-params</code>, <code>management</code>, and <code>validation</code> features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have an existing Micronaut application and want to add the functionality described here, you can view the dependency and configuration changes from the specified features, and apply those changes to your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://micronaut.io/launch?features=junit-params&amp;features=management&amp;features=validation&amp;lang=KOTLIN&amp;build=MAVEN&amp;test=JUNIT&amp;name=micronautguide&amp;type=DEFAULT&amp;package=example.micronaut&amp;activity=diff" target="_blank" rel="noopener">Diff</a></p>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">Setup IntelliJ IDEA to develop Micronaut Applications</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scenario">5. Scenario</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We use the following scenario to talk about the different types of scopes.</p>
</div>
<div class="paragraph">
<p>The following <code>@Controller</code> injects two collaborators.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/singleton/RobotController.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut.singleton

import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller(&quot;/singleton&quot;) <i class="conum" data-value="1"></i><b>(1)</b>

class RobotController(
    private val robotFather: RobotFather, <i class="conum" data-value="2"></i><b>(2)</b>
    private val robotMother: RobotMother <i class="conum" data-value="3"></i><b>(3)</b>
) {

    @Get <i class="conum" data-value="4"></i><b>(4)</b>
    fun children(): List&lt;String&gt; {
        return listOf(robotMother.child().getSerialNumber(), robotFather.child().getSerialNumber())
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use constructor injection to inject a bean of type <code>RobotFather</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use constructor injection to inject a bean of type <code>RobotMother</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the <code>children</code> method to an HTTP GET request on <code>/</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each collaborator has an injection point for a bean of type <code>Robot</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/singleton/RobotFather.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut.singleton

import jakarta.inject.Singleton

@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
class RobotFather(private val robot: Robot) { <i class="conum" data-value="2"></i><b>(2)</b>
    fun child() = robot
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use constructor injection to inject a bean of type <code>Robot</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/singleton/RobotMother.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut.singleton

import jakarta.inject.Singleton

@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
class RobotMother(private val robot: Robot) { <i class="conum" data-value="2"></i><b>(2)</b>
    fun child() = robot
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use constructor injection to inject a bean of type <code>Robot</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s discuss how the application behaves depending on the scope used for the bean of type <code>Robot</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="singleton">6. Singleton</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Singleton scope indicates only one instance of the bean will exist</strong>.</p>
</div>
<div class="paragraph">
<p>To define a singleton, annotate a class with <code>jakarta.inject.Singleton</code> at the class level.</p>
</div>
<div class="paragraph">
<p>The following class creates a unique identifier in the constructor. This identifier allows us to identify how many   <code>Robot</code> instances are used.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/singleton/Robot.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut.singleton

import jakarta.inject.Singleton
import java.util.UUID

@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
class Robot {
    private val serialNumber: String = UUID.randomUUID().toString()

    fun getSerialNumber(): String {
        return serialNumber
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="singleton-test">6.1. Singleton Test</h3>
<div class="paragraph">
<p>To use the testing features described in this section, add the following dependency to your build file:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.junit.jupiter<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>junit-jupiter-params<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following test verifies <code>@Singleton</code> behavior.</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/SingletonScopeTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut
*/

import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.ValueSource


@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
class SingletonScopeTest(@Client(&quot;/&quot;) val httpClient: HttpClient) { <i class="conum" data-value="2"></i><b>(2)</b>

    @ParameterizedTest
    @ValueSource(strings = [&quot;/singleton&quot;])
    fun onlyOneInstanceOfTheBeanExistsForSingletonBeans(path: String) {
        val responses = executeRequest(httpClient, path).toMutableSet()
        assertEquals(1, responses.size) <i class="conum" data-value="3"></i><b>(3)</b>
        responses.addAll(executeRequest(httpClient, path))
        assertEquals(1, responses.size) <i class="conum" data-value="4"></i><b>(4)</b>
    }

    private fun executeRequest(client: HttpClient, path: String): List&lt;String&gt; {
        return client.toBlocking().retrieve(
            HttpRequest.GET&lt;Any&gt;(path),
            Argument.listOf(String::class.java)
        )
    }

}


import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.ValueSource


@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
class SingletonScopeTest(@Client(&quot;/&quot;) val httpClient: HttpClient) { <i class="conum" data-value="2"></i><b>(2)</b>

    @ParameterizedTest
    @ValueSource(strings = [&quot;/singleton&quot;])

    fun onlyOneInstanceOfTheBeanExistsForSingletonBeans(path: String) {
        val responses = executeRequest(httpClient, path).toMutableSet()
        assertEquals(1, responses.size) <i class="conum" data-value="3"></i><b>(3)</b>
        responses.addAll(executeRequest(httpClient, path))
        assertEquals(1, responses.size) <i class="conum" data-value="4"></i><b>(4)</b>
    }

    private fun executeRequest(client: HttpClient, path: String): List&lt;String&gt; {
        return client.toBlocking().retrieve(
            HttpRequest.GET&lt;Any&gt;(path),
            Argument.listOf(String::class.java)
        )
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> so the Micronaut framework will initialize the application context and the embedded server. <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/">More info</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>HttpClient</code> bean and point it to the embedded server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The same instance fulfills both injection points at <code>RobotFather</code> and <code>RobotMother</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Same instance is used upon subsequent requests.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prototype">7. Prototype</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Prototype scope indicates that a new instance of the bean is created each time it is injected</strong></p>
</div>
<div class="paragraph">
<p>Let&#8217;s use <code>@Prototype</code> instead of <code>@Singleton</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/prototype/Robot.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut.prototype

import io.micronaut.context.annotation.Prototype
import java.util.UUID

@Prototype <i class="conum" data-value="1"></i><b>(1)</b>
class Robot {
    private val serialNumber: String = UUID.randomUUID().toString()

    fun getSerialNumber(): String {
        return serialNumber
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>io.micronaut.context.annotation.Prototype</code> to designate the scope of bean as Prototype - a non-singleton scope that creates a new bean for every injection point.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="prototype-tests">7.1. Prototype Tests</h3>
<div class="paragraph">
<p>The following test verifies the behavior of <code>Prototype</code> scope.</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/PrototypeScopeTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut
*/

import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.ValueSource

@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
class PrototypeScopeTest(@Client(&quot;/&quot;) val httpClient: HttpClient) { <i class="conum" data-value="2"></i><b>(2)</b>

    @ParameterizedTest
    @ValueSource(strings = [&quot;/prototype&quot;])

    fun prototypeScopeIndicatesThatANewInstanceOfTheBeanIsCreatedEachTimeItIsInjected(path: String) {
        val responses = executeRequest(httpClient, path).toMutableSet()
        assertEquals(2, responses.size) <i class="conum" data-value="3"></i><b>(3)</b>
        responses.addAll(executeRequest(httpClient, path))
        assertEquals(2, responses.size) <i class="conum" data-value="4"></i><b>(4)</b>
    }

    private fun executeRequest(client: HttpClient, path: String): List&lt;String&gt; {
        return client.toBlocking().retrieve(
            HttpRequest.GET&lt;Any&gt;(path),
            Argument.listOf(String::class.java)
        )
    }

}


import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.ValueSource

@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
class PrototypeScopeTest(@Client(&quot;/&quot;) val httpClient: HttpClient) { <i class="conum" data-value="2"></i><b>(2)</b>

    @ParameterizedTest
    @ValueSource(strings = [&quot;/prototype&quot;])

    fun prototypeScopeIndicatesThatANewInstanceOfTheBeanIsCreatedEachTimeItIsInjected(path: String) {
        val responses = executeRequest(httpClient, path).toMutableSet()
        assertEquals(2, responses.size) <i class="conum" data-value="3"></i><b>(3)</b>
        responses.addAll(executeRequest(httpClient, path))
        assertEquals(2, responses.size) <i class="conum" data-value="4"></i><b>(4)</b>
    }

    private fun executeRequest(client: HttpClient, path: String): List&lt;String&gt; {
        return client.toBlocking().retrieve(
            HttpRequest.GET&lt;Any&gt;(path),
            Argument.listOf(String::class.java)
        )
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> so the Micronaut framework will initialize the application context and the embedded server. <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/">More info</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>HttpClient</code> bean and point it to the embedded server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A new instance is created to fulfill each injection point. Two instances - one for <code>RobotFather</code> and another for <code>RobotMother</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Instances remain upon subsequent requests.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="request">8. Request</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>@RequestScope scope is a custom scope that indicates a new instance of the bean is created and associated with each HTTP request</strong></p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/request/Robot.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut.request

import io.micronaut.http.HttpRequest
import io.micronaut.runtime.http.scope.RequestAware
import io.micronaut.runtime.http.scope.RequestScope

@RequestScope <i class="conum" data-value="1"></i><b>(1)</b>
class Robot : RequestAware { <i class="conum" data-value="2"></i><b>(2)</b>
    private var serialNumber: String? = null

    override fun setRequest(request: HttpRequest&lt;*&gt;?) {
        this.serialNumber = request!!.headers.get(&quot;UUID&quot;)
    }

    fun getSerialNumber(): String {
        return serialNumber!!
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>io.micronaut.runtime.http.scope.RequestScope</code> to designate the scope of bean as Request - a new instance of the bean is created and associated with each HTTP request.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>RequestAware</code> API allows <code>@RequestScope</code> beans to access to the current request.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="request-tests">8.1. Request Tests</h3>
<div class="paragraph">
<p>The following test verifies the behavior of <code>@RequestScope</code> scope.</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/RequestScopeTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut
*/

import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import jakarta.inject.Inject
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.ValueSource
import java.util.UUID

@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
class RequestScopeTest(@Client(&quot;/&quot;) val httpClient: HttpClient) { <i class="conum" data-value="2"></i><b>(2)</b>

    @ParameterizedTest
    @ValueSource(strings = [&quot;/request&quot;])
    fun requestScopeScopeIsACustomScopeThatIndicatesANewInstanceOfTheBeanIsCreatedAndAssociatedWithEachHTTPRequest(path: String) {
        val responses = executeRequest(httpClient, createRequest(path)).toMutableSet()
        assertEquals(1, responses.size) <i class="conum" data-value="3"></i><b>(3)</b>
        responses.addAll(executeRequest(httpClient, createRequest(path)))
        assertEquals(2, responses.size) <i class="conum" data-value="4"></i><b>(4)</b>
    }

    private fun executeRequest(client: HttpClient, request: HttpRequest&lt;Any&gt;): List&lt;String&gt; {
        return client.toBlocking().retrieve(
            request,
            Argument.listOf(String::class.java)
        )
    }

    private fun createRequest(path: String): HttpRequest&lt;Any&gt; {
        return HttpRequest.GET&lt;Any&gt;(path).header(&quot;UUID&quot;, UUID.randomUUID().toString())
    }
}


import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import jakarta.inject.Inject
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.ValueSource
import java.util.UUID

@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
class RequestScopeTest(@Client(&quot;/&quot;) val httpClient: HttpClient) { <i class="conum" data-value="2"></i><b>(2)</b>

    @ParameterizedTest
    @ValueSource(strings = [&quot;/request&quot;])
    fun requestScopeScopeIsACustomScopeThatIndicatesANewInstanceOfTheBeanIsCreatedAndAssociatedWithEachHTTPRequest(path: String) {
        val responses = executeRequest(httpClient, createRequest(path)).toMutableSet()
        assertEquals(1, responses.size) <i class="conum" data-value="3"></i><b>(3)</b>
        responses.addAll(executeRequest(httpClient, createRequest(path)))
        assertEquals(2, responses.size) <i class="conum" data-value="4"></i><b>(4)</b>
    }

    private fun executeRequest(client: HttpClient, request: HttpRequest&lt;Any&gt;): List&lt;String&gt; {
        return client.toBlocking().retrieve(
            request,
            Argument.listOf(String::class.java)
        )
    }

    private fun createRequest(path: String): HttpRequest&lt;Any&gt; {
        return HttpRequest.GET&lt;Any&gt;(path).header(&quot;UUID&quot;, UUID.randomUUID().toString())
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> so the Micronaut framework will initialize the application context and the embedded server. <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/">More info</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>HttpClient</code> bean and point it to the embedded server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Both injection points, <code>RobotFather</code> and <code>RobotMother</code>, are fulfilled with the same instance of <code>Robot</code>. An instance associated with the HTTP Request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Both injection points are fulfilled with the new instance of <code>Robot</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="refreshable">9. Refreshable</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><a href="https://docs.micronaut.io/latest/guide/#refreshable">Refreshable scope</a> is a custom scope that allows a bean&#8217;s state to be refreshed via the <a href="https://docs.micronaut.io/latest/guide/#refreshEndpoint">/refresh endpoint</a>.</strong></p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/refreshable/Robot.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut.refreshable

import io.micronaut.runtime.context.scope.Refreshable
import java.util.UUID

@Refreshable <i class="conum" data-value="1"></i><b>(1)</b>
class Robot {
    private val serialNumber: String = UUID.randomUUID().toString()

    fun getSerialNumber(): String {
        return serialNumber
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Refreshable</code> scope is a custom scope that allows a bean&#8217;s state to be refreshed via the <a href="https://docs.micronaut.io/latest/guide/#refreshEndpoint">/refresh</a> endpoint.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your application needs the <code>management</code> dependency to enable the refresh endpoint.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.micronaut<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>micronaut-management<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="refreshable-tests">9.1. Refreshable Tests</h3>
<div class="paragraph">
<p>The following test enables the <a href="https://docs.micronaut.io/latest/guide/#refreshEndpoint">refresh endpoint</a> and verifies the behavior of <code>@Refreshable</code></p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/RefreshableScopeTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut
*/

import io.micronaut.context.annotation.Property
import io.micronaut.core.type.Argument
import io.micronaut.core.util.StringUtils
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.ValueSource

@Property(name = &quot;endpoints.refresh.enabled&quot;, value = StringUtils.TRUE) <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = &quot;endpoints.refresh.sensitive&quot;, value = StringUtils.FALSE) <i class="conum" data-value="2"></i><b>(2)</b>
@MicronautTest <i class="conum" data-value="3"></i><b>(3)</b>
class RefreshableScopeTest(@Client(&quot;/&quot;) val httpClient: HttpClient) { <i class="conum" data-value="4"></i><b>(4)</b>

    @ParameterizedTest
    @ValueSource(strings = [&quot;/refreshable&quot;])
    fun refreshableScopeIsACustomScopeThatAllowsABeansStateToBeRefreshedViaTheRefreshEndpoint(path: String) {
        val responses = executeRequest(httpClient, path).toMutableSet()
        assertEquals(1, responses.size) <i class="conum" data-value="5"></i><b>(5)</b>
        responses.addAll(executeRequest(httpClient, path))
        assertEquals(1, responses.size) <i class="conum" data-value="6"></i><b>(6)</b>
        refresh() <i class="conum" data-value="7"></i><b>(7)</b>
        responses.addAll(executeRequest(httpClient, path))
        assertEquals(2, responses.size) <i class="conum" data-value="8"></i><b>(8)</b>
    }

    private fun executeRequest(client: HttpClient, path: String): List&lt;String&gt; {
        return client.toBlocking().retrieve(
            HttpRequest.GET&lt;Any&gt;(path),
            Argument.listOf(String::class.java)
        )
    }

    private fun refresh() {
        httpClient.toBlocking().exchange&lt;Any, Any&gt;(
            HttpRequest.POST(
                &quot;/refresh&quot;,
                mapOf(&quot;force&quot; to true)
            )
        )
    }

}


import io.micronaut.context.annotation.Property
import io.micronaut.core.type.Argument
import io.micronaut.core.util.StringUtils
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.ValueSource

@Property(name = &quot;endpoints.refresh.enabled&quot;, value = StringUtils.TRUE) <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = &quot;endpoints.refresh.sensitive&quot;, value = StringUtils.FALSE) <i class="conum" data-value="2"></i><b>(2)</b>
@MicronautTest <i class="conum" data-value="3"></i><b>(3)</b>
class RefreshableScopeTest(@Client(&quot;/&quot;) val httpClient: HttpClient) { <i class="conum" data-value="4"></i><b>(4)</b>

    @ParameterizedTest
    @ValueSource(strings = [&quot;/refreshable&quot;])
    fun refreshableScopeIsACustomScopeThatAllowsABeansStateToBeRefreshedViaTheRefreshEndpoint(path: String) {
        val responses = executeRequest(httpClient, path).toMutableSet()
        assertEquals(1, responses.size) <i class="conum" data-value="5"></i><b>(5)</b>
        responses.addAll(executeRequest(httpClient, path))
        assertEquals(1, responses.size) <i class="conum" data-value="6"></i><b>(6)</b>
        refresh() <i class="conum" data-value="7"></i><b>(7)</b>
        responses.addAll(executeRequest(httpClient, path))
        assertEquals(2, responses.size) <i class="conum" data-value="8"></i><b>(8)</b>
    }

    private fun executeRequest(client: HttpClient, path: String): List&lt;String&gt; {
        return client.toBlocking().retrieve(
            HttpRequest.GET&lt;Any&gt;(path),
            Argument.listOf(String::class.java)
        )
    }

    private fun refresh() {
        httpClient.toBlocking().exchange&lt;Any, Any&gt;(
            HttpRequest.POST(
                &quot;/refresh&quot;,
                mapOf(&quot;force&quot; to true)
            )
        )
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@Property</code> to supply configuration to the test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The refresh endpoint is sensitive by default. To invoke it in the test, we set <code>endpoints.refresh.sensitive</code> to false.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Annotate the class with <code>@MicronautTest</code> so the Micronaut framework will initialize the application context and the embedded server. <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/">More info</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Inject the <code>HttpClient</code> bean and point it to the embedded server.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The same instance fulfills both injection points at <code>RobotFather</code> and <code>RobotMother</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The same instance serves a new request.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Hitting the refresh endpoint, publishes a <a href="https://docs.micronaut.io/latest/api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a>, which invalidates the instance of <code>Robot</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>A new instance of <code>Robot</code> is created the next time the object is requested.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="context">10. @Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Context scope indicates that the bean will be created at the same time as the ApplicationContext (eager initialization)</strong></p>
</div>
<div class="paragraph">
<p>The following example uses <code>@Context</code> in combination with <code>@ConfigurationProperties</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/context/MicronautConfiguration.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut.context

import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.context.annotation.Context
import jakarta.validation.constraints.Pattern

@Context <i class="conum" data-value="1"></i><b>(1)</b>
@ConfigurationProperties(&quot;micronaut&quot;) <i class="conum" data-value="2"></i><b>(2)</b>
class MicronautConfiguration {

    @field:Pattern(regexp = &quot;groovy|java|kotlin&quot;) <i class="conum" data-value="3"></i><b>(3)</b>
    var language: String? = null

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The life cycle of classes annotated with <code>io.micronaut.context.annotation.Context</code> is bound to that of the bean context.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>jakarta.validation.constraints</code> Constraints to ensure the data matches your expectations.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The result is validation being performed on the Application Context start-up.</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/ContextTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut
/*
//tag::package[]
package example.micronaut
//tag::package[]
*/
//tag::imports[]

import io.micronaut.context.ApplicationContext
import io.micronaut.context.exceptions.BeanInstantiationException
import org.junit.jupiter.api.Assertions.assertTrue
import org.junit.jupiter.api.Test
import org.junit.jupiter.api.assertThrows

class ContextTest {

    @Test
    fun lifeCycleOfClassesAnnotatedWithAtContextIsBoundToThatOfTheBeanContext() {

        val thrown =
            assertThrows&lt;BeanInstantiationException&gt; { ApplicationContext.run(mapOf(&quot;micronaut.language&quot; to &quot;scala&quot;)) }
        assertTrue(thrown.message!!.contains(&quot;must match \&quot;groovy|java|kotlin\&quot;&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other-scopes">11. Other scopes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut Framework ships with other built-in Scopes:</p>
</div>
<div class="sect2">
<h3 id="infrastructure">11.1. @Infrastructure</h3>
<div class="paragraph">
<p><a href="https://docs.micronaut.io/latest/api/io/micronaut/context/annotation/Infrastructure.html">@Infrastructure</a> scope represents a bean that cannot be overridden or replaced using <code>@Replaces</code> because it is critical to the functioning of the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="threadlocal">11.2. @ThreadLocal</h3>
<div class="paragraph">
<p><a href="https://docs.micronaut.io/latest/api/io/micronaut/runtime/context/scope/ThreadLocal.html">@ThreadLocal</a> scope is a custom scope that associates a bean per thread via a ThreadLocal</p>
</div>
</div>
<div class="sect2">
<h3 id="next-steps">11.3. Next Steps</h3>
<div class="paragraph">
<p>Read more about <a href="https://docs.micronaut.io/latest/guide/#scopes">Scopes</a> in the Micronaut Framework.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="help-with-the-micronaut-framework">12. Help with the Micronaut Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://micronaut.io/foundation/">Micronaut Foundation</a> sponsored the creation of this Guide. A variety of <a href="https://micronaut.io/commercial-support/">consulting and support services</a> are available.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license">13. License</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All guides are released with an <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache license 2.0 license</a> for the code and a <a href="https://creativecommons.org/licenses/by/4.0/deed.en">Creative Commons Attribution 4.0</a> license for the writing and media (images&#8230;&#8203;).
</td>
</tr>
</table>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <a href="https://micronaut.io/foundation/"><img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/></a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li id="menu-item-6740" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6740"><a href="https://fosstodon.org/@micronaut"><i class="fab fa-mastodon"><span class="sr-only">Mastodon</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://discord.gg/9xRFsHv98T"><i class="fab fa-discord"><span class="sr-only">Discord</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>Guides are licensed under <a href="https://creativecommons.org/licenses/by/4.0/deed.en">CC BY 4.0</a> for the writing/media and <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache.2.0</a> for the code</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
