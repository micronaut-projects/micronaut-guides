<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Service discovery and distributed configuration with Google Kubernetes Engine (GKE)</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="alternate" type="application/rss+xml" title="Micronaut Guides RSS Feed" href="https://guides.micronaut.io/latest/rss.xml" />
    <link rel="alternate" type="application/json" title="Micronaut Guides JSON Feed" href="https://guides.micronaut.io/latest/feed.json" />
    <link href="coderay.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="lunr.js"></script>
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronaut-k8s-gcp.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="Service discovery and distributed configuration with Google Kubernetes Engine (GKE)"/>
    <meta name="twitter:description" content="Service discovery and distributed configuration in a Micronaut application with Google Kubernetes Engine (GKE)"/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item"><a href="https://micronaut.io/download/" class="nav-link">Download</a></li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-2868 dropdown nav-item"><a href="https://micronaut.io/learn/" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a><ul class="dropdown-menu">
                        <li id="menu-item-4943" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4943"><a href="https://micronaut.io/learn/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-5111" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5111"><a href="https://docs.micronaut.io/index.html" class="dropdown-item">User Documentaton</a></li>
                        <li id="menu-item-4510" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4510"><a href="https://micronaut.io/guides/" class="dropdown-item">Guides</a></li>
                        <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896"><a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a></li>
                        <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897"><a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a></li>
                        <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871"><a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a></li>
                        <li id="menu-item-6526" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6526"><a href="https://micronaut-projects.github.io/micronaut-guides-mn3/latest/" class="dropdown-item">Guides for Micronaut Framework 3</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item"><a href="https://micronaut.io/resources/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a><ul class="dropdown-menu">
                        <li id="menu-item-4999" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4999"><a href="https://micronaut.io/upcoming-events/" class="dropdown-item">Upcoming Events</a></li>
                        <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879"><a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a></li>
                        <li id="menu-item-6478" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6478"><a href="https://micronaut.io/category/release-announcements/" class="dropdown-item">Releases</a></li>
                        <li id="menu-item-6715" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6715"><a href="https://micronaut.io/category/security-announcements/" class="dropdown-item">Security Announcements</a></li>
                        <li id="menu-item-4499" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4499"><a href="https://micronautpodcast.com/" class="dropdown-item">Podcast</a></li>
                        <li id="menu-item-5798" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5798"><a href="https://micronaut.io/support/" class="dropdown-item">Commercial Support</a></li>
                        <li id="menu-item-4186" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4186"><a href="https://micronaut.io/resources/community-support/" class="dropdown-item">Community Support</a></li>
                        <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882"><a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a></li>
                        <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883"><a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a></li>
                        <li id="menu-item-6479" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6479"><a href="https://micronaut.io/micronaut-success-stories/" class="dropdown-item">Micronaut Success Stories</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2872 dropdown nav-item"><a href="https://micronaut.io/foundation/" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a><ul class="dropdown-menu">
                        <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2877"><a href="https://micronaut.io/foundation/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874"><a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a></li>
                        <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873"><a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a></li>
                        <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876"><a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a></li>
                        <li id="menu-item-3838" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3838"><a href="https://micronaut.io/meeting-minutes/" class="dropdown-item">Meeting Minutes</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item"><a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a></li>

                </ul>

            </div>

        </nav>

    </div>
</header>

<div style="background: #fff;padding-top: 20px;padding-bottom: 20px;">
    <div class="container" style="clear: both;">
        <fieldset style="float: right;">
            <input type="search" id="search-form-query"/>
            <input type="submit" onclick="search()" value="Search">
            <input type="submit" onclick="resetSearch()" value="Reset">
        </fieldset>
    </div>
    <div class="container" style="clear: both;margin-top: -20px;">
        <div class="guide-list" id="searchResults">
        </div>
    </div>
</div>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-k8s-gcp.html">Service discovery and distributed configuration with Google Kubernetes Engine (GKE)</a> » <span class="breadcrumb_last" aria-current="page">maven | groovy</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#costs">2. Costs</a></li>
<li><a href="#what-you-will-need">3. What you will need</a></li>
<li><a href="#the-application">4. The Application</a></li>
<li><a href="#google-cloud-platform">5. Google Cloud Platform</a>
<ul class="sectlevel2">
<li><a href="#cloud-sdk">5.1. Cloud SDK</a></li>
<li><a href="#google-cloud-platform-project">5.2. Google Cloud Platform Project</a></li>
<li><a href="#enable-billing">5.3. Enable billing</a></li>
<li><a href="#enable-the-google-cloud-container-registry-api">5.4. Enable the Google Cloud Container Registry API</a></li>
<li><a href="#configure-google-cloud-docker">5.5. Configure Google Cloud Docker</a></li>
<li><a href="#enable-the-google-cloud-kubernetes-engine-api">5.6. Enable the Google Cloud Kubernetes Engine API</a></li>
<li><a href="#create-gke-cluster">5.7. Create GKE cluster</a></li>
</ul>
</li>
<li><a href="#prepare-and-deploy-microservices">6. Prepare and Deploy Microservices</a>
<ul class="sectlevel2">
<li><a href="#users-microservice">6.1. Users Microservice</a></li>
<li><a href="#orders-microservice">6.2. Orders Microservice</a></li>
<li><a href="#api-microservice">6.3. API Microservice</a></li>
<li><a href="#deploy-services-to-gke">6.4. Deploy Services to GKE</a></li>
</ul>
</li>
<li><a href="#test-integration-between-applications-deployed-on-gke">7. Test integration between applications deployed on GKE</a></li>
<li><a href="#cleaning-up">8. Cleaning Up</a>
<ul class="sectlevel2">
<li><a href="#deleting-the-project">8.1. Deleting the project</a></li>
</ul>
</li>
<li><a href="#next-steps">9. Next Steps</a></li>
<li><a href="#license">10. License</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Service discovery and distributed configuration with Google Kubernetes Engine (GKE)</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Service discovery and distributed configuration in a Micronaut application with Google Kubernetes Engine (GKE)</p>
</div>
<div class="paragraph">
<p>Authors: Nemanja Mikic, Nemanja Mikic</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 4.9.1</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we will deploy three microservices on the <a href="https://cloud.google.com/kubernetes-engine">Google Kubernetes Engine (GKE)</a>. We will use Kubernetes Service discovery and Distributed configuration to wire up our microservices.</p>
</div>
<div class="paragraph">
<p>You will discover how the Micronaut framework eases Kubernetes integration and deployment to GKE.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="costs">2. Costs</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This guide uses paid services; you may need to enable Billing in Google Cloud to complete some steps in this guide.
</td>
</tr>
</table>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="what-you-will-need">3. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE (e.g. <a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">IntelliJ IDEA</a>)</p>
</li>
<li>
<p>JDK 17 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p><a href="https://www.docker.io/gettingstarted/#h_installation">Docker</a>.
Some of the following commands use <a href="https://stedolan.github.io/jq/"><code>jq</code></a></p>
</li>
</ul>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>jq is a lightweight and flexible command-line JSON processor</p>
</div>
</blockquote>
</div>
<div class="ulist">
<ul>
<li>
<p>You need a <a href="https://cloud.google.com/gcp/">Google Cloud Platform (GCP)</a> account and a GCP project.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-application">4. The Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Download the complete solution of the <a href="micronaut-k8s.html">Kubernetes and the Micronaut Framework</a> guide. You will use same three microservices (<code>users</code>, <code>orders</code>, and <code>api</code>) as a starting point.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="google-cloud-platform">5. Google Cloud Platform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Signup for the <a href="https://console.cloud.google.com/">Google Cloud Platform</a></p>
</div>
<div class="sect2">
<h3 id="cloud-sdk">5.1. Cloud SDK</h3>
<div class="paragraph">
<p>Install the <a href="https://cloud.google.com/sdk/docs/install">Cloud SDK CLI</a> for your operating system.</p>
</div>
<div class="paragraph">
<p>Cloud SDK includes the <code>gcloud</code> command-line tool. Run the <code>init</code> command in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Log in to your Google Cloud Platform:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud auth login</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="google-cloud-platform-project">5.2. Google Cloud Platform Project</h3>
<div class="paragraph">
<p>Create a new project with a unique name (replace <code>xxxxxx</code> with alphanumeric characters of your choice):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud projects create micronaut-guides-xxxxxx</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In GCP, project ids are globally unique, so the id you used above is the one you should use in the rest of this guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Change your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud config set project micronaut-guides-xxxxxx</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you forget the project id, you can list all projects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud projects list</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-billing">5.3. Enable billing</h3>
<div class="paragraph">
<p>Ensure you have a billing account created, and if not create one via the <a href="https://console.cloud.google.com/billing">Google Cloud Platform Console</a>.</p>
</div>
<div class="paragraph">
<p>To get a list of your billing accounts, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">❯ gcloud beta billing accounts list
ACCOUNT_ID            NAME                  OPEN   MASTER_ACCOUNT_ID
XXXXXX-XXXXXX-XXXXXX  My Billing Account    True</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then attach a billing account to your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">&gt; gcloud beta billing projects link micronaut-guides-xxxxxxx --billing-account=XXXXXX-XXXXXX-XXXXXX
billingAccountName: billingAccounts/XXXXXX-XXXXXX-XXXXXX
billingEnabled: true
name: projects/micronaut-guides-xxxxxxx/billingInfo
projectId: micronaut-guides-xxxxxxx</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-the-google-cloud-container-registry-api">5.4. Enable the Google Cloud Container Registry API</h3>
<div class="paragraph">
<p>We need somewhere to store our docker images, so we need to enable the Google Cloud Container Registry API for your project via the Google Cloud CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud services enable containerregistry.googleapis.com</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-google-cloud-docker">5.5. Configure Google Cloud Docker</h3>
<div class="paragraph">
<p>Run <code>auth configure-docker</code> via the Google Cloud CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">&gt; gcloud auth configure-docker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Adding credentials for all GCR repositories.
WARNING: A long list of credential helpers may cause delays running 'docker build'. We recommend passing the registry name to configure only the registry you are using.
After update, the following will be written to your Docker config file located at [~/.docker/config.json]:
 {
  &quot;credHelpers&quot;: {
    &quot;gcr.io&quot;: &quot;gcloud&quot;,
    &quot;us.gcr.io&quot;: &quot;gcloud&quot;,
    &quot;eu.gcr.io&quot;: &quot;gcloud&quot;,
    &quot;asia.gcr.io&quot;: &quot;gcloud&quot;,
    &quot;staging-k8s.gcr.io&quot;: &quot;gcloud&quot;,
    &quot;marketplace.gcr.io&quot;: &quot;gcloud&quot;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-the-google-cloud-kubernetes-engine-api">5.6. Enable the Google Cloud Kubernetes Engine API</h3>
<div class="paragraph">
<p>To use Kubernetes Engine API we have to enable it for your project via the Google Cloud CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud services enable container.googleapis.com</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-gke-cluster">5.7. Create GKE cluster</h3>
<div class="paragraph">
<p>In this guide we will create a cluster named <code>micronaut-k8s</code> and we will use two <code>n1-standard-2</code> instances as GKE nodes. Everything will be deployed on your default Google Cloud region. You can check your default region by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">&gt; gcloud config get-value compute/region</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create <code>micronaut-k8s</code> kubernetes cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud container clusters create micronaut-k8s --machine-type n1-standard-2 --num-nodes 2 --disk-type pd-standard</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prepare-and-deploy-microservices">6. Prepare and Deploy Microservices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Set the <code>GCP_PROJECT_ID</code> environment variable to store your GCP project id.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export GCP_PROJECT_ID=&quot;$(gcloud config get-value project)&quot;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="users-microservice">6.1. Users Microservice</h3>
<div class="paragraph">
<p>Export users microservice image repository to the <code>USERS_REPOSITORY</code> environment variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export USERS_REPOSITORY=&quot;gcr.io/$GCP_PROJECT_ID/users&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit <code>k8s.yml</code> inside <code>users</code> service.</p>
</div>
<div class="listingblock">
<div class="title">/users/k8s.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">namespace</span>: <span class="string"><span class="content">micronaut-k8s</span></span>
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>
    <span class="key">spec</span>:
      <span class="key">serviceAccountName</span>: <span class="string"><span class="content">micronaut-service</span></span>
      <span class="key">containers</span>:
        - <span class="string"><span class="content">name: &quot;users&quot;</span></span>
          <span class="key">image</span>: <span class="string"><span class="content">gcr.io/&lt;gcp-project-id&gt;/users:latest </span></span><i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">Always </span></span><i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">ports</span>:
            - <span class="string"><span class="content">name: http</span></span>
              <span class="key">containerPort</span>: <span class="string"><span class="content">8080</span></span>
          <span class="key">readinessProbe</span>:
            <span class="key">httpGet</span>:
              <span class="key">path</span>: <span class="string"><span class="content">/health/readiness</span></span>
              <span class="key">port</span>: <span class="string"><span class="content">8080</span></span>
            <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">timeoutSeconds</span>: <span class="string"><span class="content">3</span></span>
          <span class="key">livenessProbe</span>:
            <span class="key">httpGet</span>:
              <span class="key">path</span>: <span class="string"><span class="content">/health/liveness</span></span>
              <span class="key">port</span>: <span class="string"><span class="content">8080</span></span>
            <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">timeoutSeconds</span>: <span class="string"><span class="content">3</span></span>
            <span class="key">failureThreshold</span>: <span class="string"><span class="content">10</span></span>
      <span class="key">imagePullSecrets</span>:
        - <span class="string"><span class="content">name: gcpsersecret </span></span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">namespace</span>: <span class="string"><span class="content">micronaut-k8s</span></span>
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">NodePort</span></span>
  <span class="key">ports</span>:
    - <span class="string"><span class="content">protocol: &quot;TCP&quot;</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">8080</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Repository URI that we created in GCR container registry. Change <code>&lt;project-id&gt;</code> to your google project id. If you are using UNIX based OS you can achieve this by running <code>sed -i'' -e "s/&lt;gcp-project-id&gt;/$GCP_PROJECT_ID/" users/k8s.yml</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Change imagePullPolicy to Always</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Secret needed to pull images from Google container registry</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-docker-image.html">Build a docker image</a> of the <code>users</code> service with the name <code>users</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ensure that Docker images are constructed for the correct CPU architecture. For instance, if you&#8217;re utilizing Apple Silicon (aarch64), you can consider modifying the <code>DOCKER_DEFAULT_PLATFORM</code> environment variable to the value <code>linux/amd64</code>. Alternatively, you have the option to use ARM (arch64) instances within your Kubernetes cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tag an existing users microservice image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker tag users:latest ${USERS_REPOSITORY}:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Push tagged users microservice image to remote repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker push ${USERS_REPOSITORY}:latest</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="orders-microservice">6.2. Orders Microservice</h3>
<div class="paragraph">
<p>Export orders microservice image repository to the <code>ORDERS_REPOSITORY</code> environment variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export ORDERS_REPOSITORY=&quot;gcr.io/$GCP_PROJECT_ID/orders&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit <code>k8s.yml</code> inside <code>orders</code> service.</p>
</div>
<div class="listingblock">
<div class="title">/orders/k8s.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">namespace</span>: <span class="string"><span class="content">micronaut-k8s</span></span>
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">orders</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">orders</span><span class="delimiter">&quot;</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">orders</span><span class="delimiter">&quot;</span></span>
    <span class="key">spec</span>:
      <span class="key">serviceAccountName</span>: <span class="string"><span class="content">micronaut-service</span></span>
      <span class="key">containers</span>:
        - <span class="string"><span class="content">name: &quot;orders&quot;</span></span>
          <span class="key">image</span>: <span class="string"><span class="content">gcr.io/&lt;gcp-project-id&gt;/orders:latest </span></span><i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">Always </span></span><i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">ports</span>:
            - <span class="string"><span class="content">name: http</span></span>
              <span class="key">containerPort</span>: <span class="string"><span class="content">8080</span></span>
          <span class="key">readinessProbe</span>:
            <span class="key">httpGet</span>:
              <span class="key">path</span>: <span class="string"><span class="content">/health/readiness</span></span>
              <span class="key">port</span>: <span class="string"><span class="content">8080</span></span>
            <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">timeoutSeconds</span>: <span class="string"><span class="content">3</span></span>
          <span class="key">livenessProbe</span>:
            <span class="key">httpGet</span>:
              <span class="key">path</span>: <span class="string"><span class="content">/health/liveness</span></span>
              <span class="key">port</span>: <span class="string"><span class="content">8080</span></span>
            <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">timeoutSeconds</span>: <span class="string"><span class="content">3</span></span>
            <span class="key">failureThreshold</span>: <span class="string"><span class="content">10</span></span>
      <span class="key">imagePullSecrets</span>:
        - <span class="string"><span class="content">name: gcpsersecret </span></span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">namespace</span>: <span class="string"><span class="content">micronaut-k8s</span></span>
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">orders</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">orders</span><span class="delimiter">&quot;</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">NodePort</span></span>
  <span class="key">ports</span>:
    - <span class="string"><span class="content">protocol: &quot;TCP&quot;</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">8080</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Repository URI that we created in GCR container registry. Change <code>&lt;project-id&gt;</code> to your google project id. If you are using UNIX based OS you can achieve this by running <code>sed -i'' -e "s/&lt;gcp-project-id&gt;/$GCP_PROJECT_ID/" orders/k8s.yml</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Change imagePullPolicy to Always</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Secret needed to pull images from Google container registry</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-docker-image.html">Build a docker image</a> of the <code>orders</code> service with the name <code>orders</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ensure that Docker images are constructed for the correct CPU architecture. For instance, if you&#8217;re utilizing Apple Silicon (aarch64), you can consider modifying the <code>DOCKER_DEFAULT_PLATFORM</code> environment variable to the value <code>linux/amd64</code>. Alternatively, you have the option to use ARM (arch64) instances within your Kubernetes cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tag an existing orders microservice image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker tag orders:latest ${ORDERS_REPOSITORY}:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Push tagged orders microservice image to remote repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker push ${ORDERS_REPOSITORY}:latest</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-microservice">6.3. API Microservice</h3>
<div class="paragraph">
<p>Export api microservice image repository to the <code>API_REPOSITORY</code> environment variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export API_REPOSITORY=&quot;gcr.io/$GCP_PROJECT_ID/api&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit <code>k8s.yml</code> inside <code>api</code> service.</p>
</div>
<div class="listingblock">
<div class="title">/api/k8s.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">namespace</span>: <span class="string"><span class="content">micronaut-k8s</span></span>
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api</span><span class="delimiter">&quot;</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api</span><span class="delimiter">&quot;</span></span>
    <span class="key">spec</span>:
      <span class="key">serviceAccountName</span>: <span class="string"><span class="content">micronaut-service</span></span>
      <span class="key">containers</span>:
        - <span class="string"><span class="content">name: &quot;api&quot;</span></span>
          <span class="key">image</span>: <span class="string"><span class="content">gcr.io/&lt;gcp-project-id&gt;/api:latest </span></span><i class="conum" data-value="1"></i><b>(1)</b>
          <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">Always </span></span><i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">ports</span>:
            - <span class="string"><span class="content">name: http</span></span>
              <span class="key">containerPort</span>: <span class="string"><span class="content">8080</span></span>
          <span class="key">readinessProbe</span>:
            <span class="key">httpGet</span>:
              <span class="key">path</span>: <span class="string"><span class="content">/health/readiness</span></span>
              <span class="key">port</span>: <span class="string"><span class="content">8080</span></span>
            <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">timeoutSeconds</span>: <span class="string"><span class="content">3</span></span>
          <span class="key">livenessProbe</span>:
            <span class="key">httpGet</span>:
              <span class="key">path</span>: <span class="string"><span class="content">/health/liveness</span></span>
              <span class="key">port</span>: <span class="string"><span class="content">8080</span></span>
            <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">timeoutSeconds</span>: <span class="string"><span class="content">3</span></span>
            <span class="key">failureThreshold</span>: <span class="string"><span class="content">10</span></span>
      <span class="key">imagePullSecrets</span>:
        - <span class="string"><span class="content">name: gcpsersecret </span></span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">namespace</span>: <span class="string"><span class="content">micronaut-k8s</span></span>
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api</span><span class="delimiter">&quot;</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">app</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api</span><span class="delimiter">&quot;</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">LoadBalancer</span></span>
  <span class="key">ports</span>:
    - <span class="string"><span class="content">protocol: &quot;TCP&quot;</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">8080</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Repository URI that we created in GCR container registry. Change <code>&lt;project-id&gt;</code> to your google project id. If you are using UNIX based OS you can achieve this by running <code>sed -i'' -e "s/&lt;gcp-project-id&gt;/$GCP_PROJECT_ID/" api/k8s.yml</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Change imagePullPolicy to Always</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Secret needed to pull images from Google container registry</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-docker-image.html">Build a docker image</a> of the <code>api</code> service with the name <code>api</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ensure that Docker images are constructed for the correct CPU architecture. For instance, if you&#8217;re utilizing Apple Silicon (aarch64), you can consider modifying the <code>DOCKER_DEFAULT_PLATFORM</code> environment variable to the value <code>linux/amd64</code>. Alternatively, you have the option to use ARM (arch64) instances within your Kubernetes cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tag an existing api microservice image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker tag api:latest ${API_REPOSITORY}:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Push tagged api microservice image to remote repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker push ${API_REPOSITORY}:latest</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-services-to-gke">6.4. Deploy Services to GKE</h3>
<div class="paragraph">
<p>Create a directory for <code>kubectl</code> configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mkdir -p $HOME/.kube</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install kubectl component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud components install kubectl</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generate <code>kubectl</code> configuration for authentication to GKE.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud container clusters get-credentials micronaut-k8s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set the value of <code>KUBECONFIG</code> to the created config file. This variable is consumed by <code>kubectl</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export KUBECONFIG=$HOME/.kube/config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deploy the <em>auth.yml</em> file that we created in the <a href="micronaut-k8s.html">Kubernetes and the Micronaut Framework</a> guide.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl apply -f auth.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a secret named <code>gcpsersecret</code> that will be used for authentication to Google Cloud Container Registry. This is needed because GKE needs credentials to be able to pull microservices images.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl create secret docker-registry gcpsersecret --docker-server=gcr.io \
--docker-username=oauth3accesstoken \
--docker-password=&quot;$(gcloud auth print-access-token)&quot; \
--docker-email=your@email.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to deploy the <code>users</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl apply -f users/k8s.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to deploy the <code>orders</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl apply -f orders/k8s.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to deploy the <code>api</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl apply -f api/k8s.yml</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-integration-between-applications-deployed-on-gke">7. Test integration between applications deployed on GKE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the next command to check status of the pods and make sure that all of them have the status "Running":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl get pods -n=micronaut-k8s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">NAME                      READY   STATUS    RESTARTS   AGE
api-6b884d9c88-hxsdk      1/1     Running   0          21s
orders-54465f845c-k7z5t   1/1     Running   0          24s
users-d8b46cf48-wq6sm     1/1     Running   0          29s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to check the status of the microservices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl get services -n=micronaut-k8s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">NAME     TYPE           CLUSTER-IP     EXTERNAL-IP      PORT(S)          AGE
api      LoadBalancer   10.112.14.49   &lt;redacted&gt;       8080:31299/TCP   37s
orders   NodePort       10.112.2.71    &lt;none&gt;           8080:30613/TCP   40s
users    NodePort       10.112.2.227   &lt;none&gt;           8080:32718/TCP   44s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>If EXTERNAL-IP</code> is in &lt;pending&gt; state wait a couple of seconds and then run command again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the next command to retrieve the URL of the <code>api</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export API_URL=http://$(kubectl get svc api -n=micronaut-k8s -o json | jq -r '.status.loadBalancer.ingress[0].ip'):8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run a cURL command to create a new user via the <code>api</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X &quot;POST&quot; &quot;$API_URL/api/users&quot; -H 'Content-Type: application/json; charset=utf-8' -d '{ &quot;first_name&quot;: &quot;Nemanja&quot;, &quot;last_name&quot;: &quot;Mikic&quot;, &quot;username&quot;: &quot;nmikic&quot; }'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">nmikic</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">first_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Nemanja</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">last_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Mikic</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run a cURL command to a new order via the <code>api</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X &quot;POST&quot; &quot;$API_URL/api/orders&quot; -H 'Content-Type: application/json; charset=utf-8' -d '{ &quot;user_id&quot;: 1, &quot;item_ids&quot;: [1,2] }'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">first_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Nemanja</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">last_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Mikic</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">nmikic</span><span class="delimiter">&quot;</span></span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Banana</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>:<span class="float">1.5</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Kiwi</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>:<span class="float">2.5</span>}],<span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>:<span class="float">4.0</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run a cURL command to list created orders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl &quot;$API_URL/api/orders&quot; -H 'Content-Type: application/json; charset=utf-8'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">first_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Nemanja</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">last_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Mikic</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">nmikic</span><span class="delimiter">&quot;</span></span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Banana</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>:<span class="float">1.5</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Kiwi</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>:<span class="float">2.5</span>}],<span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>:<span class="float">4.0</span>}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can try to place an order for a user who doesn&#8217;t exist (with id 100). Run a cURL command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X &quot;POST&quot; &quot;$API_URL/api/orders&quot; -H 'Content-Type: application/json; charset=utf-8' -d '{ &quot;user_id&quot;: 100, &quot;item_ids&quot;: [1,2] }'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bad Request</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">/api/orders</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">templated</span><span class="delimiter">&quot;</span></span>:<span class="value">false</span>}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">_embedded</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">User with id 100 doesn't exist</span><span class="delimiter">&quot;</span></span>}]}}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cleaning-up">8. Cleaning Up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To delete all resources that were created in this guide run the next command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl delete namespaces micronaut-k8s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to delete <code>users</code> artifacts container repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud container images delete ${USERS_REPOSITORY} --force-delete-tags --quiet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to delete <code>orders</code> artifacts container repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud container images delete ${ORDERS_REPOSITORY} --force-delete-tags --quiet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to delete <code>api</code> artifacts container repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud container images delete ${API_REPOSITORY} --force-delete-tags --quiet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to delete the <code>micronaut-guide</code> GKE cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud container clusters delete micronaut-k8s</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="deleting-the-project">8.1. Deleting the project</h3>
<div class="paragraph">
<p>The easiest way to eliminate billing is to delete the project you created for the tutorial.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Deleting a project has the following consequences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you used an existing project, you&#8217;ll also delete any other work you&#8217;ve done in the project.</p>
</li>
<li>
<p>You can&#8217;t reuse the project ID of a deleted project. If you created a custom project ID that you plan to use in the future, you should delete the resources inside the project instead. This ensures that URLs that use the project ID, such as an appspot.com URL, remain available.</p>
</li>
<li>
<p>If you are exploring multiple tutorials and quickstarts, reusing projects instead of deleting them prevents you from exceeding project quota limits.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="via-the-cli">8.1.1. Via the CLI</h4>
<div class="paragraph">
<p>To delete the project using the Cloud SDK, run the following command, replacing <code>YOUR_PROJECT_ID</code> with the project ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcloud projects delete YOUR_PROJECT_ID</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="via-the-cloud-platform-console">8.1.2. Via the Cloud Platform Console</h4>
<div class="paragraph">
<p>In the Cloud Platform Console, <a href="https://console.cloud.google.com/iam-admin/projects">go to the Projects page</a>.</p>
</div>
<div class="paragraph">
<p>In the project list, select the project you want to delete and click Delete project. After selecting the checkbox next to the project name, click <code>Delete project</code></p>
</div>
<div class="paragraph">
<p>In the dialog, type the project ID, and then click Shut down to delete the project.</p>
</div>
<div class="paragraph">
<p>Deleting or turning off specific resources</p>
</div>
<div class="paragraph">
<p>You can individually delete or turn off some of the resources that you created during the tutorial.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">9. Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Explore more features with <a href="https://micronaut.io/guides/">Micronaut Guides</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.google.com/kubernetes-engine">Google Kubernetes Engine (GKE)</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/container-registry">Google Cloud Container Registry</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/artifact-registry">Google Cloud Artifact Registry</a></p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/">Micronaut Google Cloud Platform (GCP)</a> integration.</p>
</li>
<li>
<p>Read more about <a href="https://micronaut-projects.github.io/micronaut-kubernetes/snapshot/guide/">Micronaut Kubernetes</a> module.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license">10. License</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All guides are released with an <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache license 2.0 license</a> for the code and a <a href="https://creativecommons.org/licenses/by/4.0/deed.en">Creative Commons Attribution 4.0</a> license for the writing and media (images&#8230;&#8203;).
</td>
</tr>
</table>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <a href="https://micronaut.io/foundation/"><img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/></a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li id="menu-item-6740" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6740"><a href="https://fosstodon.org/@micronaut"><i class="fab fa-mastodon"><span class="sr-only">Mastodon</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://discord.gg/9xRFsHv98T"><i class="fab fa-discord"><span class="sr-only">Discord</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>Guides are licensed under <a href="https://creativecommons.org/licenses/by/4.0/deed.en">CC BY 4.0</a> for the writing/media and <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache.2.0</a> for the code</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
