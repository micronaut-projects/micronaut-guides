<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Creating a ToDo application with Micronaut GraphQL</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="alternate" type="application/rss+xml" title="Micronaut Guides RSS Feed" href="https://guides.micronaut.io/latest/rss.xml" />
    <link rel="alternate" type="application/json" title="Micronaut Guides JSON Feed" href="https://guides.micronaut.io/latest/feed.json" />
    <link href="coderay.css" rel="stylesheet" />
    <link href="rouge-github.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="lunr.js"></script>
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronauttwittercard.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="Creating a ToDo application with Micronaut GraphQL"/>
    <meta name="twitter:description" content="Build a TODO application with Micronaut GraphQL."/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item"><a href="https://micronaut.io/download/" class="nav-link">Download</a></li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-2868 dropdown nav-item"><a href="https://micronaut.io/learn/" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a><ul class="dropdown-menu">
                        <li id="menu-item-4943" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4943"><a href="https://micronaut.io/learn/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-5111" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5111"><a href="https://docs.micronaut.io/index.html" class="dropdown-item">User Documentaton</a></li>
                        <li id="menu-item-4510" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4510"><a href="https://micronaut.io/guides/" class="dropdown-item">Guides</a></li>
                        <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896"><a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a></li>
                        <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897"><a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a></li>
                        <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871"><a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a></li>
                        <li id="menu-item-6526" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6526"><a href="https://micronaut-projects.github.io/micronaut-guides-mn3/latest/" class="dropdown-item">Guides for Micronaut Framework 3</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item"><a href="https://micronaut.io/resources/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a><ul class="dropdown-menu">
                        <li id="menu-item-4999" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4999"><a href="https://micronaut.io/upcoming-events/" class="dropdown-item">Upcoming Events</a></li>
                        <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879"><a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a></li>
                        <li id="menu-item-6478" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6478"><a href="https://micronaut.io/category/release-announcements/" class="dropdown-item">Releases</a></li>
                        <li id="menu-item-6715" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6715"><a href="https://micronaut.io/category/security-announcements/" class="dropdown-item">Security Announcements</a></li>
                        <li id="menu-item-4499" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4499"><a href="https://micronautpodcast.com/" class="dropdown-item">Podcast</a></li>
                        <li id="menu-item-5798" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5798"><a href="https://micronaut.io/support/" class="dropdown-item">Commercial Support</a></li>
                        <li id="menu-item-4186" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4186"><a href="https://micronaut.io/resources/community-support/" class="dropdown-item">Community Support</a></li>
                        <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882"><a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a></li>
                        <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883"><a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a></li>
                        <li id="menu-item-6479" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6479"><a href="https://micronaut.io/micronaut-success-stories/" class="dropdown-item">Micronaut Success Stories</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2872 dropdown nav-item"><a href="https://micronaut.io/foundation/" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a><ul class="dropdown-menu">
                        <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2877"><a href="https://micronaut.io/foundation/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874"><a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a></li>
                        <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873"><a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a></li>
                        <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876"><a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a></li>
                        <li id="menu-item-3838" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3838"><a href="https://micronaut.io/meeting-minutes/" class="dropdown-item">Meeting Minutes</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item"><a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a></li>

                </ul>

            </div>

        </nav>

    </div>
</header>

<div style="background: #fff;padding-top: 20px;padding-bottom: 20px;">
    <div class="container" style="clear: both;">
        <fieldset style="float: right;">
            <input type="search" id="search-form-query"/>
            <input type="submit" onclick="search()" value="Search">
            <input type="submit" onclick="resetSearch()" value="Reset">
        </fieldset>
    </div>
    <div class="container" style="clear: both;margin-top: -20px;">
        <div class="guide-list" id="searchResults">
        </div>
    </div>
</div>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-graphql-todo.html">Creating a ToDo application with Micronaut GraphQL</a> » <span class="breadcrumb_last" aria-current="page">maven | kotlin</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#writing-the-application">4. Writing the Application</a></li>
<li><a href="#persistence-layer">5. Persistence layer</a>
<ul class="sectlevel2">
<li><a href="#database-migration-with-flyway">5.1. Database Migration with Flyway</a></li>
<li><a href="#entities">5.2. Entities</a></li>
<li><a href="#repositories">5.3. Repositories</a></li>
</ul>
</li>
<li><a href="#graphql">6. GraphQL</a>
<ul class="sectlevel2">
<li><a href="#describe-your-schema">6.1. Describe your schema</a></li>
<li><a href="#data-fetchers">6.2. Data Fetchers</a></li>
<li><a href="#graphql-factory">6.3. GraphQL Factory</a></li>
</ul>
</li>
<li><a href="#test-resources">7. Test Resources</a></li>
<li><a href="#running-the-application">8. Running the Application</a></li>
<li><a href="#test-the-application">9. Test the application</a>
<ul class="sectlevel2">
<li><a href="#manual-smoke-tests">9.1. Manual smoke tests</a></li>
<li><a href="#automated-tests">9.2. Automated tests</a></li>
</ul>
</li>
<li><a href="#graphiql">10. GraphiQL</a></li>
<li><a href="#generate-a-micronaut-application-native-executable-with-graalvm">11. Generate a Micronaut Application Native Executable with GraalVM</a>
<ul class="sectlevel2">
<li><a href="#graalvm-installation">11.1. GraalVM Installation</a></li>
<li><a href="#native-executable-generation">11.2. Native Executable Generation</a></li>
</ul>
</li>
<li><a href="#next-steps">12. Next Steps</a></li>
<li><a href="#help-with-the-micronaut-framework">13. Help with the Micronaut Framework</a></li>
<li><a href="#license">14. License</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Creating a ToDo application with Micronaut GraphQL</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Build a TODO application with Micronaut GraphQL.</p>
</div>
<div class="paragraph">
<p>Authors: Sergio del Amo, Tim Yates</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 4.9.1</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, you will create a Micronaut application written in Kotlin that uses <a href="https://graphql.org/">GraphQL</a> to create a todo application.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data. GraphQL provides
a complete and understandable description of the data in your API, gives clients the power to ask for exactly what they
need and nothing more, makes it easier to evolve APIs over time, and enables powerful developer tools.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>You will be using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A PostgreSQL instance provided by <a href="#test-resources">Test Resources</a> and running in Docker.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/">Micronaut Data</a> to persist our ToDos to this database.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/">Flyway</a> to handle our database migrations.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-graphql/latest/guide/">Micronaut GraphQL</a> to expose our data.</p>
</li>
<li>
<p>Testcontainers to run a PostgreSQL instance for local dev, and tests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application will expose a GraphQL endpoint at <code>/graphql</code> for the data to be consumed and modified.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE (e.g. <a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">IntelliJ IDEA</a>)</p>
</li>
<li>
<p>JDK 21 or greater installed with <code>JAVA_HOME</code> <a href="https://www.baeldung.com/java-home-on-windows-7-8-10-mac-os-x-linux">configured appropriately</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-graphql-todo-maven-kotlin.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-application">4. Writing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an application using the <a href="https://docs.micronaut.io/latest/guide/#cli">Micronaut Command Line Interface</a> or with <a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mn create-app example.micronaut.micronautguide <span class="se">\</span>
    <span class="nt">--features</span><span class="o">=</span>graphql,data-jdbc,flyway,postgres,validation,graalvm <span class="se">\</span>
    <span class="nt">--build</span><span class="o">=</span>maven <span class="se">\</span>
    <span class="nt">--lang</span><span class="o">=</span>kotlin <span class="se">\</span>
    <span class="nt">--test</span><span class="o">=</span>junit</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle with the <a href="https://docs.gradle.org/current/userguide/kotlin_dsl.html">Kotlin DSL</a> is used as the build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as the language.<br/> If you don&#8217;t specify the <code>--test</code> argument, JUnit is used for Java and Kotlin, and Spock is used for Groovy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command creates a Micronaut application with the default package <code>example.micronaut</code> in a directory named <code>micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>If you use Micronaut Launch, select Micronaut Application as application type and add <code>graphql</code>, <code>data-jdbc</code>, <code>flyway</code>, <code>postgres</code>, <code>validation</code>, and <code>graalvm</code> features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have an existing Micronaut application and want to add the functionality described here, you can view the dependency and configuration changes from the specified features, and apply those changes to your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://micronaut.io/launch?features=graphql&amp;features=data-jdbc&amp;features=flyway&amp;features=postgres&amp;features=validation&amp;features=graalvm&amp;lang=KOTLIN&amp;build=MAVEN&amp;test=JUNIT&amp;name=micronautguide&amp;type=DEFAULT&amp;package=example.micronaut&amp;activity=diff" target="_blank" rel="noopener">Diff</a></p>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">Setup IntelliJ IDEA to develop Micronaut Applications</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persistence-layer">5. Persistence layer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="database-migration-with-flyway">5.1. Database Migration with Flyway</h3>
<div class="paragraph">
<p>We need a way to create the database schema. For that, we use <a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/">Micronaut integration with Flyway</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://www.flywaydb.org">Flyway</a> automates schema changes, significantly simplifying schema management tasks, such as migrating, rolling back, and reproducing in multiple environments.</p>
</div>
<div class="paragraph">
<p>Add the following snippet to include the necessary dependencies:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.micronaut.flyway<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>micronaut-flyway<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We will enable Flyway in the Micronaut configuration file and configure it to perform migrations on one of the defined data sources.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><i class="conum" data-value="1"></i><b>(1)</b>
<span class="py">flyway.datasources.default.enabled</span><span class="p">=</span><span class="s">true</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable Flyway for the <code>default</code> datasource.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Configuring multiple data sources is as simple as enabling Flyway for each one. You can also specify directories that will be used for migrating each data source. Review the <a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/">Micronaut Flyway documentation</a> for additional details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Flyway migration will be automatically triggered before your Micronaut application starts. Flyway will read migration commands in the <code>resources/db/migration/</code> directory, execute them if necessary, and verify that the configured data source is consistent with them.</p>
</div>
<div class="paragraph">
<p>Create the following migration files with the database schema creation:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/db/migration/V1__schema.sql</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">author</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="p">(</span>
    <span class="n">id</span>       <span class="nb">BIGINT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="k">GENERATED</span> <span class="k">BY</span> <span class="k">DEFAULT</span> <span class="k">AS</span> <span class="k">IDENTITY</span><span class="p">,</span>
    <span class="n">username</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">to_do</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="p">(</span>
    <span class="n">id</span>        <span class="nb">BIGINT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="k">GENERATED</span> <span class="k">BY</span> <span class="k">DEFAULT</span> <span class="k">AS</span> <span class="k">IDENTITY</span><span class="p">,</span>
    <span class="n">title</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">completed</span> <span class="nb">BOOLEAN</span>      <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">author_id</span> <span class="nb">BIGINT</span> <span class="k">REFERENCES</span> <span class="n">author</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Authors will be stored in table separate to the ToDos.  They just have a username.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>ToDos have a title, completion status, and a foreign-key reference to the author.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="entities">5.2. Entities</h3>
<div class="paragraph">
<p>Create an Entity class to represent an Author:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/Author.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.data.annotation.GeneratedValue</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.annotation.GeneratedValue.Type.AUTO</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.annotation.Id</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.annotation.MappedEntity</span>
<span class="k">import</span> <span class="nn">jakarta.validation.constraints.NotNull</span>

<span class="nd">@MappedEntity</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">Author</span><span class="p">(</span><span class="kd">val</span> <span class="py">username</span><span class="p">:</span> <span class="nd">@NotNull</span> <span class="nc">String</span><span class="p">?)</span> <span class="p">{</span>

    <span class="nd">@Id</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="nc">AUTO</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MappedEntity</code> to map the class to the table defined in the schema.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the ID of an entity</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And another to represent a ToDo:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/ToDo.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.data.annotation.GeneratedValue</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.annotation.GeneratedValue.Type.AUTO</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.annotation.Id</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.annotation.MappedEntity</span>

<span class="nd">@MappedEntity</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">ToDo</span><span class="p">(</span><span class="kd">var</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">authorId</span><span class="p">:</span> <span class="nc">Long</span><span class="p">)</span> <span class="p">{</span>

    <span class="nd">@Id</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="nc">AUTO</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

    <span class="kd">var</span> <span class="py">completed</span> <span class="p">=</span> <span class="k">false</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MappedEntity</code> to map the class to the table defined in the schema.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the ID of an entity</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="repositories">5.3. Repositories</h3>
<div class="paragraph">
<p>Create a <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/#dbcRepositories"><code>JdbcRepository</code></a> for each of our Entity classes.</p>
</div>
<div class="paragraph">
<p>The simplest of these is the <code>ToDoRepository</code> which just requires the default methods:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/ToDoRepository.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.data.jdbc.annotation.JdbcRepository</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.model.query.builder.sql.Dialect.POSTGRES</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.repository.PageableRepository</span>

<span class="nd">@JdbcRepository</span><span class="p">(</span><span class="n">dialect</span> <span class="p">=</span> <span class="nc">POSTGRES</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">interface</span> <span class="nc">ToDoRepository</span> <span class="p">:</span> <span class="nc">PageableRepository</span><span class="p">&lt;</span><span class="nc">ToDo</span><span class="p">,</span> <span class="nc">Long</span><span class="p">&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@JdbcRepository</code> with a specific dialect.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By extending <code>CrudRepository</code> you enable automatic generation of CRUD (Create, Read, Update, Delete) operations.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then create a Repository for the Authors.  This requires extra finders for this to simplify the GraphQL wiring in the next step:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/AuthorRepository.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.data.jdbc.annotation.JdbcRepository</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.model.query.builder.sql.Dialect.POSTGRES</span>
<span class="k">import</span> <span class="nn">io.micronaut.data.repository.CrudRepository</span>

<span class="nd">@JdbcRepository</span><span class="p">(</span><span class="n">dialect</span> <span class="p">=</span> <span class="nc">POSTGRES</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">AuthorRepository</span> <span class="p">:</span> <span class="nc">CrudRepository</span><span class="p">&lt;</span><span class="nc">Author</span><span class="p">,</span> <span class="nc">Long</span><span class="p">&gt;</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">findByUsername</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Author</span><span class="p">?</span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">findByIdIn</span><span class="p">(</span><span class="n">ids</span><span class="p">:</span> <span class="nc">Collection</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;):</span> <span class="nc">Collection</span><span class="p">&lt;</span><span class="nc">Author</span><span class="p">&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="k">fun</span> <span class="nf">findOrCreate</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Author</span> <span class="p">{</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="k">return</span> <span class="nf">findByUsername</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="o">?:</span> <span class="nf">save</span><span class="p">(</span><span class="nc">Author</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@JdbcRepository</code> with a specific dialect.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By extending <code>CrudRepository</code> you enable automatic generation of CRUD (Create, Read, Update, Delete) operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When creating todos a method is required to search for an existing username.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>When GraphQL loads a ToDo, it use this to fetch the authors if they are required in the response.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Find an existing author, or else create a new one when creating a ToDo.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graphql">6. GraphQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The initial Micronaut application <code>create-app</code> step already added the GraphQL dependency:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.micronaut.graphql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>micronaut-graphql<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So the default GraphQL endpoint <code>/graphql</code> is enabled, and extra configuration is not required.</p>
</div>
<div class="sect2">
<h3 id="describe-your-schema">6.1. Describe your schema</h3>
<div class="paragraph">
<p>Create the file <code>schema.graphqls</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/schema.graphqls</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="graphqls">type Query {
    toDos: [ToDo!]! <i class="conum" data-value="1"></i><b>(1)</b>
}

type Mutation {
    createToDo(title: String!, author: String!): ToDo  <i class="conum" data-value="2"></i><b>(2)</b>
    completeToDo(id: ID!): Boolean!  <i class="conum" data-value="3"></i><b>(3)</b>
}

type ToDo { <i class="conum" data-value="4"></i><b>(4)</b>
    id: ID!
    title: String!
    completed: Boolean!
    author: Author!
}

type Author { <i class="conum" data-value="5"></i><b>(5)</b>
    id: ID!
    username: String!
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare a <code>toDos</code> query function to fetch all the todos as a list.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare a <code>createToDo</code> mutation function to create and return a new ToDo.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declare a <code>completeToDo</code> mutation function to mark a ToDo as done (and return a boolean indicating success).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Declare a <code>ToDo</code> type.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Declare an <code>Author</code> type.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="data-fetchers">6.2. Data Fetchers</h3>
<div class="paragraph">
<p>For each query and mutator in the schema, create a <code>DataFetcher</code> which will bind the GraphQL schema to our domain model.
These will execute the appropriate queries in the datastore.</p>
</div>
<div class="sect3">
<h4 id="queries">6.2.1. Queries</h4>
<div class="paragraph">
<p>Create class <code>ToDosDataFetcher</code> to implement the <code>toDos</code> query:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/ToDosDataFetcher.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">graphql.schema.DataFetcher</span>
<span class="k">import</span> <span class="nn">graphql.schema.DataFetchingEnvironment</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Singleton</span>

<span class="nd">@Singleton</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">ToDosDataFetcher</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">toDoRepository</span><span class="p">:</span> <span class="nc">ToDoRepository</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="p">)</span> <span class="p">:</span> <span class="nc">DataFetcher</span><span class="p">&lt;</span><span class="nc">Iterable</span><span class="p">&lt;</span><span class="nc">ToDo</span><span class="p">?&gt;&gt;</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="nc">DataFetchingEnvironment</span><span class="p">):</span> <span class="nc">Iterable</span><span class="p">&lt;</span><span class="nc">ToDo</span><span class="p">?&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">toDoRepository</span><span class="p">.</span><span class="nf">findAll</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use constructor injection to inject a bean of type <code>ToDoRepository</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="mutations">6.2.2. Mutations</h4>
<div class="paragraph">
<p>Create <code>CreateToDoDataFetcher</code> for the creation of ToDos:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/CreateToDoDataFetcher.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">graphql.schema.DataFetcher</span>
<span class="k">import</span> <span class="nn">graphql.schema.DataFetchingEnvironment</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Singleton</span>
<span class="k">import</span> <span class="nn">jakarta.transaction.Transactional</span>

<span class="nd">@Singleton</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="k">open</span> <span class="kd">class</span> <span class="nc">CreateToDoDataFetcher</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">toDoRepository</span><span class="p">:</span> <span class="nc">ToDoRepository</span><span class="p">,</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">authorRepository</span><span class="p">:</span> <span class="nc">AuthorRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">DataFetcher</span><span class="p">&lt;</span><span class="nc">ToDo</span><span class="p">&gt;</span> <span class="p">{</span>

    <span class="nd">@Transactional</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="nc">DataFetchingEnvironment</span><span class="p">):</span> <span class="nc">ToDo</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">title</span> <span class="p">=</span> <span class="n">env</span><span class="p">.</span><span class="n">getArgument</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;(</span><span class="s">"title"</span><span class="p">)</span><span class="o">!!</span>
        <span class="kd">val</span> <span class="py">username</span> <span class="p">=</span> <span class="n">env</span><span class="p">.</span><span class="n">getArgument</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;(</span><span class="s">"author"</span><span class="p">)</span><span class="o">!!</span>
        <span class="kd">val</span> <span class="py">author</span> <span class="p">=</span> <span class="n">authorRepository</span><span class="p">.</span><span class="nf">findOrCreate</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="kd">val</span> <span class="py">toDo</span> <span class="p">=</span> <span class="nc">ToDo</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="p">.</span><span class="n">id</span><span class="o">!!</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">toDoRepository</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">toDo</span><span class="p">)</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use constructor injection to inject a bean of type <code>ToDoRepository</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Find the existing author or create a new one.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Persist the new ToDo.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And <code>CompleteToDoDataFetcher</code> to mark ToDos as complete:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/CompleteToDoDataFetcher.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">graphql.schema.DataFetcher</span>
<span class="k">import</span> <span class="nn">graphql.schema.DataFetchingEnvironment</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Singleton</span>

<span class="nd">@Singleton</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">CompleteToDoDataFetcher</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">toDoRepository</span><span class="p">:</span> <span class="nc">ToDoRepository</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="p">)</span> <span class="p">:</span> <span class="nc">DataFetcher</span><span class="p">&lt;</span><span class="nc">Boolean</span><span class="p">&gt;</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="nc">DataFetchingEnvironment</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">id</span> <span class="p">=</span> <span class="n">env</span><span class="p">.</span><span class="n">getArgument</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;(</span><span class="s">"id"</span><span class="p">)</span><span class="o">!!</span><span class="p">.</span><span class="nf">toLong</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">toDoRepository</span>
            <span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">todo</span> <span class="p">-&gt;</span> <span class="nf">setCompletedAndUpdate</span><span class="p">(</span><span class="n">todo</span><span class="o">!!</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">.</span><span class="nf">orElse</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">setCompletedAndUpdate</span><span class="p">(</span><span class="n">todo</span><span class="p">:</span> <span class="nc">ToDo</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="n">todo</span><span class="p">.</span><span class="n">completed</span> <span class="p">=</span> <span class="k">true</span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="n">toDoRepository</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="k">return</span> <span class="k">true</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use constructor injection to inject a bean of type <code>ToDoRepository</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Find the existing ToDo based on its id.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If found, set completed.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>And update the version in the database.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="wiring">6.2.3. Wiring</h4>
<div class="paragraph">
<p>GraphQL allows data to be fetched on demand.
In this example, a user may request a list of ToDos, but not require the author to be populated.
A method is required to optionally load Authors based on their ID.</p>
</div>
<div class="paragraph">
<p>To do this, register a DataLoader that finds authors based on a collection of ids:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/AuthorDataLoader.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.scheduling.TaskExecutors</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Named</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Singleton</span>
<span class="k">import</span> <span class="nn">org.dataloader.MappedBatchLoader</span>
<span class="k">import</span> <span class="nn">java.util.concurrent.CompletableFuture</span>
<span class="k">import</span> <span class="nn">java.util.concurrent.CompletionStage</span>
<span class="k">import</span> <span class="nn">java.util.concurrent.ExecutorService</span>

<span class="nd">@Singleton</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">AuthorDataLoader</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">authorRepository</span><span class="p">:</span> <span class="nc">AuthorRepository</span><span class="p">,</span>
    <span class="nd">@Named</span><span class="p">(</span><span class="nc">TaskExecutors</span><span class="p">.</span><span class="nc">BLOCKING</span><span class="p">)</span> <span class="kd">val</span> <span class="py">executor</span><span class="p">:</span> <span class="nc">ExecutorService</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="p">)</span> <span class="p">:</span> <span class="nc">MappedBatchLoader</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">,</span> <span class="nc">Author</span><span class="p">&gt;</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">load</span><span class="p">(</span><span class="n">keys</span><span class="p">:</span> <span class="nc">MutableSet</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;):</span> <span class="nc">CompletionStage</span><span class="p">&lt;</span><span class="nc">Map</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">,</span> <span class="nc">Author</span><span class="p">&gt;&gt;</span> <span class="p">=</span>
        <span class="nc">CompletableFuture</span><span class="p">.</span><span class="nf">supplyAsync</span><span class="p">({</span>
            <span class="n">authorRepository</span>
                <span class="p">.</span><span class="nf">findByIdIn</span><span class="p">(</span><span class="n">keys</span><span class="p">.</span><span class="nf">toList</span><span class="p">())</span>
                <span class="p">.</span><span class="nf">associateBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span><span class="o">!!</span> <span class="p">}</span>
        <span class="p">},</span> <span class="n">executor</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>IO</code> executor service.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is registered in the DataLoaderRegistry under the key <code>author</code></p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/DataLoaderRegistryFactory.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.context.annotation.Factory</span>
<span class="k">import</span> <span class="nn">io.micronaut.runtime.http.scope.RequestScope</span>
<span class="k">import</span> <span class="nn">org.dataloader.DataLoader</span>
<span class="k">import</span> <span class="nn">org.dataloader.DataLoaderRegistry</span>
<span class="k">import</span> <span class="nn">org.slf4j.LoggerFactory</span>

<span class="nd">@Factory</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">DataLoaderRegistryFactory</span> <span class="p">{</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">LOG</span> <span class="p">=</span> <span class="nc">LoggerFactory</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="nc">DataLoaderRegistryFactory</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nd">@Suppress</span><span class="p">(</span><span class="s">"unused"</span><span class="p">)</span>
    <span class="nd">@RequestScope</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="k">fun</span> <span class="nf">dataLoaderRegistry</span><span class="p">(</span><span class="n">authorDataLoader</span><span class="p">:</span> <span class="nc">AuthorDataLoader</span><span class="p">):</span> <span class="nc">DataLoaderRegistry</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">dataLoaderRegistry</span> <span class="p">=</span> <span class="nc">DataLoaderRegistry</span><span class="p">()</span>
        <span class="n">dataLoaderRegistry</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span>
            <span class="s">"author"</span><span class="p">,</span>
            <span class="nc">DataLoader</span><span class="p">.</span><span class="nf">newMappedDataLoader</span><span class="p">(</span><span class="n">authorDataLoader</span><span class="p">)</span>
        <span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="nc">LOG</span><span class="p">.</span><span class="nf">trace</span><span class="p">(</span><span class="s">"Created new data loader registry"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dataLoaderRegistry</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A class annotated with the <code>@Factory</code> annotated is a factory. It provides one or more methods annotated with a bean scope annotation (e.g. <code>@Singleton</code>). Read more about <a href="https://docs.micronaut.io/latest/guide/#factories">Bean factories</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This registry has request scope, so a new one will be created for every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register the AuthorDataLoader whenever the loader for <code>"author"</code> is requested.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add an <code>AuthorDataFetcher</code> which requests and uses this loader to populate a <code>ToDo</code> if the author when required.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/AuthorDataFetcher.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">graphql.schema.DataFetcher</span>
<span class="k">import</span> <span class="nn">graphql.schema.DataFetchingEnvironment</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Singleton</span>
<span class="k">import</span> <span class="nn">java.util.concurrent.CompletionStage</span>

<span class="nd">@Singleton</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">AuthorDataFetcher</span> <span class="p">:</span> <span class="nc">DataFetcher</span><span class="p">&lt;</span><span class="nc">CompletionStage</span><span class="p">&lt;</span><span class="nc">Author</span><span class="p">&gt;&gt;</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">environment</span><span class="p">:</span> <span class="nc">DataFetchingEnvironment</span><span class="p">):</span> <span class="nc">CompletionStage</span><span class="p">&lt;</span><span class="nc">Author</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">toDo</span><span class="p">:</span> <span class="nc">ToDo</span> <span class="p">=</span> <span class="n">environment</span><span class="p">.</span><span class="nf">getSource</span><span class="p">()</span><span class="o">!!</span>
        <span class="kd">val</span> <span class="py">authorDataLoader</span> <span class="p">=</span> <span class="n">environment</span><span class="p">.</span><span class="n">getDataLoader</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">,</span> <span class="nc">Author</span><span class="p">&gt;(</span><span class="s">"author"</span><span class="p">)</span><span class="o">!!</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">return</span> <span class="n">authorDataLoader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">toDo</span><span class="p">.</span><span class="n">authorId</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the author data loader defined above in the Factory.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="graphql-factory">6.3. GraphQL Factory</h3>
<div class="paragraph">
<p>Finally, create a factory class that will bind the GraphQL schema to the code, types and fetchers.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GraphQLFactory.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">graphql.GraphQL</span>
<span class="k">import</span> <span class="nn">graphql.schema.idl.*</span>
<span class="k">import</span> <span class="nn">graphql.schema.idl.errors.SchemaMissingError</span>
<span class="k">import</span> <span class="nn">io.micronaut.context.annotation.Factory</span>
<span class="k">import</span> <span class="nn">io.micronaut.core.io.ResourceResolver</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Singleton</span>
<span class="k">import</span> <span class="nn">java.io.BufferedReader</span>
<span class="k">import</span> <span class="nn">java.io.InputStreamReader</span>

<span class="nd">@Factory</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">GraphQLFactory</span> <span class="p">{</span>

    <span class="nd">@Singleton</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="k">fun</span> <span class="nf">graphQL</span><span class="p">(</span>
        <span class="n">resourceResolver</span><span class="p">:</span> <span class="nc">ResourceResolver</span><span class="p">,</span>
        <span class="n">toDosDataFetcher</span><span class="p">:</span> <span class="nc">ToDosDataFetcher</span><span class="p">,</span>
        <span class="n">createToDoDataFetcher</span><span class="p">:</span> <span class="nc">CreateToDoDataFetcher</span><span class="p">,</span>
        <span class="n">completeToDoDataFetcher</span><span class="p">:</span> <span class="nc">CompleteToDoDataFetcher</span><span class="p">,</span>
        <span class="n">authorDataFetcher</span><span class="p">:</span> <span class="nc">AuthorDataFetcher</span>
    <span class="p">):</span> <span class="nc">GraphQL</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">schemaParser</span> <span class="p">=</span> <span class="nc">SchemaParser</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">schemaGenerator</span> <span class="p">=</span> <span class="nc">SchemaGenerator</span><span class="p">()</span>

        <span class="c1">// Load the schema</span>
        <span class="kd">val</span> <span class="py">schemaDefinition</span> <span class="p">=</span> <span class="n">resourceResolver</span>
            <span class="p">.</span><span class="nf">getResourceAsStream</span><span class="p">(</span><span class="s">"classpath:schema.graphqls"</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">orElseThrow</span> <span class="p">{</span> <span class="nc">SchemaMissingError</span><span class="p">()</span> <span class="p">}</span>

        <span class="c1">// Parse the schema and merge it into a type registry</span>
        <span class="kd">val</span> <span class="py">typeRegistry</span> <span class="p">=</span> <span class="nc">TypeDefinitionRegistry</span><span class="p">()</span>
        <span class="n">typeRegistry</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">schemaParser</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nc">BufferedReader</span><span class="p">(</span><span class="nc">InputStreamReader</span><span class="p">(</span><span class="n">schemaDefinition</span><span class="p">))))</span>

        <span class="c1">// Create the runtime wiring.</span>
        <span class="kd">val</span> <span class="py">runtimeWiring</span> <span class="p">=</span> <span class="nc">RuntimeWiring</span><span class="p">.</span><span class="nf">newRuntimeWiring</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">type</span><span class="p">(</span><span class="s">"Query"</span><span class="p">)</span> <span class="p">{</span> <span class="n">typeWiring</span><span class="p">:</span> <span class="nc">TypeRuntimeWiring</span><span class="p">.</span><span class="nc">Builder</span> <span class="p">-&gt;</span>  <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="n">typeWiring</span>
                    <span class="p">.</span><span class="nf">dataFetcher</span><span class="p">(</span><span class="s">"toDos"</span><span class="p">,</span> <span class="n">toDosDataFetcher</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="p">.</span><span class="nf">type</span><span class="p">(</span><span class="s">"Mutation"</span><span class="p">)</span> <span class="p">{</span> <span class="n">typeWiring</span><span class="p">:</span> <span class="nc">TypeRuntimeWiring</span><span class="p">.</span><span class="nc">Builder</span> <span class="p">-&gt;</span>  <i class="conum" data-value="4"></i><b>(4)</b>
                <span class="n">typeWiring</span>
                    <span class="p">.</span><span class="nf">dataFetcher</span><span class="p">(</span><span class="s">"createToDo"</span><span class="p">,</span> <span class="n">createToDoDataFetcher</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">dataFetcher</span><span class="p">(</span><span class="s">"completeToDo"</span><span class="p">,</span> <span class="n">completeToDoDataFetcher</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="p">.</span><span class="nf">type</span><span class="p">(</span><span class="s">"ToDo"</span><span class="p">)</span> <span class="p">{</span> <span class="n">typeWiring</span><span class="p">:</span> <span class="nc">TypeRuntimeWiring</span><span class="p">.</span><span class="nc">Builder</span> <span class="p">-&gt;</span>  <i class="conum" data-value="5"></i><b>(5)</b>
                <span class="n">typeWiring</span>
                    <span class="p">.</span><span class="nf">dataFetcher</span><span class="p">(</span><span class="s">"author"</span><span class="p">,</span> <span class="n">authorDataFetcher</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>

        <span class="c1">// Create the executable schema.</span>
        <span class="kd">val</span> <span class="py">graphQLSchema</span> <span class="p">=</span> <span class="n">schemaGenerator</span><span class="p">.</span><span class="nf">makeExecutableSchema</span><span class="p">(</span><span class="n">typeRegistry</span><span class="p">,</span> <span class="n">runtimeWiring</span><span class="p">)</span>

        <span class="c1">// Return the GraphQL bean.</span>
        <span class="k">return</span> <span class="nc">GraphQL</span><span class="p">.</span><span class="nf">newGraphQL</span><span class="p">(</span><span class="n">graphQLSchema</span><span class="p">).</span><span class="nf">build</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A class annotated with the <code>@Factory</code> annotated is a factory. It provides one or more methods annotated with a bean scope annotation (e.g. <code>@Singleton</code>). Read more about <a href="https://docs.micronaut.io/latest/guide/#factories">Bean factories</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Wire up the query behavior.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Wire up each mutators.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Wire up how to populate a ToDo with authors if they are requested.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-resources">7. Test Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the application is started locally&#8201;&#8212;&#8201;either under test or by <a href="#running-the-application">running the application</a>&#8201;&#8212;&#8201;resolution of the datasource URL is detected and the Test Resources service will start a local PostgreSQL docker container, and inject the properties required to use this as the datasource.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://micronaut-projects.github.io/micronaut-test-resources/snapshot/guide/#modules-databases-jdbc">JDBC section of the Test Resources documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-application">8. Running the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the application, use the <code>./mvnw mn:run</code> command, which starts the application on port 8080.</p>
</div>
<div class="paragraph">
<p>When the application first runs, you will see in the logs that the migrations have been performed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-the-application">9. Test the application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="manual-smoke-tests">9.1. Manual smoke tests</h3>
<div class="paragraph">
<p>Formulate a GraphQL query to retrieve all the current ToDos (there will be none to start with)</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="err">query</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="err">toDos</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">title</span><span class="p">,</span><span class="w">
    </span><span class="err">completed</span><span class="p">,</span><span class="w">
    </span><span class="err">author</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="err">username</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the following cURL request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-X</span> POST <span class="s1">'http://localhost:8080/graphql'</span> <span class="se">\</span>
     <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
     <span class="nt">--data-binary</span> <span class="s1">'{"query":"{ toDos { title, completed, author { username } } }"}'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"data"</span><span class="p">:{</span><span class="nl">"toDos"</span><span class="p">:[]}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a ToDo, by issuing a mutation query and return the ID of the newly created ToDo:</p>
</div>
<div class="listingblock">
<div class="title">GraphQL Query</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="err">mutation</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="err">createToDo(title:</span><span class="w"> </span><span class="s2">"Create GraphQL Guide"</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="s2">"Tim Yates"</span><span class="err">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">id</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which translates to this cURL command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-X</span> POST <span class="s1">'http://localhost:8080/graphql'</span> <span class="se">\</span>
     <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
     <span class="nt">--data-binary</span> <span class="s1">'{"query":"mutation { createToDo(title:\"Create GraphQL Guide\", author:\"Tim Yates\") { id } }"}'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"data"</span><span class="p">:{</span><span class="nl">"createToDo"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This new ToDo then appears in the list of all ToDos with <code>completed</code> set to false:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-X</span> POST <span class="s1">'http://localhost:8080/graphql'</span> <span class="se">\</span>
     <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
     <span class="nt">--data-binary</span> <span class="s1">'{"query":"{ toDos { title, completed, author { username } } }"}'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"data"</span><span class="p">:{</span><span class="nl">"toDos"</span><span class="p">:[{</span><span class="nl">"title"</span><span class="p">:</span><span class="s2">"Create GraphQL Guide"</span><span class="p">,</span><span class="nl">"completed"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"author"</span><span class="p">:{</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"Tim Yates"</span><span class="p">}}]}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mark it as completed by using this query with the ID from above:</p>
</div>
<div class="listingblock">
<div class="title">GraphQL query</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="err">mutation</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="err">completeToDo(id:</span><span class="w"> </span><span class="mi">1</span><span class="err">)</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-X</span> POST <span class="s1">'http://localhost:8080/graphql'</span> <span class="se">\</span>
     <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
     <span class="nt">--data-binary</span> <span class="s1">'{"query":"mutation { completeToDo(id: 1) }"}'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"data"</span><span class="p">:{</span><span class="nl">"completeToDo"</span><span class="p">:</span><span class="kc">true</span><span class="p">}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check this has been persisted in our model:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-X</span> POST <span class="s1">'http://localhost:8080/graphql'</span> <span class="se">\</span>
     <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
     <span class="nt">--data-binary</span> <span class="s1">'{"query":"{ toDos { title, completed } }"}'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"data"</span><span class="p">:{</span><span class="nl">"toDos"</span><span class="p">:[{</span><span class="nl">"title"</span><span class="p">:</span><span class="s2">"Create GraphQL Guide"</span><span class="p">,</span><span class="nl">"completed"</span><span class="p">:</span><span class="kc">true</span><span class="p">}]}}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="automated-tests">9.2. Automated tests</h3>
<div class="paragraph">
<p>For testing the application use the Micronaut HTTP Client to send a <code>POST</code> request to the <code>/graphql</code> endpoint.
Create the following class:</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/GraphQLControllerTest.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.core.type.Argument</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpRequest</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpResponse</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpStatus</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.client.HttpClient</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.client.annotation.Client</span>
<span class="k">import</span> <span class="nn">io.micronaut.test.extensions.junit5.annotation.MicronautTest</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Inject</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions.assertEquals</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions.assertTrue</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions.assertFalse</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>

<span class="nd">@MicronautTest</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="k">internal</span> <span class="kd">class</span> <span class="nc">GraphQLControllerTest</span><span class="p">(</span><span class="nd">@Client</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="kd">val</span> <span class="py">client</span><span class="p">:</span> <span class="nc">HttpClient</span><span class="p">)</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="nd">@Test</span>
    <span class="k">fun</span> <span class="nf">testGraphQLController</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// when:</span>
        <span class="kd">var</span> <span class="py">todos</span> <span class="p">=</span> <span class="n">allTodos</span>

        <span class="c1">// then:</span>
        <span class="nf">assertTrue</span><span class="p">(</span><span class="n">todos</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span>

        <span class="c1">// when:</span>
        <span class="kd">val</span> <span class="py">id</span> <span class="p">=</span> <span class="nf">createToDo</span><span class="p">(</span><span class="s">"Test GraphQL"</span><span class="p">,</span> <span class="s">"Tim Yates"</span><span class="p">)</span>

        <span class="c1">// then: (check it's a UUID)</span>
        <span class="nf">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>

        <span class="c1">// when:</span>
        <span class="n">todos</span> <span class="p">=</span> <span class="n">allTodos</span>

        <span class="c1">// then:</span>
        <span class="nf">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">todos</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
        <span class="kd">var</span> <span class="py">todo</span> <span class="p">=</span> <span class="n">todos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nf">assertEquals</span><span class="p">(</span><span class="s">"Test GraphQL"</span><span class="p">,</span> <span class="n">todo</span><span class="p">[</span><span class="s">"title"</span><span class="p">])</span>
        <span class="nf">assertFalse</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="nc">Boolean</span><span class="p">.</span><span class="nf">parseBoolean</span><span class="p">(</span><span class="n">todo</span><span class="p">[</span><span class="s">"completed"</span><span class="p">].</span><span class="nf">toString</span><span class="p">()))</span>
        <span class="nf">assertEquals</span><span class="p">(</span>
            <span class="s">"Tim Yates"</span><span class="p">,</span>
            <span class="p">(</span><span class="n">todo</span><span class="p">[</span><span class="s">"author"</span><span class="p">]</span> <span class="k">as</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="err">*</span><span class="p">,</span> <span class="err">*</span><span class="p">&gt;?)</span><span class="o">!!</span><span class="p">[</span><span class="s">"username"</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1">// when:</span>
        <span class="kd">val</span> <span class="py">completed</span> <span class="p">=</span> <span class="nf">markAsCompleted</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

        <span class="c1">// then:</span>
        <span class="nf">assertTrue</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>

        <span class="c1">// when:</span>
        <span class="n">todos</span> <span class="p">=</span> <span class="n">allTodos</span>

        <span class="c1">// then:</span>
        <span class="nf">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">todos</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">todo</span> <span class="p">=</span> <span class="n">todos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nf">assertEquals</span><span class="p">(</span><span class="s">"Test GraphQL"</span><span class="p">,</span> <span class="n">todo</span><span class="p">[</span><span class="s">"title"</span><span class="p">])</span>
        <span class="nf">assertTrue</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="nc">Boolean</span><span class="p">.</span><span class="nf">parseBoolean</span><span class="p">(</span><span class="n">todo</span><span class="p">[</span><span class="s">"completed"</span><span class="p">].</span><span class="nf">toString</span><span class="p">()))</span>
        <span class="nf">assertEquals</span><span class="p">(</span>
            <span class="s">"Tim Yates"</span><span class="p">,</span>
            <span class="p">(</span><span class="n">todo</span><span class="p">[</span><span class="s">"author"</span><span class="p">]</span> <span class="k">as</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="err">*</span><span class="p">,</span> <span class="err">*</span><span class="p">&gt;?)</span><span class="o">!!</span><span class="p">[</span><span class="s">"username"</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">HttpResponse</span><span class="p">&lt;</span><span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Any</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span><span class="p">:</span> <span class="nc">HttpRequest</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nc">HttpRequest</span><span class="p">.</span><span class="nc">POST</span><span class="p">(</span><span class="s">"/graphql"</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">toBlocking</span><span class="p">().</span><span class="nf">exchange</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span> <span class="nc">Argument</span><span class="p">.</span><span class="nf">mapOf</span><span class="p">(</span><span class="nc">Argument</span><span class="p">.</span><span class="nc">STRING</span><span class="p">,</span> <span class="nc">Argument</span><span class="p">.</span><span class="nc">OBJECT_ARGUMENT</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="nf">assertEquals</span><span class="p">(</span><span class="nc">HttpStatus</span><span class="p">.</span><span class="nc">OK</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">())</span>
        <span class="nc">Assertions</span><span class="p">.</span><span class="nf">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">allTodos</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Any</span><span class="p">&gt;&gt;</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">query</span> <span class="p">=</span> <span class="s">"{\"query\":\"query { toDos { title, completed, author { id, username } } }\"}"</span>
            <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="k">get</span><span class="p">()[</span><span class="s">"data"</span><span class="p">]</span> <span class="k">as</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="err">*</span><span class="p">,</span> <span class="err">*</span><span class="p">&gt;)[</span><span class="s">"toDos"</span><span class="p">]</span> <span class="k">as</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Any</span><span class="p">&gt;&gt;</span>
        <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">createToDo</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">author</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Long</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">query</span> <span class="p">=</span>
            <span class="s">"{\"query\": \"mutation { createToDo(title: \\\"$title\\\", author: \\\"$author\\\") { id } }\" }"</span>
        <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="k">get</span><span class="p">().</span><span class="k">get</span><span class="p">(</span><span class="s">"data"</span><span class="p">)</span> <span class="k">as</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="err">*</span><span class="p">,</span> <span class="err">*</span><span class="p">&gt;)[</span><span class="s">"createToDo"</span><span class="p">]</span> <span class="k">as</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="err">*</span><span class="p">,</span> <span class="err">*</span><span class="p">&gt;?)</span><span class="o">!!</span><span class="p">[</span><span class="s">"id"</span><span class="p">].</span><span class="nf">toString</span><span class="p">().</span><span class="nf">toLong</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">markAsCompleted</span><span class="p">(</span><span class="n">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">query</span> <span class="p">=</span> <span class="s">"{\"query\": \"mutation { completeToDo(id: \\\"$id\\\") }\" }"</span>
        <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="k">get</span><span class="p">()[</span><span class="s">"data"</span><span class="p">]</span> <span class="k">as</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Any</span><span class="p">&gt;)[</span><span class="s">"completeToDo"</span><span class="p">]</span> <span class="k">as</span> <span class="nc">Boolean</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> so the Micronaut framework will initialize the application context and the embedded server. <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/">More info</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>HttpClient</code> bean and point it to the embedded server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">./mvnw <span class="nb">test</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graphiql">10. GraphiQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As an extra feature that will help during development, you can enable <a href="https://github.com/graphql/graphiql">GraphiQL</a>.
GraphiQL is the GraphQL integrated development environment, and it executes GraphQL queries.</p>
</div>
<div class="paragraph">
<p>It should only be used for development, so it&#8217;s not enabled by default.
Add the following configuration to enable it:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">graphql.graphiql.enabled</span><span class="p">=</span><span class="s">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Start the application again and open <a href="http://localhost:8080/graphiql" class="bare">http://localhost:8080/graphiql</a> in a browser.
GraphQL queries can be executed with integrated auto-completion:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/graphiql-todo.png" alt="graphiql todo"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-a-micronaut-application-native-executable-with-graalvm">11. Generate a Micronaut Application Native Executable with GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use <a href="https://www.graalvm.org/">GraalVM</a>, an advanced JDK with ahead-of-time Native Image compilation, to generate a native executable of this Micronaut application.</p>
</div>
<div class="paragraph">
<p>Compiling Micronaut applications ahead of time with GraalVM significantly improves startup time and reduces the memory footprint of JVM-based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only Java and Kotlin projects support using GraalVM&#8217;s <code>native-image</code> tool. Groovy relies heavily on reflection, which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="graalvm-installation">11.1. GraalVM Installation</h3>
<div class="paragraph">
<p>The easiest way to install <a href="https://www.graalvm.org">GraalVM</a> on Linux or Mac is to use <a href="https://sdkman.io/">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="title">Java 21</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">sdk <span class="nb">install </span>java 21.0.5-graal</code></pre>
</div>
</div>
<div class="paragraph">
<p>For installation on Windows, or for a manual installation on Linux or Mac, see the <a href="https://www.graalvm.org/latest/docs/getting-started/">GraalVM Getting Started</a> documentation.</p>
</div>
<div class="paragraph">
<p>The previous command installs Oracle GraalVM, which is free to use in production and free to redistribute, at no cost, under the <a href="https://www.oracle.com/downloads/licenses/graal-free-license.html">GraalVM Free Terms and Conditions</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <a href="https://github.com/graalvm/graalvm-ce-builds/releases/">GraalVM Community Edition</a>:</p>
</div>
<div class="listingblock">
<div class="title">Java 21</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">sdk <span class="nb">install </span>java 21.0.2-graalce</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="native-executable-generation">11.2. Native Executable Generation</h3>
<div class="paragraph">
<p>To generate a native executable using Maven, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">./mvnw package <span class="nt">-Dpackaging</span><span class="o">=</span>native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native executable is created in the <code>target</code> directory and can be run with <code>target/micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to customize the name of the native executable or pass additional build arguments using the <a href="https://graalvm.github.io/native-build-tools/latest/maven-plugin.html">Maven plugin for GraalVM Native Image building</a>. Declare the plugin as following:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.graalvm.buildtools<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>native-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.10.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
         <i class="conum" data-value="1"></i><b>(1)</b>
         <span class="nt">&lt;imageName&gt;</span>mn-graalvm-application<span class="nt">&lt;/imageName&gt;</span>
        <span class="nt">&lt;buildArgs&gt;</span>
          <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="nt">&lt;buildArg&gt;</span>-Ob<span class="nt">&lt;/buildArg&gt;</span>
        <span class="nt">&lt;/buildArgs&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The native executable name will now be <code>mn-graalvm-application</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It is possible to pass extra build arguments to <code>native-image</code>. For example, <code>-Ob</code> enables the quick build mode.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Start the native executable and execute the same cURL request as before. You can also use the included GraphiQL browser to
execute the queries.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">12. Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Take a look at the <a href="https://micronaut-projects.github.io/micronaut-graphql/latest/guide/">Micronaut GraphQL documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="help-with-the-micronaut-framework">13. Help with the Micronaut Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://micronaut.io/foundation/">Micronaut Foundation</a> sponsored the creation of this Guide. A variety of <a href="https://micronaut.io/commercial-support/">consulting and support services</a> are available.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license">14. License</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All guides are released with an <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache license 2.0 license</a> for the code and a <a href="https://creativecommons.org/licenses/by/4.0/deed.en">Creative Commons Attribution 4.0</a> license for the writing and media (images&#8230;&#8203;).
</td>
</tr>
</table>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <a href="https://micronaut.io/foundation/"><img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/></a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li id="menu-item-6740" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6740"><a href="https://fosstodon.org/@micronaut"><i class="fab fa-mastodon"><span class="sr-only">Mastodon</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://discord.gg/9xRFsHv98T"><i class="fab fa-discord"><span class="sr-only">Discord</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>Guides are licensed under <a href="https://creativecommons.org/licenses/by/4.0/deed.en">CC BY 4.0</a> for the writing/media and <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache.2.0</a> for the code</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
