<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Authenticate Micronaut Application users with OpenID Connect and Oracle IDCS</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link href="coderay.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronaut-cloud-oidc-oracle.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="Authenticate Micronaut Application users with OpenID Connect and Oracle IDCS"/>
    <meta name="twitter:description" content="Learn how to create a secured Micronaut application and authenticate with OpenID Connect in Oracle Cloud."/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item">
                        <a href="https://micronaut.io/download/" class="nav-link">Download</a>
                    </li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-2872 active dropdown nav-item">
                        <a href="./index.html" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2869" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2869">
                                <a href="https://micronaut.io/docs/" class="dropdown-item">User Documentation</a>
                            </li>
                            <li id="menu-item-2870" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2870">
                                <a href="./index.html" class="dropdown-item">Guides</a>
                            </li>
                            <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896">
                                <a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a>
                            </li>
                            <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897">
                                <a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a>
                            </li>
                            <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871">
                                <a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/blog/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879">
                                <a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a>
                            </li>
                            <li id="menu-item-2881" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2881">
                                <a href="https://micronaut.io/events/" class="dropdown-item">Upcoming Events</a>
                            </li>
                            <li id="menu-item-2880" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2880">
                                <a href="https://micronaut.io/commercial-support/" class="dropdown-item">Commercial Support</a>
                            </li>
                            <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882">
                                <a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a>
                            </li>
                            <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883">
                                <a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/foundation/" aria-current="page" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item menu-item-2877 active">
                                <a href="https://micronaut.io/foundation/" aria-current="page" class="dropdown-item">Overview</a>
                            </li>
                            <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874">
                                <a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a>
                            </li>
                            <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873">
                                <a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a>
                            </li>
                            <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876">
                                <a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item">
                        <a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a>
                    </li>
                </ul>
            </div>

        </nav>

    </div>
</header>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-cloud-oidc-oracle.html">Authenticate Micronaut Application users with OpenID Connect and Oracle IDCS</a> » <span class="breadcrumb_last" aria-current="page">gradle | kotlin</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#configure-openid-connect-at-oracle-cloud">4. Configure OpenID Connect at Oracle Cloud</a>
<ul class="sectlevel2">
<li><a href="#create-a-federated-user">4.1. Create a federated user</a></li>
<li><a href="#create-the-oauth-application">4.2. Create the OAuth application</a></li>
<li><a href="#enable-signing-certificate-access">4.3. Enable Signing Certificate Access</a></li>
</ul>
</li>
<li><a href="#writing-the-application">5. Writing the Application</a>
<ul class="sectlevel2">
<li><a href="#configuration">5.1. Configuration</a></li>
<li><a href="#home-controller">5.2. Home controller</a></li>
<li><a href="#thymeleaf-view">5.3. Thymeleaf view</a></li>
</ul>
</li>
<li><a href="#running-the-application">6. Running the Application</a></li>
<li><a href="#next-steps">7. Next steps</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Authenticate Micronaut Application users with OpenID Connect and Oracle IDCS</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Learn how to create a secured Micronaut application and authenticate with OpenID Connect in Oracle Cloud.</p>
</div>
<div class="paragraph">
<p>Authors: Burt Beckwith</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 3.9.2</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we will create a Micronaut application written in Kotlin.</p>
</div>
<div class="paragraph">
<p>The application will use OpenID Connect (OIDC), which is an identity layer on top of the OAuth 2.0 protocol that verifies the end user&#8217;s identity and obtains basic profile information.
Under the hood, the OIDC APIs are easier to work with than OAuth because they use JSON instead of XML, but in practice, Micronaut Security handles the details for you.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> <a href="https://www.baeldung.com/java-home-on-windows-7-8-10-mac-os-x-linux">configured appropriately</a></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/SDKDocs/cliinstall.htm">Oracle Cloud CLI</a> installed with local access to Oracle Cloud configured by running <code>oci setup config</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>An Oracle Cloud account (create a free trial account at <a href="https://signup.oraclecloud.com">signup.oraclecloud.com</a>)</p>
</li>
</ul>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-cloud-oidc-oracle-gradle-kotlin.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-openid-connect-at-oracle-cloud">4. Configure OpenID Connect at Oracle Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ll use the Oracle Cloud web console to create an OAuth 2.0 "Confidential Application" with support for OpenID Connect and a federated user to demonstrate using OpenID Connect with Micronaut and Oracle Cloud.</p>
</div>
<div class="sect2">
<h3 id="create-a-federated-user">4.1. Create a federated user</h3>
<div class="paragraph">
<p><a href="https://cloud.oracle.com/">Log in to your Oracle Cloud tenancy</a> as an admin (or a user with sufficient permissions to create users and applications), and from the Oracle Cloud Menu, select "Identity &amp; Security" and then "Federation":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation01.png" alt="federation01">
</div>
</div>
<div class="paragraph">
<p>Click on the link for "OracleIdentityCloudService":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation02.png" alt="federation02">
</div>
</div>
<div class="paragraph">
<p>and then click the "Create User" button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation03.png" alt="federation03">
</div>
</div>
<div class="paragraph">
<p>Enter a valid username, e.g., "mn_guide_oidc", and a valid email address, along with a first and last name, then click "Create":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation04.png" alt="federation04">
</div>
</div>
<div class="paragraph">
<p>Open the email sent to the email address you specified and click the link to set the password for the user:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation05.png" alt="federation05">
</div>
</div>
<div class="paragraph">
<p>Log in as the user to verify the password, then log out and back in as the admin user.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-the-oauth-application">4.2. Create the OAuth application</h3>
<div class="paragraph">
<p>Navigate again to the "OracleIdentityCloudService" federation and copy the link to the "Oracle Identity Cloud Service Console", minus the path (it will look like <code>https://idcs-7084de14ec&#8230;&#8203;&#8230;&#8203;.identity.oraclecloud.com/</code>).
Save this for later when we create a Micronaut application where this value will be used as the <code>OAUTH_ISSUER</code>.</p>
</div>
<div class="paragraph">
<p>Click the "Oracle Identity Cloud Service Console" link to open the console:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation06.png" alt="federation06">
</div>
</div>
<div class="paragraph">
<p>Click the button in the top right of the "Applications and Services" section to create a new application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation07.png" alt="federation07">
</div>
</div>
<div class="paragraph">
<p>and then click "Confidential Application":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation08.png" alt="federation08">
</div>
</div>
<div class="paragraph">
<p>Enter a valid application name, e.g., "mn_guide_oidc_app" and optionally a description:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation09.png" alt="federation09">
</div>
</div>
<div class="paragraph">
<p>Click "Next" to go to step 2.</p>
</div>
<div class="paragraph">
<p>Click "Configure this application as a client now", and in the <code>Allowed Grant Types</code> section, check <code>Authorization Code</code>.</p>
</div>
<div class="paragraph">
<p>Check <code>Allow non-HTTPS URLs</code> for now to make testing easier and avoid having to use HTTPS locally.
Be sure to unselect this in production applications, which should always use HTTPS.</p>
</div>
<div class="paragraph">
<p>Enter the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Redirect URL: <code>http://localhost:8080/oauth/callback/micronaut</code></p>
</li>
<li>
<p>Logout URL: <code>http://localhost:8080/logout</code></p>
</li>
<li>
<p>Post Logout Redirect URL: <code>http://localhost:8080/</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation10.png" alt="federation10">
</div>
</div>
<div class="paragraph">
<p>Scroll down and click the "Add" button in the "Grant the client access to Identity Cloud Service Admin APIs" section:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation11.png" alt="federation11">
</div>
</div>
<div class="paragraph">
<p>Select <code>Me</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation12.png" alt="federation12">
</div>
</div>
<div class="paragraph">
<p>Click "Next", and click "Next" to accept the defaults for steps 3, 4, and 5, then click "Finish"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation13.png" alt="federation13">
</div>
</div>
<div class="paragraph">
<p>Save the "Client ID" and "Client Secret" values for later, then click "Close":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation14.png" alt="federation14">
</div>
</div>
<div class="paragraph">
<p>Finally, click the "Activate" button to make the application available for use:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation15.png" alt="federation15">
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-signing-certificate-access">4.3. Enable Signing Certificate Access</h3>
<div class="paragraph">
<p>We need to make the signing certificate available to our Micronaut application for JWT validation without being authenticated.
Click the <span class="image"><img src="images/cloud-oidc-oracle/burgermenu.png" alt="burgermenu"></span> ("burger" menu) in the top left, then click "Settings", and then "Default Settings":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation16.png" alt="federation16">
</div>
</div>
<div class="paragraph">
<p>and enable unauthenticated access to the signing certificate:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/federation17.png" alt="federation17">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you skip this step, you will see errors similar these for valid logins because Micronaut Security cannot retrieve the JWK to validate the JWT:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>JWT signature validation failed for provider [micronaut]
Exception loading JWK from https://idcs-7084de14ec.......identity.oraclecloud.com/admin/v1/SigningCert/jwk
Server returned HTTP response code: 401</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-application">5. Writing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an application using the <a href="https://docs.micronaut.io/latest/guide/#cli">Micronaut Command Line Interface</a> or with <a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn create-app example.micronaut.micronautguide \
    --features=security-oauth2,security-jwt,security-session,views-thymeleaf \
    --build=gradle
    --lang=kotlin</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle is used as the build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as the language.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command creates a Micronaut application with the default package <code>example.micronaut</code> in a directory named <code>micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>If you use Micronaut Launch, select Micronaut Application as application type and add <code>security-oauth2</code>, <code>security-jwt</code>, <code>security-session</code>, and <code>views-thymeleaf</code> features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have an existing Micronaut application and want to add the functionality described here, you can <a href="https://micronaut.io/launch?features=security-oauth2&amp;features=security-jwt&amp;features=security-session&amp;features=views-thymeleaf&amp;lang=KOTLIN&amp;build=GRADLE&amp;test=JUNIT&amp;name=micronautguide&amp;type=DEFAULT&amp;package=example.micronaut&amp;activity=diff" target="_blank" rel="noopener">view the dependency and configuration changes from the specified features</a> and apply those changes to your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">Setup IntelliJ IDEA to develop Micronaut Applications</a>.</p>
</div>
<div class="sect2">
<h3 id="configuration">5.1. Configuration</h3>
<div class="paragraph">
<p>Replace the generated <code>application.yml</code> with this:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">application</span>:
    <span class="key">name</span>: <span class="string"><span class="content">micronautguide</span></span>
  <span class="key">security</span>:
    <span class="key">authentication</span>: <span class="string"><span class="content">idtoken </span></span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">oauth2</span>:
      <span class="key">clients</span>:
        <span class="key">micronaut</span>: <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">client-id</span>: <span class="string"><span class="content">${OAUTH_CLIENT_ID:xxx} </span></span><i class="conum" data-value="3"></i><b>(3)</b>
          <span class="key">client-secret</span>: <span class="string"><span class="content">${OAUTH_CLIENT_SECRET:yyy} </span></span><i class="conum" data-value="3"></i><b>(3)</b>
          <span class="key">openid</span>:
            <span class="key">issuer</span>: <span class="string"><span class="content">${OAUTH_ISSUER:zzz} </span></span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key">endpoints</span>:
      <span class="key">logout</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">get-allowed</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="4"></i><b>(4)</b>
<span class="key">netty</span>:
  <span class="key">default</span>:
    <span class="key">allocator</span>:
      <span class="key">max-order</span>: <span class="string"><span class="content">3</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set <code>micronaut.security.authentication</code> as <code>idtoken</code>. The <code>idtoken</code> provided by your OAuth 2.0 application when the Authorization code flow ends (a signed JWT) will be saved in a cookie.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The provider identifier must match the last part of the URL you entered as a redirect URL: <code>/oauth/callback/micronaut</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>client-id</code>, <code>client-secret</code>, and the <code>issuer</code> URL will be set as environment variables</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Accept GET requests to the <code>/logout</code> endpoint</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="home-controller">5.2. Home controller</h3>
<div class="paragraph">
<p>Create a <code>HomeController</code> class to test the security configuration:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/HomeController.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.security.annotation.Secured
import io.micronaut.security.rules.SecurityRule.IS_ANONYMOUS
import io.micronaut.security.rules.SecurityRule.IS_AUTHENTICATED
import io.micronaut.views.View

@Controller <i class="conum" data-value="1"></i><b>(1)</b>
class HomeController {

    @Secured(IS_ANONYMOUS) <i class="conum" data-value="2"></i><b>(2)</b>
    @View(&quot;home&quot;) <i class="conum" data-value="3"></i><b>(3)</b>
    @Get <i class="conum" data-value="4"></i><b>(4)</b>
    fun index(): Map&lt;String, Any&gt; = mapOf()

    @Secured(IS_AUTHENTICATED) <i class="conum" data-value="5"></i><b>(5)</b>
    @Get(&quot;/secure&quot;) <i class="conum" data-value="6"></i><b>(6)</b>
    fun secured(): Map&lt;String, Any&gt; = mapOf(&quot;secured&quot; to true) <i class="conum" data-value="7"></i><b>(7)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate with <code>io.micronaut.security.Secured</code> to configure secured access. The <code>SecurityRule.IS_ANONYMOUS</code> expression will allow access without authentication.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <a href="https://micronaut-projects.github.io/micronaut-views/latest/api/io/micronaut/views/View.html">View</a> annotation to specify which template to use to render the response.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the <code>index</code> method to an HTTP GET request on <code>/</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Annotate with <code>io.micronaut.security.Secured</code> to configure secured access. The <code>SecurityRule.IS_AUTHENTICATED</code> expression allows only access to authenticated users.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the <code>secured</code> method to an HTTP GET request on <code>/secure</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>This method simply returns a model map that will be rendered as JSON since there&#8217;s no <code>@View</code> annotation</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="thymeleaf-view">5.3. Thymeleaf view</h3>
<div class="paragraph">
<p>Create a Thymeleaf view to render the UI for the controller:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/views/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;title&gt;</span>Micronaut - OpenID Connect<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
<span class="tag">&lt;h1&gt;</span>Micronaut - OpenID Connect<span class="tag">&lt;/h1&gt;</span>

<span class="tag">&lt;h2</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${security}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Username: <span class="tag">&lt;span</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${security.get('name')}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;h2</span> <span class="attribute-name">th:unless</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${security}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Username: Anonymous<span class="tag">&lt;/h2&gt;</span>

<span class="tag">&lt;nav&gt;</span>
    <span class="tag">&lt;ul&gt;</span>
        <span class="tag">&lt;li</span> <span class="attribute-name">th:unless</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${security}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/oauth/login/micronaut</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Enter<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/li&gt;</span>
        <span class="tag">&lt;li</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${security}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/logout</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Logout<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/li&gt;</span>
    <span class="tag">&lt;/ul&gt;</span>
<span class="tag">&lt;/nav&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${security}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h2&gt;</span>User Information:<span class="tag">&lt;/h2&gt;</span>
    <span class="tag">&lt;ul&gt;</span>
        <span class="tag">&lt;tr</span> <span class="attribute-name">th:each</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">key : ${#lists.sort(#lists.toList(security.attributes.keySet()))}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;li&gt;</span><span class="tag">&lt;span</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${key}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/span&gt;</span>: <span class="tag">&lt;span</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${security.attributes.get(key)}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/li&gt;</span>
        <span class="tag">&lt;/tr&gt;</span>
    <span class="tag">&lt;/ul&gt;</span>
<span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we return an empty model in the controller <code>index()</code> method. However, we are accessing <code>security</code> in the Thymeleaf template.
The Micronaut Security <a href="https://micronaut-projects.github.io/micronaut-views/latest/api/io/micronaut/views/model/security/SecurityViewModelProcessor.html">SecurityViewModelProcessor</a>
injects a <code>security</code> map into the model with the authenticated user data.
See the <a href="https://micronaut-projects.github.io/micronaut-views/latest/guide/#security-model-enhancement">User in a view</a> documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-application">6. Running the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before starting the application, we need to create some environment variables.
We used placeholders in <code>application.yml</code> for the <code>client-id</code>, <code>client-secret</code>, and the <code>issuer</code> URL properties, so we need to create <code>OAUTH_CLIENT_ID</code>, <code>OAUTH_CLIENT_SECRET</code>, and <code>OAUTH_ISSUER</code> environment variables.
Use the client ID and client secret you saved when you created the Oracle Cloud application, and the issuer URL you saved (the root of the Oracle Identity Cloud Service (OICS) console URL):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export OAUTH_CLIENT_ID=XXXXXXXXXX
export OAUTH_CLIENT_SECRET=YYYYYYYYYY
export OAUTH_ISSUER=https://idcs-7084de14ec.......identity.oraclecloud.com/</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We use Linux/Mac syntax for environment variables. If you use Windows, change '<strong>export</strong>' to '<strong>set</strong>' if using the <code>cmd</code> prompt, for example:</p>
</div>
<div class="paragraph">
<p><code>set VARNAME=&lt;VALUE&gt;</code></p>
</div>
<div class="paragraph">
<p>and if using PowerShell, change '<strong>export</strong> ' to '<strong>$</strong>' and use quotes around the value, for example:</p>
</div>
<div class="paragraph">
<p><code>$VARNAME="&lt;VALUE&gt;"</code></p>
</div>
<div class="paragraph">
<p>To dereference a value in Linux/Mac or Powershell, use <strong>$</strong>, for example:</p>
</div>
<div class="paragraph">
<p><code>/some/command -option=$VARNAME</code></p>
</div>
<div class="paragraph">
<p>and if using <code>cmd</code>, use <strong>%</strong> before and after the name, for example</p>
</div>
<div class="paragraph">
<p><code>/some/command -option=%VARNAME%</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run the application, use the <code>./gradlew run</code> command, which starts the application on port 8080.</p>
</div>
<div class="paragraph">
<p>Open <a href="http://localhost:8080/secure" class="bare">http://localhost:8080/secure</a> in a browser, and you&#8217;ll be redirected to the home page because the controller method is annotated with <code>@Secured(IS_AUTHENTICATED)</code>, and you&#8217;re not yet authenticated:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/run1.png" alt="run1">
</div>
</div>
<div class="paragraph">
<p>Sign in with the username and password for the federated user you created:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/run2.png" alt="run2">
</div>
</div>
<div class="paragraph">
<p>then click Allow on the next screen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/run3.png" alt="run3">
</div>
</div>
<div class="paragraph">
<p>After you&#8217;re redirected to the home page, you&#8217;ll see that you&#8217;re authenticated and now have a <code>Logout</code> link, and several authentication details are displayed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/run4.png" alt="run4">
</div>
</div>
<div class="paragraph">
<p>Navigate again to <a href="http://localhost:8080/secure" class="bare">http://localhost:8080/secure</a> in a browser, and you&#8217;ll see a simple JSON response:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloud-oidc-oracle/run5.png" alt="run5">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">7. Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Explore more features with <a href="https://micronaut.io/guides/">Micronaut Guides</a>.</p>
</div>
<div class="paragraph">
<p>Learn more about <a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/">Micronaut Security</a>.</p>
</div>
<div class="paragraph">
<p>Learn more about <a href="https://openid.net/connect/">OpenID Connect</a>.</p>
</div>
<div class="paragraph">
<p>Check out <a href="https://blogs.oracle.com/developers/post/authenticating-users-with-oracle-idcs-via-openid-connect-and-micronaut">this blog post</a> on using OpenID Connect with Micronaut and Oracle Cloud.</p>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://matrix.to/#/#micronautfw_questions:gitter.im"><i class="fab fa-gitter"><span class="sr-only">Gitter</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>© 2023 MICRONAUT FOUNDATION. ALL RIGHTS RESERVED</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
