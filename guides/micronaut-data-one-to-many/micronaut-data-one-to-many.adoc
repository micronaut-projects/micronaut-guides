common:header.adoc[]

common:requirements.adoc[]

common:completesolution.adoc[]

== One-To-Many Relationship

In this tutorial, you develop a one-to-many relationship, as illustrated in the following tables.

.Table: Contact
[cols="1,1,1", options="header"]
|===
| id | first_name | last_name
| 1  | Sergio       | del Amo
|===

.Table: Phone
[cols="1,1,1", options="header"]
|===
| id | phone       | contact_id
| 1  | +14155552671 | 1
| 2  | +442071838750 | 1
|===

common:create-app-features.adoc[]

common:datasource-header.adoc[]

resource:application.properties[tag=datasource]


common:liquibase.adoc[]

resource:db/changelog/01-schema.xml[]

== Entities

Create an entity mapping the table `contact`:

source:ContactEntity[]

<1> callout:mapped-entity[]
<2> callout:mapped-entity-id[]
<3> callout:generated-value[]
<4> callout:nullable-record-id[]
<5> callout:relation[]

Create an entity mapping the table `phone`:

source:PhoneEntity[]

<1> callout:mapped-entity[]
<2> callout:mapped-entity-id[]
<3> callout:generated-value[]
<4> callout:nullable-record-id[]
<5> callout:relation[]

== Projections

Create one Java record to project a complete view, phones included, of the contact:

source:ContactComplete[]

<1> callout:introspected[]

Create one Java record to preview a contact, no phones:

source:ContactPreview[]

<1> callout:introspected[]

== Repositories

source:PhoneRepository[]

<1> callout:jdbcrepository[]
<2> callout:crudrepository[]

source:ContactRepository[]

<1> callout:jdbcrepository[]
<2> callout:crudrepository[]
<3> callout:join-left-fetch[arg0=phones]
<4> callout:at-query[]


== Tests

The following tests illustrates the association queries:

test:ContactRepositoryTest[]

<1> callout:micronaut-test-transactional-false[]
<2> callout:injection[arg0=ContactRepository]
<3> callout:injection[arg0=ContactRepository]

common:testApp.adoc[]

common:nativetest.adoc[]

common:next.adoc[]

Read more about https://micronaut-projects.github.io/micronaut-data/latest/guide/[Micronaut Data]

common:helpWithMicronaut.adoc[]
