<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Micronaut HTTP Client</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="alternate" type="application/rss+xml" title="Micronaut Guides RSS Feed" href="https://guides.micronaut.io/latest/rss.xml" />
    <link rel="alternate" type="application/json" title="Micronaut Guides JSON Feed" href="https://guides.micronaut.io/latest/feed.json" />
    <link href="coderay.css" rel="stylesheet" />
    <link href="rouge-github.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="lunr.js"></script>
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronaut-http-client.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="Micronaut HTTP Client"/>
    <meta name="twitter:description" content="Learn how to use Micronaut low-level HTTP Client. Simplify your code with the declarative HTTP client."/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item"><a href="https://micronaut.io/download/" class="nav-link">Download</a></li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-2868 dropdown nav-item"><a href="https://micronaut.io/learn/" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a><ul class="dropdown-menu">
                        <li id="menu-item-4943" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4943"><a href="https://micronaut.io/learn/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-5111" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5111"><a href="https://docs.micronaut.io/index.html" class="dropdown-item">User Documentaton</a></li>
                        <li id="menu-item-4510" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4510"><a href="https://micronaut.io/guides/" class="dropdown-item">Guides</a></li>
                        <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896"><a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a></li>
                        <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897"><a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a></li>
                        <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871"><a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a></li>
                        <li id="menu-item-6526" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6526"><a href="https://micronaut-projects.github.io/micronaut-guides-mn3/latest/" class="dropdown-item">Guides for Micronaut Framework 3</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item"><a href="https://micronaut.io/resources/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a><ul class="dropdown-menu">
                        <li id="menu-item-4999" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4999"><a href="https://micronaut.io/upcoming-events/" class="dropdown-item">Upcoming Events</a></li>
                        <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879"><a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a></li>
                        <li id="menu-item-6478" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6478"><a href="https://micronaut.io/category/release-announcements/" class="dropdown-item">Releases</a></li>
                        <li id="menu-item-6715" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6715"><a href="https://micronaut.io/category/security-announcements/" class="dropdown-item">Security Announcements</a></li>
                        <li id="menu-item-4499" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4499"><a href="https://micronautpodcast.com/" class="dropdown-item">Podcast</a></li>
                        <li id="menu-item-5798" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5798"><a href="https://micronaut.io/support/" class="dropdown-item">Commercial Support</a></li>
                        <li id="menu-item-4186" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4186"><a href="https://micronaut.io/resources/community-support/" class="dropdown-item">Community Support</a></li>
                        <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882"><a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a></li>
                        <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883"><a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a></li>
                        <li id="menu-item-6479" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6479"><a href="https://micronaut.io/micronaut-success-stories/" class="dropdown-item">Micronaut Success Stories</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2872 dropdown nav-item"><a href="https://micronaut.io/foundation/" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a><ul class="dropdown-menu">
                        <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2877"><a href="https://micronaut.io/foundation/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874"><a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a></li>
                        <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873"><a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a></li>
                        <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876"><a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a></li>
                        <li id="menu-item-3838" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3838"><a href="https://micronaut.io/meeting-minutes/" class="dropdown-item">Meeting Minutes</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item"><a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a></li>

                </ul>

            </div>

        </nav>

    </div>
</header>

<div style="background: #fff;padding-top: 20px;padding-bottom: 20px;">
    <div class="container" style="clear: both;">
        <fieldset style="float: right;">
            <input type="search" id="search-form-query"/>
            <input type="submit" onclick="search()" value="Search">
            <input type="submit" onclick="resetSearch()" value="Reset">
        </fieldset>
    </div>
    <div class="container" style="clear: both;margin-top: -20px;">
        <div class="guide-list" id="searchResults">
        </div>
    </div>
</div>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-http-client.html">Micronaut HTTP Client</a> » <span class="breadcrumb_last" aria-current="page">maven | kotlin</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#writing-the-application">4. Writing the Application</a>
<ul class="sectlevel2">
<li><a href="#dependency">4.1. Dependency</a></li>
<li><a href="#github-api">4.2. GitHub API</a></li>
<li><a href="#configuration">4.3. Configuration</a></li>
<li><a href="#low-level-client">4.4. Low Level Client</a></li>
<li><a href="#declarative-client">4.5. Declarative Client</a></li>
<li><a href="#controller">4.6. Controller</a></li>
<li><a href="#tests">4.7. Tests</a></li>
</ul>
</li>
<li><a href="#testing-the-application">5. Testing the Application</a></li>
<li><a href="#http-client-filter">6. HTTP Client Filter</a>
<ul class="sectlevel2">
<li><a href="#configuration-parameters">6.1. Configuration Parameters</a></li>
</ul>
</li>
<li><a href="#generate-a-micronaut-application-native-executable-with-graalvm">7. Generate a Micronaut Application Native Executable with GraalVM</a>
<ul class="sectlevel2">
<li><a href="#graalvm-installation">7.1. GraalVM Installation</a></li>
<li><a href="#native-executable-generation">7.2. Native Executable Generation</a></li>
</ul>
</li>
<li><a href="#next-steps">8. Next Steps</a></li>
<li><a href="#help-with-the-micronaut-framework">9. Help with the Micronaut Framework</a></li>
<li><a href="#license">10. License</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Micronaut HTTP Client</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Learn how to use Micronaut low-level HTTP Client. Simplify your code with the declarative HTTP client.</p>
</div>
<div class="paragraph">
<p>Authors: Sergio del Amo, Iván López</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 4.9.1</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we will create a Micronaut application written in Kotlin to consume the GitHub API with the Micronaut HTTP Client.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE (e.g. <a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">IntelliJ IDEA</a>)</p>
</li>
<li>
<p>JDK 21 or greater installed with <code>JAVA_HOME</code> <a href="https://www.baeldung.com/java-home-on-windows-7-8-10-mac-os-x-linux">configured appropriately</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-http-client-maven-kotlin.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-application">4. Writing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an application using the <a href="https://docs.micronaut.io/latest/guide/#cli">Micronaut Command Line Interface</a> or with <a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mn create-app example.micronaut.micronautguide <span class="se">\</span>
    <span class="nt">--features</span><span class="o">=</span>http-client,graalvm <span class="se">\</span>
    <span class="nt">--build</span><span class="o">=</span>maven <span class="se">\</span>
    <span class="nt">--lang</span><span class="o">=</span>kotlin <span class="se">\</span>
    <span class="nt">--test</span><span class="o">=</span>junit</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle with the <a href="https://docs.gradle.org/current/userguide/kotlin_dsl.html">Kotlin DSL</a> is used as the build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as the language.<br/> If you don&#8217;t specify the <code>--test</code> argument, JUnit is used for Java and Kotlin, and Spock is used for Groovy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command creates a Micronaut application with the default package <code>example.micronaut</code> in a directory named <code>micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>If you use Micronaut Launch, select Micronaut Application as application type and add <code>http-client</code>, and <code>graalvm</code> features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have an existing Micronaut application and want to add the functionality described here, you can view the dependency and configuration changes from the specified features, and apply those changes to your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://micronaut.io/launch?features=http-client&amp;features=graalvm&amp;lang=KOTLIN&amp;build=MAVEN&amp;test=JUNIT&amp;name=micronautguide&amp;type=DEFAULT&amp;package=example.micronaut&amp;activity=diff" target="_blank" rel="noopener">Diff</a></p>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">Setup IntelliJ IDEA to develop Micronaut Applications</a>.</p>
</div>
<div class="sect2">
<h3 id="dependency">4.1. Dependency</h3>
<div class="paragraph">
<p>To use the <a href="https://docs.micronaut.io/snapshot/guide/#nettyHttpClient">Micronaut HTTP Client based on Netty</a>, add the following dependency:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.micronaut<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>micronaut-http-client<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the <a href="https://docs.micronaut.io/snapshot/guide/#jdkHttpClient">Micronaut HTTP Client based on Java HTTP Client</a>, add the following dependency:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.micronaut<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>micronaut-http-client-jdk<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="github-api">4.2. GitHub API</h3>
<div class="paragraph">
<p>In this guide, you will consume the <a href="https://docs.github.com/en/rest">GitHub API</a> from a Micronaut application.</p>
</div>
<div class="paragraph">
<p>In this guide, you will fetch <a href="https://github.com/micronaut-projects/micronaut-core/releases">Micronaut Core releases</a> via the <a href="https://docs.github.com/en/rest/reference/repos#list-releases">List releases</a> endpoint.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>This returns a list of releases, which does not include regular Git tags that have not been associated with a release.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This API resource can be consumed by both authenticated and anonymous clients. Initially, you will consume it anonymously, later we will discuss authentication.</p>
</div>
<div class="paragraph">
<p>Create a record to parse the JSON response into an object:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubRelease.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.serde.annotation.Serdeable</span>

<span class="nd">@Serdeable</span>
<span class="kd">data class</span> <span class="nc">GithubRelease</span><span class="p">(</span><span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration">4.3. Configuration</h3>
<div class="paragraph">
<p>Modify <code>src/main/resources/application.properties</code> to create some configuration parameters.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">github.organization</span><span class="p">=</span><span class="s">micronaut-projects</span>
<span class="py">github.repo</span><span class="p">=</span><span class="s">micronaut-core</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To encapsulate type-safe configuration retrieval, we use a <a href="https://docs.micronaut.io/latest/guide/#configurationProperties"><code>@ConfigurationProperties</code></a> object:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubConfiguration.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.context.annotation.ConfigurationProperties</span>
<span class="k">import</span> <span class="nn">io.micronaut.context.annotation.Requires</span>

<span class="nd">@ConfigurationProperties</span><span class="p">(</span><span class="nc">GithubConfiguration</span><span class="p">.</span><span class="nc">PREFIX</span><span class="p">)</span>
<span class="nd">@Requires</span><span class="p">(</span><span class="n">property</span> <span class="p">=</span> <span class="nc">GithubConfiguration</span><span class="p">.</span><span class="nc">PREFIX</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">GithubConfiguration</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">organization</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
    <span class="kd">var</span> <span class="py">repo</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
    <span class="kd">var</span> <span class="py">username</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
    <span class="kd">var</span> <span class="py">token</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">const</span> <span class="kd">val</span> <span class="py">PREFIX</span> <span class="p">=</span> <span class="s">"github"</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="json-codec-configuration">4.3.1. JSON Codec Configuration</h4>
<div class="paragraph">
<p>Add configuration to treat <code>application/vnd.github.v3+json</code> as JSON.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="err">micronaut.codec.json.additional-types[0]=application/vnd.github.v3+json</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-client-service-configuration">4.3.2. HTTP Client Service Configuration</h4>
<div class="paragraph">
<p>Add configuration to associate a service identifier to the GitHub API URL.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">micronaut.http.services.github.url</span><span class="p">=</span><span class="s">https://api.github.com</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="low-level-client">4.4. Low Level Client</h3>
<div class="paragraph">
<p>Initially, you will create a Bean which uses the low-level Client API.</p>
</div>
<div class="paragraph">
<p>Create <code>GithubLowLevelClient</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubLowLevelClient.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.core.type.Argument</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpHeaders.ACCEPT</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpHeaders.USER_AGENT</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpRequest</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.client.HttpClient</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.client.annotation.Client</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.uri.UriBuilder</span>
<span class="k">import</span> <span class="nn">jakarta.inject.Singleton</span>
<span class="k">import</span> <span class="nn">org.reactivestreams.Publisher</span>
<span class="k">import</span> <span class="nn">java.net.URI</span>

<span class="nd">@Singleton</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">GithubLowLevelClient</span><span class="p">(</span><span class="err">@</span><span class="n">param</span><span class="p">:</span><span class="nc">Client</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">"github"</span><span class="p">)</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="nc">HttpClient</span><span class="p">,</span>  <i class="conum" data-value="2"></i><b>(2)</b>
                           <span class="n">configuration</span><span class="p">:</span> <span class="nc">GithubConfiguration</span><span class="p">)</span> <span class="p">{</span>  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">uri</span><span class="p">:</span> <span class="nc">URI</span> <span class="p">=</span> <span class="nc">UriBuilder</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="s">"/repos"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">path</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">organization</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">path</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">repo</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">path</span><span class="p">(</span><span class="s">"releases"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">build</span><span class="p">()</span>

    <span class="k">fun</span> <span class="nf">fetchReleases</span><span class="p">():</span> <span class="nc">Publisher</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">GithubRelease</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">req</span><span class="p">:</span> <span class="nc">HttpRequest</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nc">HttpRequest</span><span class="p">.</span><span class="nc">GET</span><span class="p">&lt;</span><span class="nc">Any</span><span class="p">&gt;(</span><span class="n">uri</span><span class="p">)</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="p">.</span><span class="nf">header</span><span class="p">(</span><span class="nc">USER_AGENT</span><span class="p">,</span> <span class="s">"Micronaut HTTP Client"</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="p">.</span><span class="nf">header</span><span class="p">(</span><span class="nc">ACCEPT</span><span class="p">,</span> <span class="s">"application/vnd.github.v3+json, application/json"</span><span class="p">)</span> <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="k">return</span> <span class="n">httpClient</span><span class="p">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="nc">Argument</span><span class="p">.</span><span class="nf">listOf</span><span class="p">(</span><span class="nc">GithubRelease</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">))</span> <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject <code>HttpClient</code> via constructor injection. The <code>@Client</code> <code>id</code> member uses <code>github</code>; the service identifier set in the configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject the previously defined configuration parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creating HTTP Requests is easy thanks to the Micronaut framework fluid API.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>GitHub API requires to set the <code>User-Agent</code> header.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>GitHub encourages to explicitly request the version 3 via the <code>Accept</code> header. With <code>@Header</code>, you add the <code>Accept: application/vnd.github.v3+json</code> HTTP header to every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Use <code>retrieve</code> to perform an HTTP request for the given request object and convert the full HTTP response&#8217;s body into the specified type. e.g. <code>List&lt;GithubRelease&gt;</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="declarative-client">4.5. Declarative Client</h3>
<div class="paragraph">
<p>It is time to take a look at support for declarative clients via the Client annotation.</p>
</div>
<div class="paragraph">
<p>Create <code>GithubApiClient</code> which clearly illustrates how a declarative Micronaut HTTP Client, which is generated at compile-time, simplifies our code.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubApiClient.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.core.async.annotation.SingleResult</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpHeaders.ACCEPT</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpHeaders.USER_AGENT</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.Get</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.Header</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.Headers</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.client.annotation.Client</span>
<span class="k">import</span> <span class="nn">org.reactivestreams.Publisher;</span>

<span class="nd">@Client</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">"github"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nd">@Headers</span><span class="p">(</span>
    <span class="nc">Header</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="nc">USER_AGENT</span><span class="p">,</span> <span class="n">value</span> <span class="p">=</span> <span class="s">"Micronaut HTTP Client"</span><span class="p">),</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="nc">Header</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="nc">ACCEPT</span><span class="p">,</span> <span class="n">value</span> <span class="p">=</span> <span class="s">"application/vnd.github.v3+json, application/json"</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="p">)</span>
<span class="kd">interface</span> <span class="nc">GithubApiClient</span> <span class="p">{</span>

    <span class="nd">@Get</span><span class="p">(</span><span class="s">"/repos/\${github.organization}/\${github.repo}/releases"</span><span class="p">)</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="nd">@SingleResult</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="k">fun</span> <span class="nf">fetchReleases</span><span class="p">():</span> <span class="nc">Publisher</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">GithubRelease</span><span class="p">&gt;&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>URL of the remote service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>GitHub API requires to set the <code>User-Agent</code> header.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>GitHub encourages to explicitly request the version 3 via the <code>Accept</code> header. With <code>@Header</code>, you add the <code>Accept: application/vnd.github.v3+json</code> HTTP header to every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can use configuration parameter interpolation when you define the path of the GET endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Annotation to describe that an API emits a single result even if the return type is an <code>org.reactivestreams.Publisher</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can return any reactive type of any implementation (RxJava, Reactor&#8230;&#8203;), but it&#8217;s better to use the Reactive Streams public interfaces like <code>Publisher</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="controller">4.6. Controller</h3>
<div class="paragraph">
<p>Create a Controller. It uses both (low-level and declarative clients). The Micronaut framework supports Reactive Streams implementations such as <a href="https://micronaut-projects.github.io/micronaut-rxjava3/latest/guide/">RxJava</a> or <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/guide/">Project Reactor</a>. Thus, you can efficiently compose multiple HTTP client calls without blocking (which will limit the throughput and scalability of your application).</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubController.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.core.async.annotation.SingleResult</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.MediaType</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.Controller</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.Get</span>
<span class="k">import</span> <span class="nn">org.reactivestreams.Publisher</span>

<span class="nd">@Controller</span><span class="p">(</span><span class="s">"/github"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="kd">class</span> <span class="nc">GithubController</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">githubLowLevelClient</span><span class="p">:</span> <span class="nc">GithubLowLevelClient</span><span class="p">,</span> <i class="conum" data-value="2"></i><b>(2)</b>
                       <span class="k">private</span> <span class="kd">val</span> <span class="py">githubApiClient</span><span class="p">:</span> <span class="nc">GithubApiClient</span><span class="p">)</span> <span class="p">{</span>

    <span class="nd">@Get</span><span class="p">(</span><span class="s">"/releases-lowlevel"</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="nd">@SingleResult</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="k">fun</span> <span class="nf">releasesWithLowLevelClient</span><span class="p">():</span> <span class="nc">Publisher</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">GithubRelease</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">githubLowLevelClient</span><span class="p">.</span><span class="nf">fetchReleases</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="nd">@Get</span><span class="p">(</span><span class="s">"/releases"</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="nd">@SingleResult</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="k">fun</span> <span class="nf">fetchReleases</span><span class="p">():</span> <span class="nc">Publisher</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">GithubRelease</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">githubApiClient</span><span class="p">.</span><span class="nf">fetchReleases</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/github</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject beans via constructor injection.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the <code>index</code> method to all requests that use an HTTP GET</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Annotation to describe that an API emits a single result even if the return type is an <code>org.reactivestreams.Publisher</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the <code>fetchReleases</code> method to an HTTP GET request on <code>/releases</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tests">4.7. Tests</h3>
<div class="paragraph">
<p>We will mock the GitHub API with some releases</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here we only show a single release.
      If you download the complete solution, you will find a file with multiple releases.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">src/test/resources/releases.json</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">[{</span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://api.github.com/repos/micronaut-projects/micronaut-core/releases/91622014"</span><span class="p">,</span><span class="nl">"assets_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/repos/micronaut-projects/micronaut-core/releases/91622014/assets"</span><span class="p">,</span><span class="nl">"upload_url"</span><span class="p">:</span><span class="s2">"https://uploads.github.com/repos/micronaut-projects/micronaut-core/releases/91622014/assets{?name,label}"</span><span class="p">,</span><span class="nl">"html_url"</span><span class="p">:</span><span class="s2">"https://github.com/micronaut-projects/micronaut-core/releases/tag/v3.8.4"</span><span class="p">,</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">91622014</span><span class="p">,</span><span class="nl">"author"</span><span class="p">:{</span><span class="nl">"login"</span><span class="p">:</span><span class="s2">"sdelamo"</span><span class="p">,</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">864788</span><span class="p">,</span><span class="nl">"node_id"</span><span class="p">:</span><span class="s2">"MDQ6VXNlcjg2NDc4OA=="</span><span class="p">,</span><span class="nl">"avatar_url"</span><span class="p">:</span><span class="s2">"https://avatars.githubusercontent.com/u/864788?v=4"</span><span class="p">,</span><span class="nl">"gravatar_id"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo"</span><span class="p">,</span><span class="nl">"html_url"</span><span class="p">:</span><span class="s2">"https://github.com/sdelamo"</span><span class="p">,</span><span class="nl">"followers_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/followers"</span><span class="p">,</span><span class="nl">"following_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/following{/other_user}"</span><span class="p">,</span><span class="nl">"gists_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/gists{/gist_id}"</span><span class="p">,</span><span class="nl">"starred_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/starred{/owner}{/repo}"</span><span class="p">,</span><span class="nl">"subscriptions_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/subscriptions"</span><span class="p">,</span><span class="nl">"organizations_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/orgs"</span><span class="p">,</span><span class="nl">"repos_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/repos"</span><span class="p">,</span><span class="nl">"events_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/events{/privacy}"</span><span class="p">,</span><span class="nl">"received_events_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/sdelamo/received_events"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"User"</span><span class="p">,</span><span class="nl">"site_admin"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span><span class="nl">"node_id"</span><span class="p">:</span><span class="s2">"RE_kwDOB2eaPM4Fdgp-"</span><span class="p">,</span><span class="nl">"tag_name"</span><span class="p">:</span><span class="s2">"v3.8.4"</span><span class="p">,</span><span class="nl">"target_commitish"</span><span class="p">:</span><span class="s2">"3.8.x"</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Micronaut Framework 3.8.4"</span><span class="p">,</span><span class="nl">"draft"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"prerelease"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"created_at"</span><span class="p">:</span><span class="s2">"2023-02-07T15:53:03Z"</span><span class="p">,</span><span class="nl">"published_at"</span><span class="p">:</span><span class="s2">"2023-02-07T15:53:05Z"</span><span class="p">,</span><span class="nl">"assets"</span><span class="p">:[{</span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://api.github.com/repos/micronaut-projects/micronaut-core/releases/assets/94667997"</span><span class="p">,</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">94667997</span><span class="p">,</span><span class="nl">"node_id"</span><span class="p">:</span><span class="s2">"RA_kwDOB2eaPM4FpITd"</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"artifacts.zip"</span><span class="p">,</span><span class="nl">"label"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nl">"uploader"</span><span class="p">:{</span><span class="nl">"login"</span><span class="p">:</span><span class="s2">"github-actions[bot]"</span><span class="p">,</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">41898282</span><span class="p">,</span><span class="nl">"node_id"</span><span class="p">:</span><span class="s2">"MDM6Qm90NDE4OTgyODI="</span><span class="p">,</span><span class="nl">"avatar_url"</span><span class="p">:</span><span class="s2">"https://avatars.githubusercontent.com/in/15368?v=4"</span><span class="p">,</span><span class="nl">"gravatar_id"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D"</span><span class="p">,</span><span class="nl">"html_url"</span><span class="p">:</span><span class="s2">"https://github.com/apps/github-actions"</span><span class="p">,</span><span class="nl">"followers_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/followers"</span><span class="p">,</span><span class="nl">"following_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}"</span><span class="p">,</span><span class="nl">"gists_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}"</span><span class="p">,</span><span class="nl">"starred_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}"</span><span class="p">,</span><span class="nl">"subscriptions_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions"</span><span class="p">,</span><span class="nl">"organizations_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/orgs"</span><span class="p">,</span><span class="nl">"repos_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/repos"</span><span class="p">,</span><span class="nl">"events_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}"</span><span class="p">,</span><span class="nl">"received_events_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/received_events"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"Bot"</span><span class="p">,</span><span class="nl">"site_admin"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span><span class="nl">"content_type"</span><span class="p">:</span><span class="s2">"application/zip"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"uploaded"</span><span class="p">,</span><span class="nl">"size"</span><span class="p">:</span><span class="mi">28063979</span><span class="p">,</span><span class="nl">"download_count"</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="nl">"created_at"</span><span class="p">:</span><span class="s2">"2023-02-07T16:18:05Z"</span><span class="p">,</span><span class="nl">"updated_at"</span><span class="p">:</span><span class="s2">"2023-02-07T16:18:06Z"</span><span class="p">,</span><span class="nl">"browser_download_url"</span><span class="p">:</span><span class="s2">"https://github.com/micronaut-projects/micronaut-core/releases/download/v3.8.4/artifacts.zip"</span><span class="p">},{</span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://api.github.com/repos/micronaut-projects/micronaut-core/releases/assets/94669478"</span><span class="p">,</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">94669478</span><span class="p">,</span><span class="nl">"node_id"</span><span class="p">:</span><span class="s2">"RA_kwDOB2eaPM4FpIqm"</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"multiple.intoto.jsonl"</span><span class="p">,</span><span class="nl">"label"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nl">"uploader"</span><span class="p">:{</span><span class="nl">"login"</span><span class="p">:</span><span class="s2">"github-actions[bot]"</span><span class="p">,</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">41898282</span><span class="p">,</span><span class="nl">"node_id"</span><span class="p">:</span><span class="s2">"MDM6Qm90NDE4OTgyODI="</span><span class="p">,</span><span class="nl">"avatar_url"</span><span class="p">:</span><span class="s2">"https://avatars.githubusercontent.com/in/15368?v=4"</span><span class="p">,</span><span class="nl">"gravatar_id"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D"</span><span class="p">,</span><span class="nl">"html_url"</span><span class="p">:</span><span class="s2">"https://github.com/apps/github-actions"</span><span class="p">,</span><span class="nl">"followers_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/followers"</span><span class="p">,</span><span class="nl">"following_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}"</span><span class="p">,</span><span class="nl">"gists_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}"</span><span class="p">,</span><span class="nl">"starred_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}"</span><span class="p">,</span><span class="nl">"subscriptions_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions"</span><span class="p">,</span><span class="nl">"organizations_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/orgs"</span><span class="p">,</span><span class="nl">"repos_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/repos"</span><span class="p">,</span><span class="nl">"events_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}"</span><span class="p">,</span><span class="nl">"received_events_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/users/github-actions%5Bbot%5D/received_events"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"Bot"</span><span class="p">,</span><span class="nl">"site_admin"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span><span class="nl">"content_type"</span><span class="p">:</span><span class="s2">"application/octet-stream"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"uploaded"</span><span class="p">,</span><span class="nl">"size"</span><span class="p">:</span><span class="mi">65612</span><span class="p">,</span><span class="nl">"download_count"</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span><span class="nl">"created_at"</span><span class="p">:</span><span class="s2">"2023-02-07T16:32:49Z"</span><span class="p">,</span><span class="nl">"updated_at"</span><span class="p">:</span><span class="s2">"2023-02-07T16:32:49Z"</span><span class="p">,</span><span class="nl">"browser_download_url"</span><span class="p">:</span><span class="s2">"https://github.com/micronaut-projects/micronaut-core/releases/download/v3.8.4/multiple.intoto.jsonl"</span><span class="p">}],</span><span class="nl">"tarball_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/repos/micronaut-projects/micronaut-core/tarball/v3.8.4"</span><span class="p">,</span><span class="nl">"zipball_url"</span><span class="p">:</span><span class="s2">"https://api.github.com/repos/micronaut-projects/micronaut-core/zipball/v3.8.4"</span><span class="p">,</span><span class="nl">"body"</span><span class="p">:</span><span class="s2">"&lt;!-- Release notes generated using configuration in .github/release.yml at 3.8.x --&gt;</span><span class="se">\r\n\r\n\r\n</span><span class="s2">## What's Changed</span><span class="se">\r\n\r\n</span><span class="s2">### Bugs 🐛</span><span class="se">\r\n</span><span class="s2">* Allow programmatic logback config if xml config is absent (#8674)</span><span class="se">\r\n</span><span class="s2">* Tweak uri to account for WebLogic/Windows URIs by @mattmoss in https://github.com/micronaut-projects/micronaut-core/pull/8704</span><span class="se">\r\n\r\n</span><span class="s2">### Docs 📖</span><span class="se">\r\n</span><span class="s2">* Docs on self-signed cert setup (#8684)</span><span class="se">\r\n\r\n</span><span class="s2">### Dependency Upgrades 🚀</span><span class="se">\r\n\r\n</span><span class="s2">* Micronaut Test to 3.8.2 (#8728)</span><span class="se">\r\n</span><span class="s2">* Micronaut OpenAPI to 4.8.3 (#8724)</span><span class="se">\r\n</span><span class="s2">* Micronaut Data to 3.9.6 (#8711)</span><span class="se">\r\n</span><span class="s2">* Micronaut Rabbit to 3.4.1 (#8709)</span><span class="se">\r\n</span><span class="s2">* Micronaut Azure to 3.7.1 (#8682)</span><span class="se">\r\n</span><span class="s2">* Micronaut Micrometer to 4.7.2 (#8681)</span><span class="se">\r\n\r\n</span><span class="s2">### Tests ✅</span><span class="se">\r\n\r\n</span><span class="s2">* Require docker for test (#8698)</span><span class="se">\r\n</span><span class="s2">* Add octet stream serialization to the TCK (#8712)</span><span class="se">\r\n\r\n</span><span class="s2">**Full Changelog**: https://github.com/micronaut-projects/micronaut-core/compare/v3.8.3...v3.8.4"</span><span class="p">,</span><span class="nl">"mentions_count"</span><span class="p">:</span><span class="mi">1</span><span class="p">}]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a test to verify that both clients work as expected, and the controller echoes the output of the GitHub API in a Reactive way.</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/GithubControllerTest.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.context.ApplicationContext</span>
<span class="k">import</span> <span class="nn">io.micronaut.context.annotation.Requires</span>
<span class="k">import</span> <span class="nn">io.micronaut.core.io.ResourceLoader</span>
<span class="k">import</span> <span class="nn">io.micronaut.core.type.Argument</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpRequest</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.HttpStatus</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.Controller</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.Get</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.Produces</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.client.BlockingHttpClient</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.client.HttpClient</span>
<span class="k">import</span> <span class="nn">io.micronaut.runtime.server.EmbeddedServer</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions.assertEquals</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions.assertNotNull</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>
<span class="k">import</span> <span class="nn">java.util.regex.Pattern</span>

<span class="kd">class</span> <span class="nc">GithubControllerTest</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">MICRONAUT_RELEASE</span> <span class="p">=</span>
            <span class="nc">Pattern</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="s">"Micronaut (Core |Framework )?v?\\d+.\\d+.\\d+( (RC|M)\\d)?"</span><span class="p">)</span>

    <span class="nd">@Test</span>
    <span class="k">fun</span> <span class="nf">verifyGithubReleasesCanBeFetchedWithLowLevelHttpClient</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">config</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span><span class="s">"micronaut.codec.json.additional-types"</span> <span class="n">to</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"application/vnd.github.v3+json"</span><span class="p">),</span>
            <span class="s">"spec.name"</span> <span class="n">to</span> <span class="s">"GithubControllerTest"</span><span class="p">)</span>  <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="kd">val</span> <span class="py">github</span> <span class="p">:</span> <span class="nc">EmbeddedServer</span> <span class="p">=</span> <span class="nc">ApplicationContext</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nc">EmbeddedServer</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">embeddedServer</span> <span class="p">:</span> <span class="nc">EmbeddedServer</span>  <span class="p">=</span> <span class="nc">ApplicationContext</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nc">EmbeddedServer</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span>
            <span class="nf">mapOf</span><span class="p">(</span><span class="s">"micronaut.http.services.github.url"</span> <span class="n">to</span> <span class="s">"http://localhost:${github.port}"</span><span class="p">)</span>
        <span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="kd">val</span> <span class="py">httpClient</span> <span class="p">:</span> <span class="nc">HttpClient</span> <span class="p">=</span> <span class="n">embeddedServer</span><span class="p">.</span><span class="n">applicationContext</span>
            <span class="p">.</span><span class="nf">createBean</span><span class="p">(</span><span class="nc">HttpClient</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="n">embeddedServer</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">client</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="nf">toBlocking</span><span class="p">()</span>
        <span class="nf">assertReleases</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">"/github/releases"</span><span class="p">)</span>
        <span class="nf">assertReleases</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">"/github/releases-lowlevel"</span><span class="p">)</span>
        <span class="n">httpClient</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="n">embeddedServer</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="n">github</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">assertReleases</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="nc">BlockingHttpClient</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">:</span> <span class="nc">HttpRequest</span><span class="p">&lt;</span><span class="nc">Any</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nc">HttpRequest</span><span class="p">.</span><span class="nc">GET</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">rsp</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">exchange</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="nc">Argument</span><span class="p">.</span><span class="nf">listOf</span><span class="p">(</span><span class="nc">GithubRelease</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">))</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="nf">assertEquals</span><span class="p">(</span><span class="nc">HttpStatus</span><span class="p">.</span><span class="nc">OK</span><span class="p">,</span> <span class="n">rsp</span><span class="p">.</span><span class="n">status</span><span class="p">)</span>   <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="kd">val</span> <span class="py">releases</span> <span class="p">=</span> <span class="n">rsp</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span>
        <span class="nf">assertNotNull</span><span class="p">(</span><span class="n">releases</span><span class="p">)</span>
        <span class="nf">assertReleases</span><span class="p">(</span><span class="n">releases</span><span class="p">.</span><span class="nf">toList</span><span class="p">())</span> <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">assertReleases</span><span class="p">(</span><span class="n">releases</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">GithubRelease</span><span class="p">&gt;)</span> <span class="p">{</span>
        <span class="nf">assertNotNull</span><span class="p">(</span><span class="n">releases</span><span class="p">)</span>
        <span class="nc">Assertions</span><span class="p">.</span><span class="nf">assertTrue</span><span class="p">(</span><span class="n">releases</span>
            <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">name</span> <span class="p">}</span>
            <span class="p">.</span><span class="nf">all</span> <span class="p">{</span> <span class="nc">MICRONAUT_RELEASE</span><span class="p">.</span><span class="nf">matcher</span><span class="p">(</span><span class="n">it</span><span class="p">).</span><span class="nf">find</span><span class="p">()</span> <span class="p">})</span>
    <span class="p">}</span>

    <span class="nd">@Requires</span><span class="p">(</span><span class="n">property</span> <span class="p">=</span> <span class="s">"spec.name"</span><span class="p">,</span> <span class="n">value</span> <span class="p">=</span> <span class="s">"GithubControllerTest"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="nd">@Controller</span>
    <span class="kd">class</span> <span class="nc">GithubReleases</span><span class="p">(</span><span class="kd">val</span> <span class="py">resourceLoader</span> <span class="p">:</span> <span class="nc">ResourceLoader</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">@Produces</span><span class="p">(</span><span class="s">"application/vnd.github.v3+json"</span><span class="p">)</span>
        <span class="nd">@Get</span><span class="p">(</span><span class="s">"/repos/micronaut-projects/micronaut-core/releases"</span><span class="p">)</span>
        <span class="k">fun</span> <span class="nf">coreReleases</span><span class="p">()</span> <span class="p">:</span> <span class="nc">String</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">resourceLoader</span><span class="p">.</span><span class="nf">getResource</span><span class="p">(</span><span class="s">"releases.json"</span><span class="p">).</span><span class="nf">orElseThrow</span><span class="p">().</span><span class="nf">readText</span><span class="p">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Combine <code>@Requires</code> and properties (either via the <code>@Property</code> annotation or by passing properties when starting the context) to avoid bean pollution.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This test mocks an HTTP Server for <code>GitHub</code> with an extra Micronaut Embedded Server. This allows you to test how your application behaves with a specific JSON response or avoid issues such as rate limits which can make your tests flaky.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a sample <code>releases.json</code> file in <code>src/test/resources</code> directory. To get some test data call GitHub API with curl or provide a few entries yourself.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Sometimes, receiving just the object is not enough, and you need information about the response. In this case, instead of <code>retrieve</code> you should use the <code>exchange</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Micronaut HTTP Client simplifies binding a JSON array to a list of POJOs by using <code>Argument::listOf</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use <code>status</code> to check the HTTP status code.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Use <code>.body()</code> to retrieve the parsed payload.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application">5. Testing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">./mvnw <span class="nb">test</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-client-filter">6. HTTP Client Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Often, you need to include the same HTTP headers or URL parameters in a set of requests against a third-party API or when calling another Microservice. To simplify this, the Micronaut framework includes the ability to define <code>HttpClientFilter</code> classes that are applied to all matching HTTP clients.</p>
</div>
<div class="paragraph">
<p>For a real world example, let us provide GitHub Authentication via an <code>HttpClientFilter</code>. Follow the steps in
<a href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">to create your own Personal Token</a>.
Then you can use those credentials to access the GitHub API
<a href="https://docs.github.com/en/rest/overview/other-authentication-methods#via-oauth-and-personal-access-tokens">using Basic Auth</a>.</p>
</div>
<div class="paragraph">
<p>Create a Filter:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubFilter.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.context.annotation.Requires</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.MutableHttpRequest</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.ClientFilter</span>
<span class="k">import</span> <span class="nn">io.micronaut.http.annotation.RequestFilter</span>

<span class="nd">@ClientFilter</span><span class="p">(</span><span class="s">"/repos/**"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nd">@Requires</span><span class="p">(</span><span class="n">condition</span> <span class="p">=</span> <span class="nc">GithubFilterCondition</span><span class="o">::</span><span class="k">class</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="kd">class</span> <span class="nc">GithubFilter</span><span class="p">(</span><span class="kd">val</span> <span class="py">configuration</span><span class="p">:</span> <span class="nc">GithubConfiguration</span><span class="p">)</span> <span class="p">{</span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="nd">@RequestFilter</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="k">fun</span> <span class="nf">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="nc">MutableHttpRequest</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;)</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">.</span><span class="nf">basicAuth</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="n">configuration</span><span class="p">.</span><span class="n">token</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@ClientFilter</code> and define the ANT Matcher pattern to intercept all the calls to the desire URI.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Kotlin doesn&#8217;t support runtime repeatable annotations (see <a href="https://youtrack.jetbrains.com/issue/KT-12794">KT-12794</a>. We use a custom condition to enable the bean where appropriate.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor injection of the configuration parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A request filter is called before the request is sent out.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Enhance every request sent to GitHub API providing Basic Authentication.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a custom Condition:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubFilterCondition.kt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">example.micronaut</span>

<span class="k">import</span> <span class="nn">io.micronaut.context.condition.Condition</span>
<span class="k">import</span> <span class="nn">io.micronaut.context.condition.ConditionContext</span>
<span class="k">import</span> <span class="nn">io.micronaut.context.exceptions.NoSuchBeanException</span>

<span class="kd">class</span> <span class="nc">GithubFilterCondition</span> <span class="p">:</span> <span class="nc">Condition</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">matches</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">ConditionContext</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">context</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">context</span><span class="p">.</span><span class="n">beanContext</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">githubConfiguration</span><span class="p">:</span> <span class="nc">GithubConfiguration</span> <span class="p">=</span>
                    <span class="n">context</span><span class="p">.</span><span class="n">beanContext</span><span class="p">.</span><span class="nf">getBean</span><span class="p">(</span><span class="nc">GithubConfiguration</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
                <span class="k">if</span> <span class="p">(</span><span class="n">githubConfiguration</span><span class="p">.</span><span class="n">token</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">githubConfiguration</span><span class="p">.</span><span class="n">username</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">true</span> <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">NoSuchBeanException</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Implement Micronaut <code>Condition</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the <code>GithubConfiguration</code> bean from the application context.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Only return <code>true</code> when the <code>token</code> and the <code>username</code> exist.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="configuration-parameters">6.1. Configuration Parameters</h3>
<div class="paragraph">
<p>Add your GitHub <code>username</code> and <code>token</code> to <code>src/main/resources/application.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">github</span><span class="pi">:</span>
  <span class="na">organization</span><span class="pi">:</span> <span class="s">micronaut-projects</span>
  <span class="na">repo</span><span class="pi">:</span> <span class="s">micronaut-core</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">yourgithubusername</span>
  <span class="na">token</span><span class="pi">:</span> <span class="s">xxxxxxxxxxxx</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add a logger to <code>src/main/resources/logback.xml</code> to see the HTTP client output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"io.micronaut.http.client"</span> <span class="na">level=</span><span class="s">"TRACE"</span><span class="nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run again the tests, you will see the that the Filter is invoked and HTTP Basic Auth is used against GitHub API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">13:09:56.662 <span class="o">[</span>default-nioEventLoopGroup-1-4] DEBUG i.m.h.client.netty.DefaultHttpClient - Sending HTTP GET to https://api.github.com/repos/micronaut-projects/micronaut-core/releases
13:09:56.663 <span class="o">[</span>default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - User-Agent: Micronaut HTTP Client
13:09:56.663 <span class="o">[</span>default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - Accept: application/json
13:09:56.663 <span class="o">[</span>default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - Authorization: MASKED
13:09:56.664 <span class="o">[</span>default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - host: api.github.com</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-a-micronaut-application-native-executable-with-graalvm">7. Generate a Micronaut Application Native Executable with GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use <a href="https://www.graalvm.org/">GraalVM</a>, an advanced JDK with ahead-of-time Native Image compilation, to generate a native executable of this Micronaut application.</p>
</div>
<div class="paragraph">
<p>Compiling Micronaut applications ahead of time with GraalVM significantly improves startup time and reduces the memory footprint of JVM-based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only Java and Kotlin projects support using GraalVM&#8217;s <code>native-image</code> tool. Groovy relies heavily on reflection, which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="graalvm-installation">7.1. GraalVM Installation</h3>
<div class="paragraph">
<p>The easiest way to install <a href="https://www.graalvm.org">GraalVM</a> on Linux or Mac is to use <a href="https://sdkman.io/">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="title">Java 21</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">sdk <span class="nb">install </span>java 21.0.5-graal</code></pre>
</div>
</div>
<div class="paragraph">
<p>For installation on Windows, or for a manual installation on Linux or Mac, see the <a href="https://www.graalvm.org/latest/docs/getting-started/">GraalVM Getting Started</a> documentation.</p>
</div>
<div class="paragraph">
<p>The previous command installs Oracle GraalVM, which is free to use in production and free to redistribute, at no cost, under the <a href="https://www.oracle.com/downloads/licenses/graal-free-license.html">GraalVM Free Terms and Conditions</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <a href="https://github.com/graalvm/graalvm-ce-builds/releases/">GraalVM Community Edition</a>:</p>
</div>
<div class="listingblock">
<div class="title">Java 21</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">sdk <span class="nb">install </span>java 21.0.2-graalce</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="native-executable-generation">7.2. Native Executable Generation</h3>
<div class="paragraph">
<p>To generate a native executable using Maven, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">./mvnw package <span class="nt">-Dpackaging</span><span class="o">=</span>native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native executable is created in the <code>target</code> directory and can be run with <code>target/micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to customize the name of the native executable or pass additional build arguments using the <a href="https://graalvm.github.io/native-build-tools/latest/maven-plugin.html">Maven plugin for GraalVM Native Image building</a>. Declare the plugin as following:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.graalvm.buildtools<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>native-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.10.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="c">&lt;!-- &lt;1&gt; --&gt;</span>
        <span class="nt">&lt;imageName&gt;</span>mn-graalvm-application<span class="nt">&lt;/imageName&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="nt">&lt;buildArgs&gt;</span>
	      <span class="c">&lt;!-- &lt;2&gt; --&gt;</span>
          <span class="nt">&lt;buildArg&gt;</span>-Ob<span class="nt">&lt;/buildArg&gt;</span>
        <span class="nt">&lt;/buildArgs&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The native executable name will now be <code>mn-graalvm-application</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It is possible to pass extra build arguments to <code>native-image</code>. For example, <code>-Ob</code> enables the quick build mode.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">8. Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Visit <a href="https://docs.micronaut.io/latest/guide/#httpClient">Micronaut HTTP Client documentation</a> to learn more.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="help-with-the-micronaut-framework">9. Help with the Micronaut Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://micronaut.io/foundation/">Micronaut Foundation</a> sponsored the creation of this Guide. A variety of <a href="https://micronaut.io/commercial-support/">consulting and support services</a> are available.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license">10. License</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All guides are released with an <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache license 2.0 license</a> for the code and a <a href="https://creativecommons.org/licenses/by/4.0/deed.en">Creative Commons Attribution 4.0</a> license for the writing and media (images&#8230;&#8203;).
</td>
</tr>
</table>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <a href="https://micronaut.io/foundation/"><img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/></a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li id="menu-item-6740" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6740"><a href="https://fosstodon.org/@micronaut"><i class="fab fa-mastodon"><span class="sr-only">Mastodon</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://discord.gg/9xRFsHv98T"><i class="fab fa-discord"><span class="sr-only">Discord</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>Guides are licensed under <a href="https://creativecommons.org/licenses/by/4.0/deed.en">CC BY 4.0</a> for the writing/media and <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache.2.0</a> for the code</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
