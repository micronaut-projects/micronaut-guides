<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Using Kotlin Extension Functions in the Micronaut Framework</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="alternate" type="application/rss+xml" title="Micronaut Guides RSS Feed" href="https://guides.micronaut.io/latest/rss.xml" />
    <link rel="alternate" type="application/json" title="Micronaut Guides JSON Feed" href="https://guides.micronaut.io/latest/feed.json" />
    <link href="coderay.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="lunr.js"></script>
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronaut-kotlin-extension-fns.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="Using Kotlin Extension Functions in the Micronaut Framework"/>
    <meta name="twitter:description" content="Take a tour of the extension functions in the Micronaut framework and learn to write your own"/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item"><a href="https://micronaut.io/download/" class="nav-link">Download</a></li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-2868 dropdown nav-item"><a href="https://micronaut.io/learn/" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a><ul class="dropdown-menu">
                        <li id="menu-item-4943" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4943"><a href="https://micronaut.io/learn/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-5111" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5111"><a href="https://docs.micronaut.io/index.html" class="dropdown-item">User Documentaton</a></li>
                        <li id="menu-item-4510" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4510"><a href="https://micronaut.io/guides/" class="dropdown-item">Guides</a></li>
                        <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896"><a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a></li>
                        <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897"><a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a></li>
                        <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871"><a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a></li>
                        <li id="menu-item-6526" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6526"><a href="https://micronaut-projects.github.io/micronaut-guides-mn3/latest/" class="dropdown-item">Guides for Micronaut Framework 3</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item"><a href="https://micronaut.io/resources/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a><ul class="dropdown-menu">
                        <li id="menu-item-4999" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4999"><a href="https://micronaut.io/upcoming-events/" class="dropdown-item">Upcoming Events</a></li>
                        <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879"><a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a></li>
                        <li id="menu-item-6478" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6478"><a href="https://micronaut.io/category/release-announcements/" class="dropdown-item">Releases</a></li>
                        <li id="menu-item-6715" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6715"><a href="https://micronaut.io/category/security-announcements/" class="dropdown-item">Security Announcements</a></li>
                        <li id="menu-item-4499" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4499"><a href="https://micronautpodcast.com/" class="dropdown-item">Podcast</a></li>
                        <li id="menu-item-5798" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5798"><a href="https://micronaut.io/support/" class="dropdown-item">Commercial Support</a></li>
                        <li id="menu-item-4186" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4186"><a href="https://micronaut.io/resources/community-support/" class="dropdown-item">Community Support</a></li>
                        <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882"><a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a></li>
                        <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883"><a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a></li>
                        <li id="menu-item-6479" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6479"><a href="https://micronaut.io/micronaut-success-stories/" class="dropdown-item">Micronaut Success Stories</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2872 dropdown nav-item"><a href="https://micronaut.io/foundation/" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a><ul class="dropdown-menu">
                        <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2877"><a href="https://micronaut.io/foundation/" class="dropdown-item">Overview</a></li>
                        <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874"><a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a></li>
                        <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873"><a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a></li>
                        <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876"><a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a></li>
                        <li id="menu-item-3838" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3838"><a href="https://micronaut.io/meeting-minutes/" class="dropdown-item">Meeting Minutes</a></li>
                    </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item"><a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a></li>

                </ul>

            </div>

        </nav>

    </div>
</header>

<div style="background: #fff;padding-top: 20px;padding-bottom: 20px;">
    <div class="container" style="clear: both;">
        <fieldset style="float: right;">
            <input type="search" id="search-form-query"/>
            <input type="submit" onclick="search()" value="Search">
            <input type="submit" onclick="resetSearch()" value="Reset">
        </fieldset>
    </div>
    <div class="container" style="clear: both;margin-top: -20px;">
        <div class="guide-list" id="searchResults">
        </div>
    </div>
</div>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-kotlin-extension-fns.html">Using Kotlin Extension Functions in the Micronaut Framework</a> » <span class="breadcrumb_last" aria-current="page">maven | kotlin</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#kotlin-extension-functions">4. Kotlin Extension Functions</a>
<ul class="sectlevel2">
<li><a href="#what-are-extension-functions">4.1. What Are Extension Functions?</a></li>
<li><a href="#using-extension-functions-in-an-application">4.2. Using Extension Functions in an Application</a></li>
</ul>
</li>
<li><a href="#writing-the-application">5. Writing the Application</a>
<ul class="sectlevel2">
<li><a href="#the-micronaut-kotlin-extension-functions">5.1. The Micronaut Kotlin Extension Functions</a></li>
<li><a href="#application">5.2. Application</a></li>
<li><a href="#dadjokeclient">5.3. DadJokeClient</a></li>
<li><a href="#dadjokecontroller">5.4. DadJokeController</a></li>
<li><a href="#writing-some-tests">5.5. Writing some tests</a></li>
</ul>
</li>
<li><a href="#testing-the-application">6. Testing the Application</a></li>
<li><a href="#running-the-application">7. Running the Application</a></li>
<li><a href="#generate-a-micronaut-application-native-executable-with-graalvm">8. Generate a Micronaut Application Native Executable with GraalVM</a>
<ul class="sectlevel2">
<li><a href="#graalvm-installation">8.1. GraalVM Installation</a></li>
<li><a href="#native-executable-generation">8.2. Native Executable Generation</a></li>
</ul>
</li>
<li><a href="#next-steps">9. Next Steps</a></li>
<li><a href="#help-with-the-micronaut-framework">10. Help with the Micronaut Framework</a></li>
<li><a href="#license">11. License</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Using Kotlin Extension Functions in the Micronaut Framework</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Take a tour of the extension functions in the Micronaut framework and learn to write your own</p>
</div>
<div class="paragraph">
<p>Authors: Will Buck</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 4.9.1</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we will create a Micronaut application written in Kotlin.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE (e.g. <a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">IntelliJ IDEA</a>)</p>
</li>
<li>
<p>JDK 21 or greater installed with <code>JAVA_HOME</code> <a href="https://www.baeldung.com/java-home-on-windows-7-8-10-mac-os-x-linux">configured appropriately</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-kotlin-extension-fns-maven-kotlin.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kotlin-extension-functions">4. Kotlin Extension Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we get started writing the application, let&#8217;s touch briefly on what extension functions are and why they&#8217;re useful.</p>
</div>
<div class="sect2">
<h3 id="what-are-extension-functions">4.1. What Are Extension Functions?</h3>
<div class="paragraph">
<p>The <a href="https://kotlinlang.org/docs/extensions.html">Kotlin documentation</a> explains that extension functions are "an ability to extend a class with new functionality without having to inherit from the class or use design patterns such as Decorator."</p>
</div>
<div class="paragraph">
<p>They&#8217;re useful for writing new functions for classes in a third-party library or quickly creating new methods for common use cases of a class you otherwise can&#8217;t edit directly.</p>
</div>
<div class="paragraph">
<p>For example, perhaps your application often needs to take a list and swap the index of two items in the list.</p>
</div>
<div class="paragraph">
<p>To define a <code>swap</code> method for any mutable list, you could write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">fun &lt;T&gt; MutableList&lt;T&gt;.swap(index1: Int, index2: Int) {
    val tmp = this[index1] // 'this' corresponds to the list
    this[index1] = this[index2]
    this[index2] = tmp
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then use it like it was a regular method of <code>MutableList</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val languages = mutableListOf('java', 'groovy', 'kotlin')

languages.swap(0, 2) // Will swap 'java' and 'kotlin' so kotlin comes first</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-extension-functions-in-an-application">4.2. Using Extension Functions in an Application</h3>
<div class="paragraph">
<p>To show off the extension functions available for use in Micronaut applications (and how to write your own), we&#8217;ll build a simple application that</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consumes <a href="https://icanhazdadjoke.com/api">this fun dad joke API</a> (I love a good dad joke) with an HTTP client</p>
</li>
<li>
<p>Schedules the joke to "be sent" to someone [we won&#8217;t actually be integrating a message sender for simplicity]</p>
</li>
<li>
<p>Writes our own extension function for the client (as if it was provided by a third party)</p>
</li>
<li>
<p>Puts everything together in a controller</p>
</li>
<li>
<p>Starts the application with the <code>startApplication</code> extension function</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-application">5. Writing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an application using the <a href="https://docs.micronaut.io/latest/guide/#cli">Micronaut Command Line Interface</a> or with <a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn create-app example.micronaut.micronautguide \
    --features=kotlin-extension-functions,reactor,http-client,graalvm \
    --build=maven \
    --lang=kotlin \
    --test=junit</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle with the <a href="https://docs.gradle.org/current/userguide/kotlin_dsl.html">Kotlin DSL</a> is used as the build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as the language.<br/> If you don&#8217;t specify the <code>--test</code> argument, JUnit is used for Java and Kotlin, and Spock is used for Groovy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command creates a Micronaut application with the default package <code>example.micronaut</code> in a directory named <code>micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>If you use Micronaut Launch, select Micronaut Application as application type and add <code>kotlin-extension-functions</code>, <code>reactor</code>, <code>http-client</code>, and <code>graalvm</code> features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have an existing Micronaut application and want to add the functionality described here, you can view the dependency and configuration changes from the specified features, and apply those changes to your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://micronaut.io/launch?features=kotlin-extension-functions&amp;features=reactor&amp;features=http-client&amp;features=graalvm&amp;lang=KOTLIN&amp;build=MAVEN&amp;test=JUNIT&amp;name=micronautguide&amp;type=DEFAULT&amp;package=example.micronaut&amp;activity=diff" target="_blank" rel="noopener">Diff</a></p>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">Setup IntelliJ IDEA to develop Micronaut Applications</a>.</p>
</div>
<div class="sect2">
<h3 id="the-micronaut-kotlin-extension-functions">5.1. The Micronaut Kotlin Extension Functions</h3>
<div class="paragraph">
<p>We&#8217;re using the <a href="https://micronaut-projects.github.io/micronaut-kotlin/latest/guide/#extensionFunctions">Micronaut Kotlin extension function library</a> which aids Kotlin developers in writing more idiomatic code in Micronaut.</p>
</div>
<div class="paragraph">
<p>You can see the <a href="https://micronaut-projects.github.io/micronaut-kotlin/latest/api/">dokka docs for the full list of functions here</a>.</p>
</div>
<div class="paragraph">
<p>Big credit is due to <a href="https://github.com/ideaplugins">Alejandro Gomez</a> for allowing for the use of his initial collection of extension functions!</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see these functions in action!</p>
</div>
</div>
<div class="sect2">
<h3 id="application">5.2. Application</h3>
<div class="paragraph">
<p>Right away let&#8217;s modify the generated <code>Application.kt</code> to use the <code>startApplication</code> extension function</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/Application.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.kotlin.runtime.startApplication <i class="conum" data-value="1"></i><b>(1)</b>

object ApplicationKt { <i class="conum" data-value="2"></i><b>(2)</b>
        @JvmStatic
        fun main(args: Array&lt;String&gt;) {
                startApplication&lt;ApplicationKt&gt;(*args) <i class="conum" data-value="3"></i><b>(3)</b>
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we import the extension function</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Since the extension function takes a type argument, we&#8217;ll define our Application as a Kotlin <code>object</code>, which is an easy shortcut for a singleton or place to put a static method like <code>main</code>.
We&#8217;re naming it <code>ApplicationKt</code> simply because this guide&#8217;s build file is auto-generated, and we want to match the mainClass name it generates. <code>Application</code> alone would be a preferable name outside the context of this guide.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>startApplication&lt;ApplicationKt&gt;</code> here does the work of <code>.build().mainClass(ApplicationKt::class.java).start()</code>. Convenient!</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dadjokeclient">5.3. DadJokeClient</h3>
<div class="paragraph">
<p>Next we&#8217;ll build out our functionality. We&#8217;ll start by modelling the response types for the plain <code>GET</code> request for the Dad Joke API (that just return a random joke), as well as the paged results that are returned from the <code>/search</code> endpoint.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/DadJoke.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.serde.annotation.Serdeable

@Serdeable <i class="conum" data-value="1"></i><b>(1)</b>
data class DadJoke(val id: String, val joke: String, val status: Int)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/DadJokePagedResults.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.serde.annotation.Serdeable

@Serdeable <i class="conum" data-value="1"></i><b>(1)</b>
data class DadJokePagedResults(
    val current_page: Int,
    val limit: Int,
    val previous_page: Int,
    val next_page: Int,
    val total_jokes: Int,
    val total_pages: Int,
    val results: List&lt;DadJoke&gt;
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We make both of these classes <code>@Serdeable</code> for compatibility with GraalVM, you can omit them if you do not plan to build a native executable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, we can create a standard Micronaut HTTP client for the DadJoke API endpoint, letting the <code>@Client</code> annotation implement the interface we define.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/DadJokeClient.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Header
import io.micronaut.http.annotation.QueryValue
import io.micronaut.http.client.annotation.Client
import reactor.core.publisher.Mono

@Client(&quot;https://icanhazdadjoke.com/&quot;)
@Header(name = &quot;Accept&quot;, value = &quot;application/json&quot;)
interface DadJokeClient {

    @Get
    fun tellMeAJoke(): Mono&lt;DadJoke&gt;

    @Get(&quot;/search?term={searchTerm}&quot;)
    fun searchDadJokes(@QueryValue searchTerm: String): Mono&lt;DadJokePagedResults&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that while <strong>we</strong> are creating this client for the purposes of this guide, often something like this comes from a third-party library.
Perhaps you&#8217;re getting it from a public dependency you don&#8217;t have permission to edit, or from another team within your company that has different priorities from your own team.</p>
</div>
<div class="paragraph">
<p>It could also be that you simply have a specific use case for the client involving specific setup for your application that doesn&#8217;t belong in the client.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how we can extend this client to suit our own use case.</p>
</div>
</div>
<div class="sect2">
<h3 id="dadjokecontroller">5.4. DadJokeController</h3>
<div class="paragraph">
<p>We&#8217;ll create a controller to utilize the client&#8217;s standard <code>GET</code> for a random joke.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/DadJokeController.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut


import io.micronaut.http.MediaType.TEXT_PLAIN
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import jakarta.inject.Inject
import reactor.core.publisher.Mono

@Controller(&quot;/dadJokes&quot;)
class DadJokeController {

    @Inject
    lateinit var dadJokeClient: DadJokeClient

    @Get(uri = &quot;/joke&quot;, produces = [TEXT_PLAIN])
    fun getAJoke(): Mono&lt;String&gt; {
        return Mono.from(dadJokeClient.tellMeAJoke()).map(DadJoke::joke)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, say we have a particular way we want to use a client frequently, for example attaching common headers or filling in some parameters by default.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s explore how we can extend the client for our benefit. We&#8217;ll define a method for the client to specifically look for jokes about dogs.</p>
</div>
<div class="paragraph">
<p>In your controller file, at the bottom, add this extension function definition:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/DadJokeController.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">fun DadJokeClient.getDogJokes(): Mono&lt;List&lt;DadJoke&gt;&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    return Mono.from(this.searchDadJokes(&quot;dog&quot;)).map(DadJokePagedResults::results)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a <code>getDogJokes</code> method on the <code>DadJokeClient</code>. This method will be available anywhere within the <code>example.micronaut</code> package</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While this is a simplified (and somewhat silly) example, you can imagine how with a more sophisticated API, this could be
a very powerful tool to encapsulate common functionality and explicitly relate it to the appropriate class, rather than
defining another class just to encapsulate this common routine.</p>
</div>
<div class="paragraph">
<p>We can then use this extension function within our controller by defining a <code>/dogJoke</code> endpoint</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/DadJokeController.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    @Get(&quot;/dogJokes&quot;)
    fun getDogJokes(): Mono&lt;List&lt;DadJoke&gt;&gt; {
        return dadJokeClient.getDogJokes() <i class="conum" data-value="1"></i><b>(1)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note how we can use this function as if it were defined on the client class itself.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we have our application!</p>
</div>
</div>
<div class="sect2">
<h3 id="writing-some-tests">5.5. Writing some tests</h3>
<div class="paragraph">
<p>Lastly, let&#8217;s use a few more convenient functions included in <code>micronaut-kotlin-extension-functions</code> in our test</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/DadJokeTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.kotlin.context.createBean
import io.micronaut.kotlin.context.run
import io.micronaut.kotlin.http.retrieveList
import io.micronaut.kotlin.http.retrieveObject
import io.micronaut.runtime.server.EmbeddedServer
import org.junit.jupiter.api.Assertions.assertFalse
import org.junit.jupiter.api.Test

class DadJokeTest {

    @Test
    fun testDadJokeController() {
        val embeddedServer = run&lt;EmbeddedServer&gt;() <i class="conum" data-value="1"></i><b>(1)</b>
        val client = embeddedServer.applicationContext.createBean&lt;HttpClient&gt;(embeddedServer.url).toBlocking() <i class="conum" data-value="2"></i><b>(2)</b>

        // Test single object retrieve extension
        val anyJoke = client.retrieveObject&lt;String&gt;(HttpRequest.GET(&quot;/dadJokes/joke&quot;)) <i class="conum" data-value="3"></i><b>(3)</b>
        assertFalse(anyJoke.isNullOrBlank())

        // Test list retrieve extension
        val dogJoke = client.retrieveList&lt;DadJoke&gt;(HttpRequest.GET(&quot;/dadJokes/dogJokes&quot;)) <i class="conum" data-value="3"></i><b>(3)</b>
        assertFalse(dogJoke.isEmpty())
        assertFalse(dogJoke.first().joke.isNullOrBlank())

        client.close()
        embeddedServer.close()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we have <code>run&lt;EmbeddedServer&gt;</code> as a little syntactic sugar for <code>ApplicationContext.run(EmbeddedServer::class.java)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Same here for <code>createBean&lt;HttpClient&gt;</code>, we&#8217;re reducing our need to type <code>::class.java</code> all over the place</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>retrieveObject</code> and <code>retrieveList</code> give us nice shortcuts to reduce the need for <code>Argument.of</code> and <code>Argument.listOf</code>, in addition to reducing our <code>::class.java</code> uses.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we can test everything out!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application">6. Testing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw test</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-application">7. Running the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the application, use the <code>./mvnw mn:run</code> command, which starts the application on port 8080.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-a-micronaut-application-native-executable-with-graalvm">8. Generate a Micronaut Application Native Executable with GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use <a href="https://www.graalvm.org/">GraalVM</a>, an advanced JDK with ahead-of-time Native Image compilation, to generate a native executable of this Micronaut application.</p>
</div>
<div class="paragraph">
<p>Compiling Micronaut applications ahead of time with GraalVM significantly improves startup time and reduces the memory footprint of JVM-based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only Java and Kotlin projects support using GraalVM&#8217;s <code>native-image</code> tool. Groovy relies heavily on reflection, which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="graalvm-installation">8.1. GraalVM Installation</h3>
<div class="paragraph">
<p>The easiest way to install <a href="https://www.graalvm.org">GraalVM</a> on Linux or Mac is to use <a href="https://sdkman.io/">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="title">Java 21</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sdk install java 21.0.5-graal</code></pre>
</div>
</div>
<div class="paragraph">
<p>For installation on Windows, or for a manual installation on Linux or Mac, see the <a href="https://www.graalvm.org/latest/docs/getting-started/">GraalVM Getting Started</a> documentation.</p>
</div>
<div class="paragraph">
<p>The previous command installs Oracle GraalVM, which is free to use in production and free to redistribute, at no cost, under the <a href="https://www.oracle.com/downloads/licenses/graal-free-license.html">GraalVM Free Terms and Conditions</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <a href="https://github.com/graalvm/graalvm-ce-builds/releases/">GraalVM Community Edition</a>:</p>
</div>
<div class="listingblock">
<div class="title">Java 21</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sdk install java 21.0.2-graalce</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="native-executable-generation">8.2. Native Executable Generation</h3>
<div class="paragraph">
<p>To generate a native executable using Maven, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw package -Dpackaging=native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native executable is created in the <code>target</code> directory and can be run with <code>target/micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to customize the name of the native executable or pass additional build arguments using the <a href="https://graalvm.github.io/native-build-tools/latest/maven-plugin.html">Maven plugin for GraalVM Native Image building</a>. Declare the plugin as following:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.graalvm.buildtools<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>native-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.10.3<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="comment">&lt;!-- &lt;1&gt; --&gt;</span>
        <span class="tag">&lt;imageName&gt;</span>mn-graalvm-application<span class="tag">&lt;/imageName&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;buildArgs&gt;</span>
              <span class="comment">&lt;!-- &lt;2&gt; --&gt;</span>
          <span class="tag">&lt;buildArg&gt;</span>-Ob<span class="tag">&lt;/buildArg&gt;</span>
        <span class="tag">&lt;/buildArgs&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The native executable name will now be <code>mn-graalvm-application</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It is possible to pass extra build arguments to <code>native-image</code>. For example, <code>-Ob</code> enables the quick build mode.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whether you run the application via Gradle or as a Native Executable, you should be able to get a good laugh by typing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl localhost:8080/dadJokes/joke`</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl localhost:8080/dadJokes/dogJokes`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hopefully it brings a smile to your day!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">9. Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See all the useful libraries for Micronaut Kotlin developers in the <a href="https://micronaut-projects.github.io/micronaut-kotlin/latest/guide/#extensionFunctions">Micronaut Kotlin documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="help-with-the-micronaut-framework">10. Help with the Micronaut Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://micronaut.io/foundation/">Micronaut Foundation</a> sponsored the creation of this Guide. A variety of <a href="https://micronaut.io/commercial-support/">consulting and support services</a> are available.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license">11. License</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All guides are released with an <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache license 2.0 license</a> for the code and a <a href="https://creativecommons.org/licenses/by/4.0/deed.en">Creative Commons Attribution 4.0</a> license for the writing and media (images&#8230;&#8203;).
</td>
</tr>
</table>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <a href="https://micronaut.io/foundation/"><img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/></a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li id="menu-item-6740" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6740"><a href="https://fosstodon.org/@micronaut"><i class="fab fa-mastodon"><span class="sr-only">Mastodon</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://discord.gg/9xRFsHv98T"><i class="fab fa-discord"><span class="sr-only">Discord</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>Guides are licensed under <a href="https://creativecommons.org/licenses/by/4.0/deed.en">CC BY 4.0</a> for the writing/media and <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache.2.0</a> for the code</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
