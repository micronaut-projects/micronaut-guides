<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>RabbitMQ and the Micronaut Framework - Event-Driven Applications</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link href="coderay.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronaut-rabbitmq.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="RabbitMQ and the Micronaut Framework - Event-Driven Applications"/>
    <meta name="twitter:description" content="Use RabbitMQ to communicate between your Micronaut applications."/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item">
                        <a href="https://micronaut.io/download/" class="nav-link">Download</a>
                    </li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-2872 active dropdown nav-item">
                        <a href="./index.html" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2869" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2869">
                                <a href="https://micronaut.io/docs/" class="dropdown-item">User Documentation</a>
                            </li>
                            <li id="menu-item-2870" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2870">
                                <a href="./index.html" class="dropdown-item">Guides</a>
                            </li>
                            <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896">
                                <a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a>
                            </li>
                            <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897">
                                <a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a>
                            </li>
                            <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871">
                                <a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/blog/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879">
                                <a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a>
                            </li>
                            <li id="menu-item-2881" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2881">
                                <a href="https://micronaut.io/events/" class="dropdown-item">Upcoming Events</a>
                            </li>
                            <li id="menu-item-2880" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2880">
                                <a href="https://micronaut.io/commercial-support/" class="dropdown-item">Commercial Support</a>
                            </li>
                            <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882">
                                <a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a>
                            </li>
                            <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883">
                                <a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/foundation/" aria-current="page" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item menu-item-2877 active">
                                <a href="https://micronaut.io/foundation/" aria-current="page" class="dropdown-item">Overview</a>
                            </li>
                            <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874">
                                <a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a>
                            </li>
                            <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873">
                                <a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a>
                            </li>
                            <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876">
                                <a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item">
                        <a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a>
                    </li>
                </ul>
            </div>

        </nav>

    </div>
</header>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-rabbitmq.html">RabbitMQ and the Micronaut Framework - Event-Driven Applications</a> » <span class="breadcrumb_last" aria-current="page">gradle | java</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#writing-the-application">4. Writing the application</a>
<ul class="sectlevel2">
<li><a href="#books-microservice">4.1. Books microservice</a></li>
<li><a href="#analytics-microservice">4.2. Analytics microservice</a></li>
</ul>
</li>
<li><a href="#test-resources">5. Test Resources</a></li>
<li><a href="#running-the-application">6. Running the application</a>
<ul class="sectlevel2">
<li><a href="#books-microservice-2">6.1. Books microservice</a></li>
<li><a href="#analytics-microservice-2">6.2. Analytics microservice</a></li>
<li><a href="#running-the-application-2">6.3. Running the application</a></li>
</ul>
</li>
<li><a href="#generate-a-micronaut-application-native-executable-with-graalvm">7. Generate a Micronaut Application Native Executable with GraalVM</a>
<ul class="sectlevel2">
<li><a href="#native-executable-generation">7.1. Native executable generation</a></li>
</ul>
</li>
<li><a href="#next-steps">8. Next steps</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>RabbitMQ and the Micronaut Framework - Event-Driven Applications</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Use RabbitMQ to communicate between your Micronaut applications.</p>
</div>
<div class="paragraph">
<p>Authors: Iván López</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 3.9.2</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we will create a Micronaut application written in Java.</p>
</div>
<div class="paragraph">
<p>In this guide, we will create two microservices that will use <a href="https://www.rabbitmq.com/">RabbitMQ</a> to communicate with each other in an asynchronous and decoupled way.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>RabbitMQ is an open-source message-broker software that originally implemented the Advanced Message Queuing Protocol (AMQP)
and has since been extended with a plug-in architecture to support Streaming Text Oriented Messaging Protocol (STOMP),
Message Queuing Telemetry Transport (MQTT), and other protocols.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> <a href="https://www.baeldung.com/java-home-on-windows-7-8-10-mac-os-x-linux">configured appropriately</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-rabbitmq-gradle-java.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-application">4. Writing the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s describe the microservices you will build through the guide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>books</code> - It returns a list of books. It uses a domain consisting of a book name and ISBN. It also publishes a message in
RabbitMQ every time a book is accessed.</p>
</li>
<li>
<p><code>analytics</code> - It connects to RabbitMQ to update the analytics for every book (a counter). It also exposes an endpoint
to get the analytics.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">Setup IntelliJ IDEA to develop Micronaut Applications</a>.</p>
</div>
<div class="sect2">
<h3 id="books-microservice">4.1. Books microservice</h3>
<div class="paragraph">
<p>Create the <code>books</code> microservice using the <a href="https://docs.micronaut.io/latest/guide/#cli">Micronaut Command Line Interface</a> or with <a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn create-app --features=rabbitmq,reactor,graalvm example.micronaut.books --build=gradle --lang=java</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle is used as the build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as the language.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you use Micronaut Launch, select Micronaut Application as application type and add the <code>rabbitmq</code>, <code>reactor</code>, and <code>graalvm</code> features.</p>
</div>
<div class="paragraph">
<p>The previous command creates a directory named <code>books</code> and a Micronaut application inside it with default package <code>example.micronaut</code>.</p>
</div>
<div class="paragraph">
<p>Create a <code>BookController</code> class to handle incoming HTTP requests into the <code>books</code> microservice:</p>
</div>
<div class="listingblock">
<div class="title">books/src/main/java/example/micronaut/BookController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Controller</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Get</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.Optional</span>;

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookController</span> {

    <span class="directive">private</span> <span class="directive">final</span> BookService bookService; <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">public</span> BookController(BookService bookService) {
        <span class="local-variable">this</span>.bookService = bookService;
    }

    <span class="annotation">@Get</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; listAll() {
        <span class="keyword">return</span> bookService.listAll();
    }

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{isbn}</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="4"></i><b>(4)</b>
    Optional&lt;<span class="predefined-type">Book</span>&gt; findBook(<span class="predefined-type">String</span> isbn) {
        <span class="keyword">return</span> bookService.findByIsbn(isbn);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/books</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject <code>BookService</code> using constructor injection.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the <code>listAll</code> method to an HTTP GET request on <code>/books</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the <code>findBook</code> method to an HTTP GET request on <code>/books/{isbn}</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous controller responds a <code>List&lt;Book&gt;</code>. Create the <code>Book</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">books/src/main/java/example/micronaut/Book.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Creator</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.serde.annotation.Serdeable</span>;

<span class="keyword">import</span> <span class="include">java.util.Objects</span>;

<span class="annotation">@Serdeable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> isbn;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="annotation">@Creator</span>
    <span class="directive">public</span> <span class="predefined-type">Book</span>(<span class="predefined-type">String</span> isbn, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.isbn = isbn;
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getIsbn() {
        <span class="keyword">return</span> isbn;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Book{</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">isbn='</span><span class="delimiter">&quot;</span></span> + isbn + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">, name='</span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">'</span><span class="content">}</span><span class="delimiter">'</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> o) {
        <span class="keyword">if</span> (<span class="local-variable">this</span> == o) <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        <span class="keyword">if</span> (o == <span class="predefined-constant">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        <span class="predefined-type">Book</span> other = (<span class="predefined-type">Book</span>) o;
        <span class="keyword">return</span> Objects.equals(isbn, other.isbn) &amp;&amp;
                Objects.equals(name, other.name);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> Objects.hash(isbn, name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To keep this guide simple there is no database persistence, and the list of books is kept in memory in <code>BookService</code>:</p>
</div>
<div class="listingblock">
<div class="title">books/src/main/java/example/micronaut/BookService.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">javax.annotation.PostConstruct</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.Optional</span>;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookService</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; bookStore = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

    <span class="annotation">@PostConstruct</span>
    <span class="type">void</span> init() {
        bookStore.add(<span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1491950358</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Building Microservices</span><span class="delimiter">&quot;</span></span>));
        bookStore.add(<span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1680502395</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Release It!</span><span class="delimiter">&quot;</span></span>));
        bookStore.add(<span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0321601912</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Continuous Delivery</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; listAll() {
        <span class="keyword">return</span> bookStore;
    }

    <span class="directive">public</span> Optional&lt;<span class="predefined-type">Book</span>&gt; findByIsbn(<span class="predefined-type">String</span> isbn) {
        <span class="keyword">return</span> bookStore.stream()
                .filter(b -&gt; b.getIsbn().equals(isbn))
                .findFirst();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="analytics-microservice">4.2. Analytics microservice</h3>
<div class="paragraph">
<p>Create the <code>analytics</code> microservice using the <a href="https://docs.micronaut.io/latest/guide/#cli">Micronaut Command Line Interface</a> or with <a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn create-app --features=rabbitmq,graalvm example.micronaut.analytics --build=gradle --lang=java</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle is used as the build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as the language.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you use Micronaut Launch, select Micronaut Application as application type and add the <code>kafka</code> and <code>graalvm</code> features.</p>
</div>
<div class="paragraph">
<p>To keep this guide simple there is no database persistence, and the books analytics is kept in memory in <code>AnalyticsService</code>:</p>
</div>
<div class="listingblock">
<div class="title">analytics/src/main/java/example/micronaut/AnalyticsService.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">jakarta.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.ConcurrentHashMap</span>;
<span class="keyword">import</span> <span class="include">java.util.stream.Collectors</span>;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnalyticsService</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">Book</span>, <span class="predefined-type">Long</span>&gt; bookAnalytics = <span class="keyword">new</span> <span class="predefined-type">ConcurrentHashMap</span>&lt;&gt;(); <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> <span class="type">void</span> updateBookAnalytics(<span class="predefined-type">Book</span> book) { <i class="conum" data-value="2"></i><b>(2)</b>
        bookAnalytics.compute(book, (b, v) -&gt; {
            <span class="keyword">return</span> v == <span class="predefined-constant">null</span> ? <span class="integer">1L</span> : v + <span class="integer">1</span>;
        });
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;BookAnalytics&gt; listAnalytics() { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> bookAnalytics
                .entrySet()
                .stream()
                .map(e -&gt; <span class="keyword">new</span> BookAnalytics(e.getKey().getIsbn(), e.getValue()))
                .collect(Collectors.toList());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Keep the books analytics in memory.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initialize and update the analytics for the book passed as parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Return all the analytics.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create the <code>Book</code> POJO used by <code>AnalyticsService</code>:</p>
</div>
<div class="listingblock">
<div class="title">analytics/src/main/java/example/micronaut/Book.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Creator</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.serde.annotation.Serdeable</span>;

<span class="keyword">import</span> <span class="include">java.util.Objects</span>;

<span class="annotation">@Serdeable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> isbn;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="annotation">@Creator</span>
    <span class="directive">public</span> <span class="predefined-type">Book</span>(<span class="predefined-type">String</span> isbn, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.isbn = isbn;
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getIsbn() {
        <span class="keyword">return</span> isbn;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Book{</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">isbn='</span><span class="delimiter">&quot;</span></span> + isbn + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">, name='</span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">'</span><span class="content">}</span><span class="delimiter">'</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> o) {
        <span class="keyword">if</span> (<span class="local-variable">this</span> == o) <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        <span class="keyword">if</span> (o == <span class="predefined-constant">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        <span class="predefined-type">Book</span> other = (<span class="predefined-type">Book</span>) o;
        <span class="keyword">return</span> Objects.equals(isbn, other.isbn) &amp;&amp;
                Objects.equals(name, other.name);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> Objects.hash(isbn, name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous service responds a <code>List&lt;BookAnalytics&gt;</code>. Create the <code>BookAnalytics</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">analytics/src/main/java/example/micronaut/BookAnalytics.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Creator</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.serde.annotation.Serdeable</span>;

<span class="annotation">@Serdeable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookAnalytics</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> bookIsbn;
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">long</span> count;

    <span class="annotation">@Creator</span>
    <span class="directive">public</span> BookAnalytics(<span class="predefined-type">String</span> bookIsbn, <span class="type">long</span> count) {
        <span class="local-variable">this</span>.bookIsbn = bookIsbn;
        <span class="local-variable">this</span>.count = count;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getBookIsbn() {
        <span class="keyword">return</span> bookIsbn;
    }

    <span class="directive">public</span> <span class="type">long</span> getCount() {
        <span class="keyword">return</span> count;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Write a test:</p>
</div>
<div class="listingblock">
<div class="title">analytics/src/test/java/example/micronaut/AnalyticsServiceTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.test.extensions.junit5.annotation.MicronautTest</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;

<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="annotation">@MicronautTest</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnalyticsServiceTest</span> {

    <span class="annotation">@Inject</span> <i class="conum" data-value="2"></i><b>(2)</b>
    AnalyticsService analyticsService;

    <span class="annotation">@Test</span>
    <span class="type">void</span> testUpdateBookAnalyticsAndGetAnalytics() {
        <span class="predefined-type">Book</span> b1 = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1491950358</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Building Microservices</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Book</span> b2 = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1680502395</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Release It!</span><span class="delimiter">&quot;</span></span>);

        analyticsService.updateBookAnalytics(b1);
        analyticsService.updateBookAnalytics(b1);
        analyticsService.updateBookAnalytics(b1);
        analyticsService.updateBookAnalytics(b2);

        <span class="predefined-type">List</span>&lt;BookAnalytics&gt; analytics = analyticsService.listAnalytics();
        assertEquals(<span class="integer">2</span>, analytics.size());

        assertEquals(<span class="integer">3</span>, findBookAnalytics(b1, analytics).getCount());
        assertEquals(<span class="integer">1</span>, findBookAnalytics(b2, analytics).getCount());
    }

    <span class="directive">private</span> BookAnalytics findBookAnalytics(<span class="predefined-type">Book</span> b, <span class="predefined-type">List</span>&lt;BookAnalytics&gt; analytics) {
        <span class="keyword">return</span> analytics
                .stream()
                .filter(bookAnalytics -&gt; bookAnalytics.getBookIsbn().equals(b.getIsbn()))
                .findFirst()
                .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Book not found</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>micronaut-test-junit5</code> is added automatically to <code>build.gradle</code> (or <code>pom.xml</code>) when creating an application with the CLI. For more information, see <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/">the documentation</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Just inject the collaborator and <code>@MicronautTest</code> will take care of everything.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a Controller to expose the analytics:</p>
</div>
<div class="listingblock">
<div class="title">analytics/src/main/java/example/micronaut/AnalyticsController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Controller</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Get</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/analytics</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnalyticsController</span> {

    <span class="directive">private</span> <span class="directive">final</span> AnalyticsService analyticsService;

    <span class="directive">public</span> AnalyticsController(AnalyticsService analyticsService) {
        <span class="local-variable">this</span>.analyticsService = analyticsService;
    }

    <span class="annotation">@Get</span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;BookAnalytics&gt; listAnalytics() {
        <span class="keyword">return</span> analyticsService.listAnalytics();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Just expose the analytics.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The application doesn&#8217;t expose the method <code>updateBookAnalytics</code> created in <code>AnalyticsService</code>. This method will be invoked
when reading messages from RabbitMQ.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="title">analytics</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify the <code>Application</code> class to use <code>dev</code> as a default environment:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The Micronaut framework supports the concept of one or many default environments. A default environment is one that is only applied if no other environments are explicitly specified or deduced.</p>
</div>
</blockquote>
</div>
<div class="listingblock">
<div class="title">analytics/src/main/java/example/micronaut/Application.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.runtime.Micronaut</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">io.micronaut.context.env.Environment.DEVELOPMENT</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Application</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        Micronaut.build(args)
                .mainClass(Application.class)
                .defaultEnvironments(DEVELOPMENT)
                .start();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create <code>src/main/resources/application-dev.yml</code>. The Micronaut framework applies this configuration file only for the <code>dev</code> environment.</p>
</div>
<div class="listingblock">
<div class="title">analytics/src/main/resources/application-dev.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">server</span>:
    <span class="key">port</span>: <span class="string"><span class="content">8081 </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start the <code>analytics</code> microservice on port 8081.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-resources">5. Test Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the application is started locally&#8201;&#8212;&#8201;either under test or by <a href="#running-the-application">running the application</a>&#8201;&#8212;&#8201;resolution of the <code>rabbitmq.uri</code> property is detected and the Test Resources service will start a local RabbitMQ docker container, and inject the properties required to use this as the message broker.</p>
</div>
<div class="paragraph">
<p>When running under production, you should replace this property with the location of your production message broker via an environment variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">RABBITMQ_URI=amqp://production-server:5672</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://micronaut-projects.github.io/micronaut-test-resources/snapshot/guide/#modules-rabbitmq">RabbitMQ section of the Test Resources documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-application">6. Running the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the <code>books</code> microservice:</p>
</div>
<div class="listingblock">
<div class="title">books</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>16:35:55.614 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 576ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>analytics</code> microservice:</p>
</div>
<div class="listingblock">
<div class="title">analytics</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>16:35:55.614 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 623ms. Server Running: http://localhost:8081</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run <code>curl</code> commands to test the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8080/books</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{<span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1491950358</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Building Microservices</span><span class="delimiter">&quot;</span></span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1680502395</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Release It!</span><span class="delimiter">&quot;</span></span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">0321601912</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Continuous Delivery</span><span class="delimiter">&quot;</span></span>}]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8080/books/1491950358</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1491950358</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Building Microservices</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8081/analytics</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that getting the analytics returns an empty list because the applications are not communicating to each other (yet).</p>
</div>
<div class="sect2">
<h3 id="books-microservice-2">6.1. Books microservice</h3>
<div class="paragraph">
<p>Via <a href="#test-resources">Test Resources</a> the Micronaut application will connect to a RabbitMQ instance running inside Docker so it is not necessary to add anything to <code>application.yml</code>.
In case you want to change the configuration, add the following:</p>
</div>
<div class="listingblock">
<div class="title">books/src/main/resources/application-prod.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">rabbitmq</span>:
  <span class="key">uri</span>: <span class="string"><span class="content">amqp://rabbitmq-server:5672</span></span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="create-rabbitmq-exchange-queue-and-binding">6.1.1. Create RabbitMQ exchange, queue and binding</h4>
<div class="paragraph">
<p>Before being able to send and receive messages using RabbitMQ it is necessary to define the exchange, queue and binding.
One option is create them directly in the RabbitMQ Admin UI available on port 15672.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use <code>guest</code> for both username and password.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another option is to create them programmatically.
Create the class <code>ChannelPoolListener</code>:</p>
</div>
<div class="listingblock">
<div class="title">books/src/main/java/example/micronaut/ChannelPoolListener.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">com.rabbitmq.client.BuiltinExchangeType</span>;
<span class="keyword">import</span> <span class="include">com.rabbitmq.client.Channel</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.connect.ChannelInitializer</span>;

<span class="keyword">import</span> <span class="include">jakarta.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChannelPoolListener</span> <span class="directive">extends</span> ChannelInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">Channel</span> channel, <span class="predefined-type">String</span> name) <span class="directive">throws</span> <span class="exception">IOException</span> {
        channel.exchangeDeclare(<span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>, BuiltinExchangeType.DIRECT, <span class="predefined-constant">true</span>); <i class="conum" data-value="1"></i><b>(1)</b>
        channel.queueDeclare(<span class="string"><span class="delimiter">&quot;</span><span class="content">analytics</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">null</span>); <i class="conum" data-value="2"></i><b>(2)</b>
        channel.queueBind(<span class="string"><span class="delimiter">&quot;</span><span class="content">analytics</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">analytics</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define an exchange named <code>micronaut</code>. From the producer point of view everything is sent to the exchange with the appropriate routing key</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a queue named <code>analytics</code>. The consumer will listen for messages in that queue.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define a binding between the exchange and the queue using the routing key <code>analytics</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="create-rabbitmq-client-producer">6.1.2. Create RabbitMQ client (producer)</h4>
<div class="paragraph">
<p>Let&#8217;s create an interface to send messages to RabbitMQ. The Micronaut framework will implement the interface at compilation time:</p>
</div>
<div class="listingblock">
<div class="title">books/src/main/java/example/micronaut/AnalyticsClient.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.Binding</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.RabbitClient</span>;

<span class="annotation">@RabbitClient</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">AnalyticsClient</span> {

    <span class="annotation">@Binding</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">analytics</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="type">void</span> updateAnalytics(<span class="predefined-type">Book</span> book); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the exchange used to send the messages.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the routing key.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send the <code>Book</code> POJO. The Micronaut framework will automatically convert it to JSON before sending it.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="send-analytics-information-automatically">6.1.3. Send Analytics information automatically</h4>
<div class="paragraph">
<p>Sending a message to RabbitMQ is as simple as injecting <code>AnalyticsClient</code> and calling <code>updateAnalytics</code> method. The goal
is to do it automatically every time a book is returned, i.e., every time there is a call to <code>http://localhost:8080/books/{isbn}</code>.
To achieve this we will create an <a href="https://docs.micronaut.io/latest/guide/#filters">Http Server Filter</a>.
Create the <code>AnalyticsFilter</code> class:</p>
</div>
<div class="listingblock">
<div class="title">books/src/main/java/example/micronaut/AnalyticsFilter.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.MutableHttpResponse</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Filter</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.filter.HttpServerFilter</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.filter.ServerFilterChain</span>;
<span class="keyword">import</span> <span class="include">reactor.core.publisher.Flux</span>;
<span class="keyword">import</span> <span class="include">reactor.core.publisher.Mono</span>;
<span class="keyword">import</span> <span class="include">org.reactivestreams.Publisher</span>;

<span class="keyword">import</span> <span class="include">java.util.Optional</span>;

<span class="annotation">@Filter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/books/?*</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnalyticsFilter</span> <span class="directive">implements</span> HttpServerFilter { <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">private</span> <span class="directive">final</span> AnalyticsClient analyticsClient; <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="directive">public</span> AnalyticsFilter(AnalyticsClient analyticsClient) { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="local-variable">this</span>.analyticsClient = analyticsClient;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request, ServerFilterChain chain) { <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="keyword">return</span> Flux
                .from(chain.proceed(request)) <i class="conum" data-value="5"></i><b>(5)</b>
                .flatMap(response -&gt;
                        Mono.fromCallable(() -&gt; {
                            Optional&lt;<span class="predefined-type">Book</span>&gt; book = response.getBody(<span class="predefined-type">Book</span>.class); <i class="conum" data-value="6"></i><b>(6)</b>
                            book.ifPresent(analyticsClient::updateAnalytics); <i class="conum" data-value="7"></i><b>(7)</b>

                            <span class="keyword">return</span> response;
                        })
                );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@Filter</code> and define the ANT Matcher pattern to intercept all the calls to the desire URI.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class needs to implement <code>HttpServerFilter</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor injection for RabbitMQ <code>AnalyticsClient</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Override <code>doFilter</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Execute the request. This will call the controller action.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Get the response from the controller and return the body as a <code>Book</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>If the book is found, use RabbitMQ client to send a message.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="analytics-microservice-2">6.2. Analytics microservice</h3>
<div class="sect3">
<h4 id="create-rabbitmq-exchange-queue-and-binding-2">6.2.1. Create RabbitMQ exchange, queue and binding</h4>
<div class="paragraph">
<p>As we already did in Books Microservice, let&#8217;s create the class <code>ChannelPoolListener</code> to define the exchange, queue
and binding:</p>
</div>
<div class="listingblock">
<div class="title">analytics/src/main/java/example/micronaut/ChannelPoolListener.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">com.rabbitmq.client.BuiltinExchangeType</span>;
<span class="keyword">import</span> <span class="include">com.rabbitmq.client.Channel</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.connect.ChannelInitializer</span>;

<span class="keyword">import</span> <span class="include">jakarta.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChannelPoolListener</span> <span class="directive">extends</span> ChannelInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">Channel</span> channel, <span class="predefined-type">String</span> name) <span class="directive">throws</span> <span class="exception">IOException</span> {
        channel.exchangeDeclare(<span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>, BuiltinExchangeType.DIRECT, <span class="predefined-constant">true</span>);
        channel.queueDeclare(<span class="string"><span class="delimiter">&quot;</span><span class="content">analytics</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">null</span>);
        channel.queueBind(<span class="string"><span class="delimiter">&quot;</span><span class="content">analytics</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">analytics</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Instead of copy-paste the class in every project it would be better to create a new Gradle (or Maven) module and
share it among all the microservices.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="create-rabbitmq-consumer">6.2.2. Create RabbitMQ consumer</h4>
<div class="paragraph">
<p>Create a new class to act as a consumer of the messages sent to RabbitMQ by the Books Microservice. The Micronaut framework will
implement the consumer at compile time. Create <code>AnalyticsListener</code>:</p>
</div>
<div class="listingblock">
<div class="title">analytics/src/main/java/example/micronaut/AnalyticsListener.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.Queue</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.RabbitListener</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Requires</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.env.Environment</span>;

<span class="annotation">@Requires</span>(notEnv = Environment.TEST) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@RabbitListener</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnalyticsListener</span> {

    <span class="directive">private</span> <span class="directive">final</span> AnalyticsService analyticsService; <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="directive">public</span> AnalyticsListener(AnalyticsService analyticsService) { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="local-variable">this</span>.analyticsService = analyticsService;
    }

    <span class="annotation">@Queue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">analytics</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> <span class="type">void</span> updateAnalytics(<span class="predefined-type">Book</span> book) {
        analyticsService.updateBookAnalytics(book); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Do not load this bean for the test environment. This enable us to run the tests without having a RabbitMQ instance running.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the class with <code>@RabbitListener</code> to indicate that this bean will consume messages from RabbitMQ.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor injection for <code>AnalyticsService</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Annotate the method with <code>@Queue</code>. This listener will listen to messages in <code>analytics</code> queue.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Call the previously created method to update the analytics for the book.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-application-2">6.3. Running the application</h3>
<div class="paragraph">
<p>Run <code>books</code> microservice:</p>
</div>
<div class="listingblock">
<div class="title">books</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>16:35:55.614 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 576ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute a <code>curl</code> request to get one book:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8080/books/1491950358</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1491950358</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Building Microservices</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open RabbitMQ Admin UI on <a href="http://localhost:15672" class="bare">http://localhost:15672</a> and use <code>guest</code> for both username and password. Select <code>queues</code> and
<code>analytics</code> queue. You can see that there is a message in the queue.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rabbitmq-message.png" alt="rabbitmq message">
</div>
</div>
<div class="paragraph">
<p>Expand the "Get messages" option and get one message. You can see all the information: <code>exchange</code>, <code>routing key, and the
`payload</code> serialized to JSON:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rabbitmq-message-detail.png" alt="rabbitmq message detail">
</div>
</div>
<div class="paragraph">
<p>Run <code>analytics</code> microservice:</p>
</div>
<div class="listingblock">
<div class="title">analytics</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>16:35:55.614 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 623ms. Server Running: http://localhost:8081</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application will consume and process the message automatically after the startup. Go to RabbitMQ Admin UI and check that the message has been consumed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rabbitmq-message-consumed.png" alt="rabbitmq message consumed">
</div>
</div>
<div class="paragraph">
<p>Now, run a <code>curl</code> to get the analytics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8081/analytics</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{<span class="key"><span class="delimiter">&quot;</span><span class="content">bookIsbn</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1491950358</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>}]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-a-micronaut-application-native-executable-with-graalvm">7. Generate a Micronaut Application Native Executable with GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use <a href="https://www.graalvm.org/">GraalVM</a>, the polyglot embeddable virtual machine, to generate a native executable of our Micronaut application.</p>
</div>
<div class="paragraph">
<p>Compiling native executables ahead of time with GraalVM improves startup time and reduces the memory footprint of JVM-based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only Java and Kotlin projects support using GraalVM&#8217;s <code>native-image</code> tool. Groovy relies heavily on reflection, which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="native-executable-generation">7.1. Native executable generation</h3>
<div class="paragraph">
<p>The easiest way to install GraalVM on Linux or Mac is to use <a href="https://sdkman.io/">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="title">Java 11</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sdk install java 22.3.r11-grl</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you still use Java 8, use the JDK11 version of GraalVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Java 17</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sdk install java 22.3.r17-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>For installation on Windows, or for manual installation on Linux or Mac, see the <a href="https://www.graalvm.org/22.0/docs/getting-started/">GraalVM Getting Started</a> documentation.</p>
</div>
<div class="paragraph">
<p>After installing GraalVM, install the <code>native-image</code> component, which is not installed by default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gu install native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate a native executable using Gradle, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew nativeCompile</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native executable is created in <code>build/native/nativeCompile</code> directory and can be run with <code>build/native/nativeCompile/micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to customize the name of the native executable or pass additional parameters to GraalVM:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graalvmNative {
    binaries {
        main {
            imageName.set(<span class="string"><span class="delimiter">'</span><span class="content">mn-graalvm-application</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
            buildArgs.add(<span class="string"><span class="delimiter">'</span><span class="content">--verbose</span><span class="delimiter">'</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The native executable name will now be <code>mn-graalvm-application</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It is possible to pass extra arguments to build the native executable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Start the native executables for the two microservices and run the same <code>curl</code> request as before to check that everything works with GraalVM.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">8. Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Read more about <a href="https://micronaut-projects.github.io/micronaut-rabbitmq/latest/guide/">RabbitMQ support</a> in the Micronaut framework.</p>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://matrix.to/#/#micronautfw_questions:gitter.im"><i class="fab fa-gitter"><span class="sr-only">Gitter</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>© 2023 MICRONAUT FOUNDATION. ALL RIGHTS RESERVED</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
